<!doctype html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>N1 CyberSphere - JLPT N1 2026/07</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Exo+2:wght@300;400;600&display=swap"
    rel="stylesheet" />
  <style>
    /* =========================================================
        [CSS-INDEX]
        1) RESET + BODY THEME
        2) BACKGROUND EFFECTS
        3) LAYOUT WRAPPER (.container)
        4) HEADER / BRANDING
        5) PANELS / CARDS
        6) STREAK COUNTER
        7) MODULES GRID
        8) FOOTER
        9) RESPONSIVE
        10) LICENSE GATE
        11) EXAM WARNING STATE
        12) STATUS WARNING STATE
        13) MODULE MODAL DISPLAY (NEW)
      ========================================================= */

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Exo 2", sans-serif;
      background-color: #0a0e17;
      color: #e0f7ff;
      min-height: 100vh;
      overflow-x: hidden;
      background-image:
        radial-gradient(circle at 20% 30%,
          rgba(16, 64, 120, 0.15) 0%,
          transparent 20%),
        radial-gradient(circle at 80% 70%,
          rgba(0, 150, 200, 0.1) 0%,
          transparent 20%),
        linear-gradient(to bottom, #0a0e17, #0c1220);
    }

    .cyber-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(rgba(0, 150, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 150, 255, 0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      z-index: -1;
      opacity: 0.4;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid rgba(0, 150, 255, 0.3);
      margin-bottom: 40px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #00a8ff, #0066cc);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      transform: rotate(45deg);
      box-shadow: 0 0 20px rgba(0, 168, 255, 0.5);
    }

    .logo-icon i {
      transform: rotate(-45deg);
    }

    .logo-text {
      font-family: "Orbitron", sans-serif;
      font-weight: 900;
      font-size: 28px;
      background: linear-gradient(to right, #00a8ff, #00ffcc);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 1px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
      background: rgba(0, 40, 80, 0.4);
      padding: 12px 20px;
      border-radius: 10px;
      border: 1px solid rgba(0, 150, 255, 0.3);
      backdrop-filter: blur(10px);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #ff9900, #ff6600);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #000;
    }

    .user-name {
      font-weight: 600;
      font-size: 18px;
    }

    .user-greeting {
      color: #88d3ff;
      font-size: 14px;
    }

    .main-content {
      display: flex;
      flex-direction: column;
      gap: 40px;
    }

    .mission-panel {
      background: rgba(0, 20, 40, 0.6);
      border-radius: 15px;
      padding: 30px;
      border: 1px solid rgba(0, 150, 255, 0.3);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .mission-panel::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to right, #00a8ff, #00ffcc);
    }

    .panel-title {
      font-family: "Orbitron", sans-serif;
      font-size: 24px;
      margin-bottom: 25px;
      color: #00e5ff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel-title i {
      color: #ff9900;
    }

    .target-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .target-card {
      flex: 1;
      min-width: 250px;
      background: rgba(0, 30, 60, 0.5);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(0, 150, 255, 0.2);
      position: relative;
      transition:
        transform 0.3s,
        box-shadow 0.3s;
    }

    .target-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 100, 255, 0.3);
    }

    .target-card::after {
      display: none;
    }

    .card-title {
      font-size: 16px;
      color: #88d3ff;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-value {
      font-family: "Orbitron", sans-serif;
      font-size: 26px;
      font-weight: 700;
      color: #00ffcc;
      text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
    }

    .card-value.special {
      color: #ff9900;
      text-shadow: 0 0 10px rgba(255, 153, 0, 0.5);
    }

    .card-subtitle {
      font-size: 14px;
      color: #a0c8e0;
      margin-top: 5px;
    }

    .streak-counter {
      background: rgba(0, 30, 60, 0.7);
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      border: 1px solid rgba(255, 153, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .streak-counter::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg,
          transparent 30%,
          rgba(255, 153, 0, 0.1) 50%,
          transparent 70%);
      animation: shine 3s infinite;
    }

    @keyframes shine {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    .streak-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
      color: #ff9900;
      margin-bottom: 15px;
    }

    .streak-days {
      font-family: "Orbitron", sans-serif;
      font-size: 42px;
      font-weight: 900;
      color: #ffcc00;
      text-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
      margin-bottom: 5px;
    }

    .streak-text {
      font-size: 18px;
      color: #ffdd99;
    }

    /* ===== MODULES GRID (full width lu√¥n, v√¨ frame kh√¥ng c√≤n chi·∫øm ch·ªó) ===== */
    .modules-wrapper {
      margin-top: 20px;
    }

    .modules-section {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 25px;
    }

    .module-card {
      background: rgba(0, 20, 40, 0.7);
      border-radius: 12px;
      padding: 25px;
      border: 1px solid rgba(0, 150, 255, 0.3);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      user-select: none;
    }

    .module-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 25px rgba(0, 100, 255, 0.4);
      border-color: #00a8ff;
    }

    .module-card.locked {
      border-color: #00a8ff !important;
      background: rgba(0, 168, 255, 0.15) !important;
      box-shadow:
        0 0 20px rgba(0, 168, 255, 0.5),
        0 15px 25px rgba(0, 100, 255, 0.4) !important;
      transform: translateY(-8px);
      position: relative;
      z-index: 5;
    }

    .module-card.locked::after {
      content: "üîí";
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      color: #00a8ff;
      text-shadow: 0 0 10px rgba(0, 168, 255, 0.7);
      animation: lockPulse 1.5s infinite alternate;
    }

    @keyframes lockPulse {
      0% {
        opacity: 0.7;
        transform: scale(0.9);
      }

      100% {
        opacity: 1;
        transform: scale(1.1);
      }
    }

    .module-card.locked .module-icon {
      color: #00a8ff !important;
      background: rgba(0, 168, 255, 0.2) !important;
      border-color: #00a8ff !important;
    }

    .module-card.locked .module-title {
      color: #00a8ff !important;
      text-shadow: 0 0 10px rgba(0, 168, 255, 0.5) !important;
    }

    .module-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to right, #0066cc, #00a8ff);
    }

    .module-card.locked::before {
      background: linear-gradient(to right, #0066cc, #00a8ff) !important;
    }

    .module-icon {
      width: 60px;
      height: 60px;
      background: rgba(0, 100, 200, 0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      color: #00a8ff;
      margin-bottom: 20px;
      border: 1px solid rgba(0, 150, 255, 0.3);
    }

    .module-title {
      font-family: "Orbitron", sans-serif;
      font-size: 20px;
      margin-bottom: 10px;
      color: #00e5ff;
    }

    .module-desc {
      color: #a0c8e0;
      font-size: 15px;
      line-height: 1.5;
      margin-bottom: 20px;
    }

    .progress-bar {
      height: 8px;
      background: rgba(0, 50, 100, 0.5);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 15px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, #0066cc, #00ffcc);
      border-radius: 4px;
      width: 0%;
      transition: width 1.5s ease-out;
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #88d3ff;
    }

    /* ===== MODULE MODAL DISPLAY (NEW) ===== */
    .module-display-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(2, 8, 18, 0.78);
      backdrop-filter: blur(8px);
      z-index: 9998;
      display: none;
      opacity: 0;
      transition: opacity 220ms ease;
    }

    .module-display-backdrop.show {
      display: block;
      opacity: 1;
    }

    .module-display-frame {
      width: min(920px, calc(100vw - 40px));
      height: min(620px, calc(100vh - 120px));
      background: rgba(0, 20, 40, 0.92);
      border: 3px solid #00a8ff;
      border-radius: 15px;
      padding: 26px;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0.92);
      opacity: 0;
      z-index: 9999;
      display: none;
      backdrop-filter: blur(15px);
      overflow: hidden;
      box-shadow:
        0 15px 40px rgba(0, 0, 0, 0.8),
        0 0 30px rgba(0, 168, 255, 0.7),
        inset 0 0 30px rgba(0, 150, 255, 0.1);
    }

    .module-display-frame.show {
      display: flex;
      flex-direction: column;
      animation: modalIn 320ms cubic-bezier(0.2, 1.05, 0.35, 1) forwards;
    }

    @keyframes modalIn {
      0% {
        opacity: 0;
        transform: translate(-50%, -48%) scale(0.9);
        filter: blur(2px);
      }

      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
        filter: blur(0);
      }
    }

    .module-display-frame::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to right, #0066cc, #00a8ff);
      z-index: 2;
    }

    .module-display-frame::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 15px;
      border: 2px solid rgba(0, 168, 255, 0.25);
      pointer-events: none;
      z-index: 1;
    }

    .frame-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 0, 255, 0.3);
      z-index: 3;
    }

    .status-indicator {
      font-size: 14px;
      color: #88d3ff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-indicator.locked {
      color: #00a8ff;
      text-shadow: 0 0 10px rgba(0, 168, 255, 0.5);
    }

    .close-lock-btn {
      background: rgba(0, 168, 255, 0.2);
      border: 1px solid rgba(0, 168, 255, 0.5);
      color: #00a8ff;
      padding: 7px 12px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.25s;
    }

    .close-lock-btn:hover {
      background: rgba(0, 168, 255, 0.38);
      box-shadow: 0 0 10px rgba(0, 168, 255, 0.45);
      transform: translateY(-1px);
    }

    .frame-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
      padding-bottom: 14px;
      border-bottom: 1px solid rgba(0, 150, 255, 0.3);
      z-index: 3;
    }

    .frame-icon {
      width: 50px;
      height: 50px;
      background: rgba(0, 100, 200, 0.3);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #00ffcc;
      border: 1px solid rgba(0, 255, 204, 0.3);
    }

    .frame-title {
      font-family: "Orbitron", sans-serif;
      font-size: 22px;
      color: #00ffcc;
      text-shadow: 0 0 10px rgba(0, 255, 204, 0.3);
    }

    .frame-content {
      flex: 1;
      overflow-y: auto;
      padding-right: 10px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      z-index: 3;
    }

    .frame-content::-webkit-scrollbar {
      width: 8px;
    }

    .frame-content::-webkit-scrollbar-track {
      background: rgba(0, 30, 60, 0.3);
      border-radius: 4px;
    }

    .frame-content::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, #00a8ff, #00ffcc);
      border-radius: 4px;
    }

    .content-item {
      background: rgba(0, 30, 60, 0.45);
      border-radius: 10px;
      padding: 16px;
      border: 1px solid rgba(0, 150, 255, 0.25);
      transition: all 0.25s;
      min-height: 165px;
      display: flex;
      flex-direction: column;
      cursor: pointer;
    }

    .content-item:hover {
      background: rgba(0, 40, 80, 0.6);
      border-color: #00a8ff;
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 100, 255, 0.18);
    }

    .item-title {
      font-family: "Orbitron", sans-serif;
      font-size: 16px;
      color: #00e5ff;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .item-title i {
      color: #00ffcc;
      font-size: 10px;
    }

    .item-desc {
      color: #a0c8e0;
      font-size: 14px;
      line-height: 1.55;
      margin-bottom: 12px;
      flex: 1;
    }

    .item-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 6px;
      font-size: 12px;
      color: #88d3ff;
      background: rgba(0, 40, 80, 0.25);
      padding: 8px 10px;
      border-radius: 8px;
    }

    .item-progress {
      height: 5px;
      background: rgba(0, 50, 100, 0.5);
      border-radius: 3px;
      margin-top: 10px;
      overflow: hidden;
    }

    .item-progress-fill {
      height: 100%;
      background: linear-gradient(to right, #00a8ff, #00ffcc);
      border-radius: 3px;
      width: 0%;
      transition: width 700ms ease-out;
      box-shadow: 0 0 10px rgba(0, 255, 204, 0.25);
      transition: width 0.4s ease;
    }

    .start-button {
      display: block;
      width: 100%;
      padding: 15px;
      background: linear-gradient(to right, #0066cc, #00a8ff);
      color: white;
      border: none;
      border-radius: 8px;
      font-family: "Orbitron", sans-serif;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      text-decoration: none;
      margin-top: 20px;
      letter-spacing: 1px;
    }

    .start-button:hover {
      background: linear-gradient(to right, #00a8ff, #00ffcc);
      box-shadow: 0 0 20px rgba(0, 168, 255, 0.7);
      transform: scale(1.02);
    }

    .floating-elements {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: -1;
    }

    .floating-element {
      position: absolute;
      background: rgba(0, 150, 255, 0.1);
      border: 1px solid rgba(0, 150, 255, 0.3);
      border-radius: 10px;
      animation: float 20s infinite linear;
    }

    .floating-element:nth-child(1) {
      width: 80px;
      height: 80px;
      top: 10%;
      left: 5%;
      animation-delay: 0s;
    }

    .floating-element:nth-child(2) {
      width: 60px;
      height: 60px;
      top: 20%;
      right: 10%;
      animation-delay: -5s;
    }

    .floating-element:nth-child(3) {
      width: 100px;
      height: 100px;
      bottom: 15%;
      left: 10%;
      animation-delay: -10s;
    }

    .floating-element:nth-child(4) {
      width: 70px;
      height: 70px;
      bottom: 25%;
      right: 5%;
      animation-delay: -15s;
    }

    @keyframes float {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }

      25% {
        transform: translate(20px, 30px) rotate(90deg);
      }

      50% {
        transform: translate(0, 60px) rotate(180deg);
      }

      75% {
        transform: translate(-20px, 30px) rotate(270deg);
      }

      100% {
        transform: translate(0, 0) rotate(360deg);
      }
    }

    .cyber-line {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .cyber-line::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 1px;
      background: linear-gradient(to right,
          transparent,
          #00ffcc,
          transparent);
      animation: scan 4s linear infinite;
    }

    @keyframes scan {
      0% {
        top: 0%;
      }

      100% {
        top: 100%;
      }
    }

    .glow-effect {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle,
          rgba(0, 150, 255, 0.1),
          transparent 70%);
      filter: blur(20px);
      z-index: -1;
    }

    .glow-1 {
      top: 10%;
      right: 10%;
    }

    .glow-2 {
      bottom: 10%;
      left: 10%;
    }

    footer {
      text-align: center;
      padding: 30px 0;
      margin-top: 50px;
      border-top: 1px solid rgba(0, 150, 255, 0.2);
      color: #88d3ff;
      font-size: 14px;
    }

    @media (max-width: 900px) {
      .modules-section {
        grid-template-columns: 1fr;
      }

      .frame-content {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .target-info {
        flex-direction: column;
      }

      .target-card {
        min-width: 100%;
      }

      .logo-text {
        font-size: 22px;
      }

      .user-info {
        padding: 8px 15px;
      }
    }

    /* ===== LICENSE GATE ===== */
    .license-gate {
      position: fixed;
      inset: 0;
      background: rgba(2, 8, 18, 0.88);
      backdrop-filter: blur(10px);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .license-panel {
      width: min(720px, 100%);
      background: rgba(0, 20, 40, 0.75);
      border: 1px solid rgba(0, 150, 255, 0.35);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
      padding: 24px;
      position: relative;
      overflow: hidden;
    }

    .license-panel::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(to right, #00a8ff, #00ffcc);
    }

    .license-row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 14px;
    }

    .license-input {
      width: 100%;
      padding: 14px 14px;
      border-radius: 10px;
      border: 1px solid rgba(0, 150, 255, 0.35);
      background: rgba(0, 10, 25, 0.75);
      color: #e0f7ff;
      outline: none;
      font-size: 15px;
    }

    .license-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .license-btn {
      padding: 12px 14px;
      border-radius: 10px;
      border: 0;
      cursor: pointer;
      font-family: "Orbitron", sans-serif;
      letter-spacing: 0.5px;
    }

    .license-btn.primary {
      background: linear-gradient(to right, #0066cc, #00a8ff);
      color: #fff;
    }

    .license-btn.primary:hover {
      background: linear-gradient(to right, #00a8ff, #00ffcc);
      box-shadow: 0 0 20px rgba(0, 168, 255, 0.5);
    }

    .license-btn.ghost {
      background: rgba(0, 40, 80, 0.35);
      color: #88d3ff;
      border: 1px solid rgba(0, 150, 255, 0.25);
    }

    .license-small {
      color: #a0c8e0;
      font-size: 13px;
      line-height: 1.5;
    }

    .license-kv {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 10px;
      padding: 12px;
      border: 1px solid rgba(0, 150, 255, 0.2);
      border-radius: 12px;
      background: rgba(0, 30, 60, 0.35);
    }

    .license-kv code {
      word-break: break-all;
      color: #00ffcc;
    }

    .license-status {
      margin-top: 10px;
      font-size: 14px;
      color: #88d3ff;
    }

    .license-status.error {
      color: #ff8a8a;
    }

    .license-status.ok {
      color: #00ffcc;
    }

    /* ====== EXAM WARNING (gi·ªØ nguy√™n logic class) ====== */
    .target-card:nth-child(2) {
      position: relative;
      overflow: hidden;
    }

    .target-card:nth-child(2)::before,
    .target-card:nth-child(2)::after {
      display: none !important;
    }

    .target-card:nth-child(2).warning-yellow::before,
    .target-card:nth-child(2).warning-yellow::after,
    .target-card:nth-child(2).warning-red::before,
    .target-card:nth-child(2).warning-red::after,
    .target-card:nth-child(2).warning-expired::before,
    .target-card:nth-child(2).warning-expired::after {
      display: block !important;
    }

    .target-card:nth-child(2).warning-yellow .sparkle,
    .target-card:nth-child(2).warning-red .sparkle,
    .target-card:nth-child(2).warning-expired .sparkle {
      display: block !important;
    }

    .target-card:nth-child(2).warning-yellow .sparkle,
    .target-card:nth-child(2).warning-red .sparkle,
    .target-card:nth-child(2).warning-expired .sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      filter: blur(1px);
      animation: sparkleMove 4s linear infinite;
      opacity: 0.7;
    }

    .target-card:nth-child(2) .sparkle:nth-child(1) {
      top: 20%;
      left: 15%;
      animation-delay: 0s;
    }

    .target-card:nth-child(2) .sparkle:nth-child(2) {
      top: 60%;
      right: 20%;
      animation-delay: 1s;
    }

    .target-card:nth-child(2) .sparkle:nth-child(3) {
      bottom: 30%;
      left: 30%;
      animation-delay: 2s;
    }

    @keyframes sparkleMove {

      0%,
      100% {
        opacity: 0;
        transform: translate(0, 0);
      }

      10%,
      90% {
        opacity: 0.7;
      }

      50% {
        opacity: 0.4;
        transform: translate(5px, -5px);
      }
    }

    .target-card:nth-child(2).warning-yellow {
      background: rgba(60, 40, 0, 0.7) !important;
      border: 1px solid rgba(255, 200, 0, 0.6) !important;
      animation: cyberPulse 2s infinite alternate !important;
    }

    @keyframes cyberPulse {
      0% {
        box-shadow:
          0 0 10px rgba(255, 200, 0, 0.3),
          0 0 20px rgba(255, 150, 0, 0.2),
          inset 0 0 15px rgba(255, 200, 0, 0.1);
        background: rgba(60, 40, 0, 0.7);
      }

      100% {
        box-shadow:
          0 0 20px rgba(255, 200, 0, 0.6),
          0 0 40px rgba(255, 150, 0, 0.4),
          0 0 60px rgba(255, 100, 0, 0.2),
          inset 0 0 25px rgba(255, 200, 0, 0.2);
        background: rgba(80, 60, 0, 0.8);
      }
    }

    .target-card:nth-child(2).warning-yellow::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #ffcc00, transparent);
      animation: borderScan 3s linear infinite;
    }

    @keyframes borderScan {
      0% {
        left: -100%;
        opacity: 0;
      }

      50% {
        opacity: 1;
      }

      100% {
        left: 100%;
        opacity: 0;
      }
    }

    .target-card:nth-child(2).warning-yellow .sparkle {
      background: #ffcc00 !important;
    }

    .target-card:nth-child(2).warning-yellow::after {
      content: "";
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffcc00, transparent 70%);
      animation: particleGlow 1.5s ease-in-out infinite alternate;
      filter: blur(1px);
    }

    @keyframes particleGlow {
      0% {
        transform: scale(0.8);
        opacity: 0.5;
        box-shadow: 0 0 10px #ffcc00;
      }

      100% {
        transform: scale(1.2);
        opacity: 1;
        box-shadow:
          0 0 20px #ffcc00,
          0 0 30px #ff9900;
      }
    }

    .target-card:nth-child(2).warning-yellow .card-title {
      color: #ffdd99 !important;
    }

    .target-card:nth-child(2).warning-yellow .card-value.special {
      color: #ffcc00 !important;
      text-shadow: 0 0 15px rgba(255, 204, 0, 0.8) !important;
      animation: textGlow 1.5s ease-in-out infinite alternate;
    }

    @keyframes textGlow {
      0% {
        text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
      }

      100% {
        text-shadow:
          0 0 20px rgba(255, 204, 0, 0.8),
          0 0 30px rgba(255, 153, 0, 0.6);
      }
    }

    .target-card:nth-child(2).warning-yellow .card-subtitle {
      color: #ffcc99 !important;
    }

    .target-card:nth-child(2).warning-red {
      background: rgba(60, 0, 0, 0.7) !important;
      border: 1px solid rgba(255, 50, 50, 0.8) !important;
      animation: redPulse 1.5s infinite alternate !important;
    }

    @keyframes redPulse {
      0% {
        box-shadow:
          0 0 15px rgba(255, 50, 50, 0.4),
          0 0 30px rgba(255, 0, 0, 0.3),
          inset 0 0 20px rgba(255, 50, 50, 0.2);
        background: rgba(60, 0, 0, 0.7);
      }

      100% {
        box-shadow:
          0 0 25px rgba(255, 50, 50, 0.7),
          0 0 50px rgba(255, 0, 0, 0.5),
          0 0 75px rgba(200, 0, 0, 0.3),
          inset 0 0 35px rgba(255, 50, 50, 0.3);
        background: rgba(80, 0, 0, 0.9);
      }
    }

    .target-card:nth-child(2).warning-red::before {
      animation: redBorderScan 2s linear infinite !important;
      background: linear-gradient(90deg,
          transparent,
          #ff3333,
          transparent) !important;
    }

    @keyframes redBorderScan {
      0% {
        left: -100%;
        opacity: 0;
      }

      50% {
        opacity: 1;
      }

      100% {
        left: 100%;
        opacity: 0;
      }
    }

    .target-card:nth-child(2).warning-red .sparkle {
      background: #ff3333 !important;
    }

    .target-card:nth-child(2).warning-red::after {
      background: radial-gradient(circle,
          #ff3333,
          transparent 70%) !important;
      animation: redParticleGlow 1s ease-in-out infinite alternate !important;
    }

    @keyframes redParticleGlow {
      0% {
        transform: scale(0.8);
        opacity: 0.6;
        box-shadow: 0 0 15px #ff3333;
      }

      100% {
        transform: scale(1.3);
        opacity: 1;
        box-shadow:
          0 0 25px #ff3333,
          0 0 40px #ff0000;
      }
    }

    .target-card:nth-child(2).warning-red .card-title {
      color: #ff9999 !important;
    }

    .target-card:nth-child(2).warning-red .card-value.special {
      color: #ff6666 !important;
      text-shadow: 0 0 20px rgba(255, 50, 50, 0.9) !important;
      animation: redTextGlow 1s ease-in-out infinite alternate !important;
    }

    @keyframes redTextGlow {
      0% {
        text-shadow: 0 0 15px rgba(255, 50, 50, 0.6);
      }

      100% {
        text-shadow:
          0 0 25px rgba(255, 50, 50, 0.9),
          0 0 40px rgba(255, 0, 0, 0.7);
      }
    }

    .target-card:nth-child(2).warning-red .card-subtitle {
      color: #ffaaaa !important;
    }

    /* ===== √î TH·ªúI H·∫†N KHI H·∫æT H·∫†N ===== */
    .target-card:nth-child(2).warning-expired {
      background: rgba(30, 30, 30, 0.7) !important;
      border: 1px solid rgba(100, 100, 100, 0.5) !important;
      /* animation: expiredPulse 3s infinite alternate !important; */
      /* ƒê√É T·∫ÆT HI·ªÜU ·ª®NG */
    }

    /* T·∫ÆT HO√ÄN TO√ÄN SCAN LINE */
    .target-card:nth-child(2).warning-expired .tc-scan {
      display: none !important;
      opacity: 0 !important;
      animation: none !important;
    }

    /* T·∫ÆT SPARKLES */
    .target-card:nth-child(2).warning-expired .sparkle {
      display: none !important;
    }

    /* CHUY·ªÇN M√ÄU ƒê∆Ø·ªúNG SPLINE SANG X√ÅM */
    .target-card:nth-child(2).warning-expired .tc-sep svg path:nth-child(3) {
      stroke: #666666 !important;
      opacity: 0.25 !important;
    }

    .target-card:nth-child(2).warning-expired .tc-sep svg path:nth-child(2) {
      stroke: #444444 !important;
      opacity: 0.15 !important;
    }

    .target-card:nth-child(2).warning-expired .tc-sep svg path:nth-child(4) {
      stroke: #888888 !important;
      opacity: 0.2 !important;
    }

    /* GI·∫¢M ƒê·ªò S√ÅNG ICON */
    .target-card:nth-child(2).warning-expired .tc-icon {
      opacity: 0.15 !important;
      color: #888888 !important;
    }

    /* ===== QUAN TR·ªåNG: CHUY·ªÇN T·∫§T C·∫¢ TEXT SANG M√ÄU X√ÅM ===== */

    /* Ti√™u ƒë·ªÅ "Th·ªùi h·∫°n" */
    .target-card:nth-child(2).warning-expired .card-title {
      color: #aaaaaa !important;
    }

    .target-card:nth-child(2).warning-expired .card-title i {
      color: #aaaaaa !important;
    }

    /* Th√°ng nƒÉm (JLPT N1) - ƒêANG M√ÄU V√ÄNG, CHUY·ªÇN SANG X√ÅM */
    .target-card:nth-child(2).warning-expired .card-value.special {
      color: #888888 !important;
      text-shadow: 0 0 10px rgba(136, 136, 136, 0.5) !important;
      animation: none !important;
    }

    /* D√≤ng "K·ª≥ thi th√°ng 7 nƒÉm 2026" */
    .target-card:nth-child(2).warning-expired .card-subtitle {
      color: #999999 !important;
    }

    /* D√≤ng "C√≤n ..." */
    .target-card:nth-child(2).warning-expired #examCountdown,
    .target-card:nth-child(2).warning-expired .card-subtitle:last-of-type {
      color: #999999 !important;
    }

    /* T·∫•t c·∫£ c√°c text kh√°c trong card (n·∫øu c√≥) */
    .target-card:nth-child(2).warning-expired div,
    .target-card:nth-child(2).warning-expired span,
    .target-card:nth-child(2).warning-expired p {
      color: #999999 !important;
    }

    /* ƒê·∫∑c bi·ªát cho c√°c ph·∫ßn t·ª≠ c√≥ th·ªÉ c√≥ m√†u ri√™ng */
    .target-card:nth-child(2).warning-expired [class*="card-"] {
      color: #999999 !important;
    }

    /* Gi·ªØ nguy√™n m√†u x√°m cho t·∫•t c·∫£, kh√¥ng c√≥ ngo·∫°i l·ªá */
    .target-card:nth-child(2).warning-expired * {
      color: #999999 !important;
      border-color: #666666 !important;
      text-shadow: none !important;
    }

    @keyframes expiredPulse {
      0% {
        box-shadow:
          0 0 5px rgba(100, 100, 100, 0.3),
          inset 0 0 10px rgba(100, 100, 100, 0.1);
        background: rgba(30, 30, 30, 0.7);
      }

      100% {
        box-shadow:
          0 0 10px rgba(100, 100, 100, 0.5),
          inset 0 0 15px rgba(100, 100, 100, 0.2);
        background: rgba(40, 40, 40, 0.8);
      }
    }

    /* ====== STATUS WARNING STATE (gi·ªØ nguy√™n) ====== */
    .target-card:nth-child(3) {
      position: relative;
      overflow: hidden;
    }

    .target-card:nth-child(3)::before,
    .target-card:nth-child(3)::after {
      display: none !important;
    }

    .target-card:nth-child(3) .sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      filter: blur(1px);
      animation: sparkleMove 4s linear infinite;
      opacity: 0.7;
      display: none;
    }

    .target-card:nth-child(3) .sparkle:nth-child(1) {
      top: 20%;
      left: 15%;
      animation-delay: 0s;
    }

    .target-card:nth-child(3) .sparkle:nth-child(2) {
      top: 60%;
      right: 20%;
      animation-delay: 1s;
    }

    .target-card:nth-child(3) .sparkle:nth-child(3) {
      bottom: 30%;
      left: 30%;
      animation-delay: 2s;
    }

    .target-card:nth-child(3).warning-yellow::before,
    .target-card:nth-child(3).warning-yellow::after,
    .target-card:nth-child(3).warning-red::before,
    .target-card:nth-child(3).warning-red::after,
    .target-card:nth-child(3).warning-expired::before,
    .target-card:nth-child(3).warning-expired::after {
      display: block !important;
    }

    .target-card:nth-child(3).warning-yellow .sparkle,
    .target-card:nth-child(3).warning-red .sparkle,
    .target-card:nth-child(3).warning-expired .sparkle {
      display: block !important;
    }

    .target-card:nth-child(3).warning-yellow {
      background: rgba(60, 40, 0, 0.7) !important;
      border: 1px solid rgba(255, 200, 0, 0.6) !important;
      animation: cyberPulse 2s infinite alternate !important;
    }

    .target-card:nth-child(3).warning-yellow::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #ffcc00, transparent);
      animation: borderScan 3s linear infinite;
    }

    .target-card:nth-child(3).warning-yellow .sparkle {
      background: #ffcc00 !important;
    }

    .target-card:nth-child(3).warning-yellow::after {
      content: "";
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffcc00, transparent 70%);
      animation: particleGlow 1.5s ease-in-out infinite alternate;
      filter: blur(1px);
    }

    .target-card:nth-child(3).warning-yellow .card-title {
      color: #ffdd99 !important;
    }

    .target-card:nth-child(3).warning-yellow .card-value {
      color: #ffcc00 !important;
      text-shadow: 0 0 15px rgba(255, 204, 0, 0.8) !important;
      animation: textGlow 1.5s ease-in-out infinite alternate !important;
    }

    .target-card:nth-child(3).warning-yellow .card-subtitle {
      color: #ffcc99 !important;
    }

    .target-card:nth-child(3).warning-red {
      background: rgba(60, 0, 0, 0.7) !important;
      border: 1px solid rgba(255, 50, 50, 0.8) !important;
      animation: redPulse 1.5s infinite alternate !important;
    }

    .target-card:nth-child(3).warning-red::before {
      animation: redBorderScan 2s linear infinite !important;
      background: linear-gradient(90deg,
          transparent,
          #ff3333,
          transparent) !important;
    }

    .target-card:nth-child(3).warning-red .sparkle {
      background: #ff3333 !important;
    }

    .target-card:nth-child(3).warning-red::after {
      background: radial-gradient(circle,
          #ff3333,
          transparent 70%) !important;
      animation: redParticleGlow 1s ease-in-out infinite alternate !important;
    }

    .target-card:nth-child(3).warning-red .card-title {
      color: #ff9999 !important;
    }

    .target-card:nth-child(3).warning-red .card-value {
      color: #ff6666 !important;
      text-shadow: 0 0 20px rgba(255, 50, 50, 0.9) !important;
      animation: redTextGlow 1s ease-in-out infinite alternate !important;
    }

    .target-card:nth-child(3).warning-red .card-subtitle {
      color: #ffaaaa !important;
    }

    .target-card:nth-child(3).warning-expired {
      background: rgba(30, 30, 30, 0.7) !important;
      border: 1px solid rgba(100, 100, 100, 0.5) !important;
      animation: expiredPulse 3s infinite alternate !important;
    }

    .target-card:nth-child(3).warning-expired::before {
      animation: expiredBorderScan 4s linear infinite !important;
      background: linear-gradient(90deg,
          transparent,
          #888888,
          transparent) !important;
    }

    .target-card:nth-child(3).warning-expired .sparkle {
      background: #888888 !important;
    }

    .target-card:nth-child(3).warning-expired::after {
      background: radial-gradient(circle,
          #888888,
          transparent 70%) !important;
      animation: expiredParticleGlow 2s ease-in-out infinite alternate !important;
    }

    @keyframes expiredParticleGlow {
      0% {
        transform: scale(0.7);
        opacity: 0.3;
        box-shadow: 0 0 5px #888888;
      }

      100% {
        transform: scale(1);
        opacity: 0.5;
        box-shadow: 0 0 10px #888888;
      }
    }

    .target-card:nth-child(3).warning-expired .card-title {
      color: #aaaaaa !important;
    }

    .target-card:nth-child(3).warning-expired .card-value {
      color: #888888 !important;
      text-shadow: 0 0 10px rgba(136, 136, 136, 0.5) !important;
      animation: none !important;
    }

    .target-card:nth-child(3).warning-expired .card-subtitle {
      color: #999999 !important;
    }

    /* ===== TEST MODAL (B√ÄI KI·ªÇM TRA) ===== */
    .test-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(2, 8, 18, 0.85);
      backdrop-filter: blur(12px);
      z-index: 10000;
      display: none;
      opacity: 0;
      transition: opacity 220ms ease;
    }

    .test-modal-backdrop.show {
      display: block;
      opacity: 1;
    }

    .test-modal-frame {
      width: min(700px, calc(100vw - 60px));
      height: min(600px, calc(100vh - 140px));
      background: rgba(8, 20, 40, 0.95);
      border: 2px solid #00a8ff;
      border-radius: 15px;
      padding: 20px;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0.92);
      opacity: 0;
      z-index: 10001;
      display: none;
      backdrop-filter: blur(15px);
      overflow: hidden;
      box-shadow:
        0 15px 40px rgba(0, 0, 0, 0.9),
        0 0 30px rgba(0, 168, 255, 0.5);
      flex-direction: column;
    }

    .test-modal-frame.show {
      display: flex;
      animation: testModalIn 300ms cubic-bezier(0.2, 1.05, 0.35, 1) forwards;
    }

    @keyframes testModalIn {
      0% {
        opacity: 0;
        transform: translate(-50%, -48%) scale(0.9);
      }

      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .test-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0, 168, 255, 0.3);
      margin-bottom: 15px;
    }

    .test-modal-title {
      font-family: "Orbitron", sans-serif;
      font-size: 18px;
      color: #00e5ff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .test-modal-close {
      background: rgba(255, 50, 50, 0.2);
      border: 1px solid rgba(255, 50, 50, 0.5);
      color: #ff6666;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.25s;
      font-size: 13px;
    }

    .test-modal-close:hover {
      background: rgba(255, 50, 50, 0.4);
      box-shadow: 0 0 10px rgba(255, 50, 50, 0.4);
      transform: translateY(-1px);
    }

    .test-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .test-list::-webkit-scrollbar {
      width: 6px;
    }

    .test-list::-webkit-scrollbar-track {
      background: rgba(0, 30, 60, 0.3);
      border-radius: 3px;
    }

    .test-list::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, #00a8ff, #00ffcc);
      border-radius: 3px;
    }

    .test-item {
      background: rgba(0, 40, 80, 0.4);
      border: 1px solid rgba(0, 168, 255, 0.2);
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.25s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .test-item:hover {
      background: rgba(0, 80, 120, 0.5);
      border-color: #00a8ff;
      transform: translateX(5px);
      box-shadow: 0 5px 15px rgba(0, 100, 255, 0.3);
    }

    .test-item-icon {
      width: 40px;
      height: 40px;
      background: rgba(0, 150, 200, 0.2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #00ffcc;
      font-size: 18px;
    }

    .test-item-content {
      flex: 1;
    }

    .test-item-title {
      font-weight: 600;
      color: #e0f7ff;
      margin-bottom: 5px;
      font-size: 15px;
    }

    .test-item-meta {
      display: flex;
      gap: 15px;
      font-size: 12px;
      color: #88d3ff;
    }

    .test-item-meta i {
      margin-right: 4px;
      color: #ff9900;
    }

    .test-status-badge {
      background: rgba(0, 200, 100, 0.2);
      border: 1px solid rgba(0, 255, 100, 0.3);
      color: #00ff99;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
    }

    /* Kh√≥a scroll ngo√†i khi m·ªü popup */
    body.modal-open {
      overflow: hidden;
    }

    /* (Tu·ª≥ ch·ªçn) m∆∞·ª£t h∆°n tr√™n mobile */
    body.modal-open {
      touch-action: none;
    }

    /* Unit tabs cho Mimikara */
    .unit-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      padding: 10px;
      background: rgba(0, 30, 60, 0.5);
      border-radius: 12px;
      border: 1px solid rgba(0, 150, 255, 0.2);
    }

    .unit-tab {
      padding: 8px 16px;
      background: rgba(0, 40, 80, 0.6);
      border: 1px solid rgba(0, 150, 255, 0.3);
      border-radius: 8px;
      color: #88d3ff;
      font-family: "Orbitron", sans-serif;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.25s;
    }

    .unit-tab:hover {
      background: rgba(0, 80, 120, 0.6);
      border-color: #00a8ff;
      transform: translateY(-2px);
    }

    .unit-tab.active {
      background: linear-gradient(135deg, #0066cc, #00a8ff);
      border-color: #00ffcc;
      color: white;
      box-shadow: 0 0 15px rgba(0, 168, 255, 0.5);
    }

    /* ƒêi·ªÅu ch·ªânh kho·∫£ng c√°ch cho test items */
    .test-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      /* TƒÉng gap l√™n 12px ƒë·ªÉ t·∫°o kho·∫£ng c√°ch gi·ªØa c√°c √¥ */
    }

    .test-item {
      background: rgba(0, 40, 80, 0.4);
      border: 1px solid rgba(0, 168, 255, 0.2);
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.25s;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 0;
      /* X√≥a margin bottom n·∫øu c√≥ */
    }

    /* Container cho tests trong Mimikara */
    .tests-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
      /* T·∫°o kho·∫£ng c√°ch gi·ªØa c√°c test items */
      margin-top: 15px;
    }

    /* ƒê·∫£m b·∫£o test items trong tests-container c≈©ng c√≥ kho·∫£ng c√°ch */
    .tests-container .test-item {
      margin-bottom: 0;
      width: 100%;
    }

    /* Gi·ªØ nguy√™n style cho unit tabs */
    .unit-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      padding: 10px;
      background: rgba(0, 30, 60, 0.5);
      border-radius: 12px;
      border: 1px solid rgba(0, 150, 255, 0.2);
    }

    .unit-tab {
      padding: 8px 16px;
      background: rgba(0, 40, 80, 0.6);
      border: 1px solid rgba(0, 150, 255, 0.3);
      border-radius: 8px;
      color: #88d3ff;
      font-family: "Orbitron", sans-serif;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.25s;
    }

    .unit-tab:hover {
      background: rgba(0, 80, 120, 0.6);
      border-color: #00a8ff;
      transform: translateY(-2px);
    }

    .unit-tab.active {
      background: linear-gradient(135deg, #0066cc, #00a8ff);
      border-color: #00ffcc;
      color: white;
      box-shadow: 0 0 15px rgba(0, 168, 255, 0.5);
    }

    /* ===== SKELETON LOADING ===== */
    .skeleton-container {
      width: 100%;
      animation: skeleton-fade 1.5s ease-in-out infinite;
    }

    .skeleton-item {
      background: linear-gradient(90deg,
          rgba(0, 40, 80, 0.3) 25%,
          rgba(0, 80, 120, 0.5) 50%,
          rgba(0, 40, 80, 0.3) 75%);
      background-size: 200% 100%;
      animation: skeleton-shimmer 1.5s infinite;
      border-radius: 10px;
      height: 90px;
      margin-bottom: 12px;
      border: 1px solid rgba(0, 150, 255, 0.2);
    }

    .skeleton-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: rgba(0, 100, 200, 0.3);
      float: left;
      margin: 15px;
    }

    .skeleton-line {
      height: 16px;
      background: rgba(0, 100, 200, 0.2);
      margin: 15px 15px 15px 70px;
      border-radius: 4px;
    }

    .skeleton-line.short {
      width: 60%;
    }

    @keyframes skeleton-shimmer {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    @keyframes skeleton-fade {

      0%,
      100% {
        opacity: 0.7;
      }

      50% {
        opacity: 1;
      }
    }

    .loading-text {
      text-align: center;
      padding: 30px;
      color: var(--secondary-glow);
      font-family: "Orbitron", sans-serif;
      font-size: 14px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    /* ================= CYBER LOADING ================= */

    .cyber-loading {
      position: fixed;
      inset: 0;
      background: rgba(2, 8, 18, 0.85);
      backdrop-filter: blur(12px);
      z-index: 20000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .cyber-loading.show {
      display: flex;
    }

    .cyber-loading-box {
      width: 420px;
      padding: 30px;
      border: 2px solid #00a8ff;
      border-radius: 14px;
      background: rgba(0, 20, 40, 0.95);
      text-align: center;
      box-shadow:
        0 0 25px rgba(0, 168, 255, 0.7),
        0 0 60px rgba(0, 100, 255, 0.4);
      animation: cyberGlow 2s infinite alternate;
    }

    @keyframes cyberGlow {
      0% {
        box-shadow: 0 0 20px rgba(0, 168, 255, 0.6);
      }

      100% {
        box-shadow: 0 0 50px rgba(0, 255, 204, 0.8);
      }
    }

    .cyber-loading-title {
      font-family: "Orbitron", sans-serif;
      font-size: 20px;
      letter-spacing: 2px;
      color: #00ffcc;
      margin-bottom: 20px;
      text-shadow: 0 0 15px rgba(0, 255, 204, 0.8);
      animation: cyberTextPulse 1.5s infinite alternate;
    }

    @keyframes cyberTextPulse {
      0% {
        opacity: 0.6;
      }

      100% {
        opacity: 1;
      }
    }

    .cyber-loading-bar {
      height: 8px;
      background: rgba(0, 50, 100, 0.4);
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 15px;
    }

    .cyber-loading-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, #0066cc, #00ffcc);
      transition: width 120ms linear;
      /* ch·∫°y m∆∞·ª£t theo % */
    }

    @keyframes cyberBarMove {
      0% {
        width: 0%;
      }

      50% {
        width: 100%;
      }

      100% {
        width: 0%;
      }
    }

    .cyber-loading-sub {
      font-size: 12px;
      color: #88d3ff;
      letter-spacing: 1px;
    }

    /* ===== STREAK DASHBOARD M·ªöI ===== */
    .streak-dashboard {
      background: rgba(0, 30, 60, 0.7);
      border-radius: 16px;
      padding: 25px;
      margin-top: 20px;
      border: 1px solid rgba(255, 153, 0, 0.3);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .streak-dashboard::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg,
          transparent 30%,
          rgba(255, 153, 0, 0.1) 50%,
          transparent 70%);
      animation: shine 3s infinite;
      pointer-events: none;
    }

    .streak-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 153, 0, 0.3);
    }

    .streak-title {
      font-family: "Orbitron", sans-serif;
      font-size: 20px;
      color: #ff9900;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .streak-badge {
      font-family: "Orbitron", sans-serif;
      font-size: 24px;
      font-weight: 900;
      color: #ffcc00;
      text-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
      background: rgba(0, 0, 0, 0.3);
      padding: 5px 15px;
      border-radius: 30px;
      border: 1px solid rgba(255, 204, 0, 0.3);
      animation: glowPulse 2s infinite;
    }

    @keyframes glowPulse {
      0% {
        box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
      }

      50% {
        box-shadow: 0 0 20px rgba(255, 204, 0, 0.7);
      }

      100% {
        box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
      }
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    .column-header {
      margin-bottom: 15px;
    }

    .column-title {
      font-family: "Orbitron", sans-serif;
      font-size: 16px;
      color: #00e5ff;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
    }

    .column-subtitle {
      font-size: 12px;
      color: #88d3ff;
      padding-left: 26px;
    }

    .task-list {
      min-height: 180px;
      max-height: 220px;
      overflow-y: auto;
      padding-right: 5px;
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
    }

    /* ƒê·∫£m b·∫£o c√°c item c√≥ margin bottom ƒë·ªÅu nhau */
    .task-item,
    .task-placeholder {
      margin-bottom: 8px;
    }

    /* Item cu·ªëi c√πng (placeholder) c≈©ng c√≥ margin bottom */
    .task-list> :last-child {
      margin-bottom: 0;
      /* Kh√¥ng margin ·ªü item cu·ªëi v√¨ ƒë√£ c√≥ padding c·ªßa container */
    }

    /* ===== CUSTOM SCROLLBAR GI·ªêNG THAOLEJP ===== */
    .task-list::-webkit-scrollbar {
      width: 10px;
      /* TƒÉng t·ª´ 5px l√™n 10px */
    }

    .task-list::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.25);
      /* M√†u t·ªëi h∆°n */
      border-radius: 10px;
      /* Bo tr√≤n h∆°n */
      margin: 2px 0;
      /* Kho·∫£ng c√°ch tr√™n d∆∞·ªõi */
    }

    .task-list::-webkit-scrollbar-thumb {
      background: rgba(0, 255, 204, 0.35);
      /* M√†u xanh cyan trong su·ªët */
      border-radius: 10px;
      /* Bo tr√≤n ho√†n to√†n */
      border: 2px solid rgba(0, 18, 36, 0.98);
      /* Vi·ªÅn t·ªëi t·∫°o hi·ªáu ·ª©ng n·ªïi */
      background-clip: padding-box;
      /* Gi·ªØ border trong su·ªët */
    }

    /* Hover v√†o scrollbar */
    .task-list::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 255, 204, 0.6);
      /* S√°ng h∆°n khi hover */
    }

    /* Thanh cu·ªôn ngang (n·∫øu c√≥) */
    .task-list::-webkit-scrollbar-corner {
      background: transparent;
    }

    .task-item {
      background: rgba(0, 40, 80, 0.4);
      border: 1px solid rgba(255, 153, 0, 0.2);
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .task-item:hover {
      background: rgba(0, 80, 160, 0.5);
      /* ƒê·ªïi t·ª´ cam sang xanh */
      border-color: #00a8ff;
      transform: translateX(5px);
    }

    .task-item.completed {
      background: rgba(0, 80, 40, 0.3);
      border-color: #00ff99;
      opacity: 0.9;
    }

    .task-checkbox {
      width: 22px;
      height: 22px;
      border-radius: 6px;
      border: 2px solid #00a8ff;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #00ff99;
      font-size: 14px;
      transition: all 0.3s;
    }

    .task-item.completed .task-checkbox {
      background: #00ff99;
      border-color: #00ff99;
      color: #0a0e17;
    }

    .task-bullet {
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ff9900;
      font-size: 20px;
      font-weight: bold;
    }

    .task-content {
      flex: 1;
    }

    .task-name {
      font-size: 14px;
      color: #e0f7ff;
    }

    .task-item.completed .task-name {
      text-decoration: line-through;
      color: #88d3ff;
    }

    .next-task .task-name {
      color: #a0c8e0;
    }

    /* Add task placeholder */
    .add-task-placeholder {
      padding: 10px 12px;
      color: #88d3ff;
      font-style: italic;
      cursor: pointer;
      border: 1px dashed rgba(255, 153, 0, 0.3);
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s;
    }

    .add-task-placeholder:hover {
      background: rgba(0, 60, 100, 0.3);
      border-color: #ff9900;
      color: #00e5ff;
    }

    .add-task-placeholder i {
      font-size: 18px;
      color: #ff9900;
    }

    .add-task-placeholder em {
      font-style: italic;
      font-size: 14px;
    }

    /* Task Progress */
    .task-progress {
      margin-top: 10px;
    }

    .progress-bar {
      height: 8px;
      background: rgba(0, 50, 100, 0.5);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, #0066cc, #00a8ff, #00ffcc);
      border-radius: 4px;
      width: 0%;
      transition: width 0.4s ease;
      box-shadow: 0 0 10px rgba(0, 168, 255, 0.5);
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: #88d3ff;
    }

    /* Stats row */
    .stats-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(0, 20, 40, 0.5);
      border-radius: 12px;
      margin-bottom: 15px;
      border: 1px solid rgba(255, 153, 0, 0.2);
    }

    .stats-summary {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 14px;
      color: #a0c8e0;
      flex-wrap: wrap;
    }

    .stats-summary i {
      color: #ff9900;
      font-size: 16px;
    }

    .stats-summary strong {
      color: #00ffcc;
      font-size: 16px;
    }

    .divider {
      color: #ff9900;
      opacity: 0.5;
    }

    .history-btn {
      background: linear-gradient(135deg, #0066cc, #00a8ff);
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      color: white;
      font-family: "Orbitron", sans-serif;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .history-btn:hover {
      background: linear-gradient(135deg, #00a8ff, #00ffcc);
      box-shadow: 0 0 20px rgba(0, 168, 255, 0.5);
      transform: translateY(-2px);
    }

    .history-btn i:last-child {
      font-size: 12px;
    }

    /* Activation footer */
    .activation-footer {
      background: linear-gradient(135deg,
          rgba(0, 102, 204, 0.2),
          rgba(0, 168, 255, 0.2));
      border: 1px solid rgba(0, 168, 255, 0.3);
      border-radius: 30px;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: #88d3ff;
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(5px);
    }

    .activation-footer i {
      color: #ffcc00;
      font-size: 16px;
      animation: boltPulse 1.5s infinite;
    }

    @keyframes boltPulse {
      0% {
        opacity: 0.7;
        transform: scale(1);
      }

      50% {
        opacity: 1;
        transform: scale(1.1);
        color: #ffaa00;
      }

      100% {
        opacity: 0.7;
        transform: scale(1);
      }
    }

    /* N√∫t x√≥a task */
    .task-delete {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(255, 50, 50, 0.2);
      border: 1px solid rgba(255, 50, 50, 0.3);
      color: #ff6666;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      opacity: 0;
      transition: all 0.3s;
      margin-left: 5px;
    }

    .task-item:hover .task-delete {
      opacity: 1;
    }

    .task-delete:hover {
      background: rgba(255, 50, 50, 0.4);
      border-color: #ff3333;
      color: #ff3333;
      transform: scale(1.1);
    }

    .task-delete i {
      pointer-events: none;
    }

    /* Placeholder nh∆∞ m·ªôt task b√¨nh th∆∞·ªùng */
    .task-placeholder {
      background: rgba(0, 40, 80, 0.3);
      border: 1px dashed rgba(0, 168, 255, 0.5);
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.3s;
      color: #88d3ff;
      font-style: italic;
      min-height: 46px;
      /* C√πng chi·ªÅu cao v·ªõi task item */
    }

    .task-placeholder:hover {
      background: rgba(0, 60, 100, 0.5);
      border-color: #00a8ff;
      color: #00e5ff;
      transform: translateX(5px);
    }

    .task-placeholder i {
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #00a8ff;
      font-size: 18px;
    }

    .task-placeholder .placeholder-icon {
      margin-left: auto;
      font-size: 12px;
      opacity: 0.7;
    }

    /* Animation cho placeholder m·ªõi */
    @keyframes placeholderPulse {
      0% {
        border-color: rgba(0, 168, 255, 0.3);
      }

      50% {
        border-color: rgba(0, 255, 204, 0.8);
      }

      100% {
        border-color: rgba(0, 168, 255, 0.3);
      }
    }

    .task-placeholder.new {
      animation: placeholderPulse 1.5s infinite;
    }

    /* =========================================================
         TARGET CARDS ‚Äî HUD redesign (3 √¥ ƒë·∫ßu)
      ========================================================= */

    /* Override base target-card */
    .target-info .target-card {
      position: relative;
      flex: 1;
      min-width: 220px;
      height: 130px;
      background: rgba(4, 13, 26, 0.92);
      border-radius: 10px;
      border: 1.5px solid rgba(0, 210, 255, 0.22);
      overflow: hidden;
      padding: 0;
      cursor: pointer;
      transition: border-color .35s ease, box-shadow .35s ease, transform .4s cubic-bezier(.23, 1, .32, 1);
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, .5),
        0 6px 24px rgba(0, 0, 0, .6),
        inset 0 1px 0 rgba(0, 230, 255, .08);
    }

    .target-info .target-card:hover {
      transform: translateY(-4px) scale(1.01);
      border-color: rgba(0, 230, 255, .6);
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, .5),
        0 0 30px rgba(0, 200, 255, .18),
        0 12px 32px rgba(0, 0, 0, .7),
        inset 0 1px 0 rgba(0, 240, 255, .14);
    }

    /* top glow bar */
    .target-info .target-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg,
          transparent 0%,
          rgba(0, 220, 255, .5) 20%,
          rgba(0, 255, 240, .9) 50%,
          rgba(0, 220, 255, .5) 80%,
          transparent 100%);
      box-shadow: 0 0 10px rgba(0, 240, 255, .7);
      opacity: .6;
      transition: opacity .35s;
      z-index: 20;
    }

    .target-info .target-card:hover::before {
      opacity: 1;
    }

    /* remove old ::after */
    .target-info .target-card::after {
      display: none;
    }

    /* corner brackets */
    .target-info .target-card .tc-corner {
      position: absolute;
      width: 14px;
      height: 14px;
      border-color: rgba(0, 210, 255, .4);
      border-style: solid;
      z-index: 22;
      transition: border-color .35s;
    }

    .target-info .target-card:hover .tc-corner {
      border-color: rgba(0, 230, 255, .75);
    }

    .target-info .target-card .tc-corner.tl {
      top: 7px;
      left: 7px;
      border-width: 1.5px 0 0 1.5px;
      border-radius: 3px 0 0 0;
    }

    .target-info .target-card .tc-corner.tr {
      top: 7px;
      right: 7px;
      border-width: 1.5px 1.5px 0 0;
      border-radius: 0 3px 0 0;
    }

    .target-info .target-card .tc-corner.bl {
      bottom: 7px;
      left: 7px;
      border-width: 0 0 1.5px 1.5px;
      border-radius: 0 0 0 3px;
    }

    .target-info .target-card .tc-corner.br {
      bottom: 7px;
      right: 7px;
      border-width: 0 1.5px 1.5px 0;
      border-radius: 0 0 3px 0;
    }

    /* left content zone */
    .target-info .target-card .tc-left {
      position: relative;
      z-index: 10;
      padding: 16px 18px;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 58%;
    }

    /* card-title override */
    .target-info .target-card .card-title {
      font-size: 10.5px;
      font-weight: 500;
      letter-spacing: 2px;
      color: rgba(160, 220, 255, .7);
      text-transform: uppercase;
      margin-bottom: 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .target-info .target-card .card-title i {
      font-size: 11px;
      color: rgba(0, 210, 255, .8);
    }

    /* card-value override */
    .target-info .target-card .card-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 22px;
      font-weight: 900;
      color: #00e8ff;
      text-shadow: 0 0 14px rgba(0, 230, 255, .65), 0 0 30px rgba(0, 200, 255, .25);
      line-height: 1.1;
      letter-spacing: 1px;
      transition: text-shadow .35s;
    }

    .target-info .target-card:hover .card-value {
      text-shadow: 0 0 20px rgba(0, 240, 255, .9), 0 0 50px rgba(0, 210, 255, .4);
    }

    .target-info .target-card .card-value.special {
      color: #ffd060;
      text-shadow: 0 0 14px rgba(255, 200, 60, .65), 0 0 30px rgba(255, 160, 0, .25);
    }

    .target-info .target-card:hover .card-value.special {
      text-shadow: 0 0 20px rgba(255, 210, 80, .9), 0 0 50px rgba(255, 160, 0, .4);
    }

    /* card-subtitle */
    .target-info .target-card .card-subtitle {
      font-size: 11px;
      color: rgba(140, 200, 240, .55);
      margin-top: 0;
      letter-spacing: .3px;
      line-height: 1.5;
    }

    /* active dot badge */
    .target-info .target-card .tc-active-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #00ffb0;
      box-shadow: 0 0 8px #00ffb0, 0 0 16px rgba(0, 255, 176, .4);
      display: inline-block;
      animation: tcBlink 2.2s ease-in-out infinite;
      margin-right: 5px;
      vertical-align: middle;
    }

    @keyframes tcBlink {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: .25
      }
    }

    /* right canvas panel */
    .target-info .target-card .tc-right {
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      z-index: 5;
      overflow: hidden;
      pointer-events: none;
    }

    .target-info .target-card .tc-right canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .target-info .target-card .tc-right .tc-fade {
      position: absolute;
      top: 0;
      left: 0;
      width: 40%;
      height: 100%;
      background: linear-gradient(90deg, rgba(4, 13, 26, 1) 0%, rgba(4, 13, 26, .9) 40%, rgba(4, 13, 26, .4) 70%, rgba(4, 13, 26, 0) 100%);
      z-index: 9;
    }

    .target-info .target-card .tc-right .tc-sep {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      pointer-events: none;
    }

    .target-info .target-card .tc-right .tc-sep svg {
      width: 100%;
      height: 100%;
      overflow: visible;
    }

    .target-info .target-card .tc-right .tc-scan {
      position: absolute;
      left: 0;
      right: 0;
      height: 1.5px;
      background: linear-gradient(90deg, transparent, rgba(0, 230, 220, .8) 40%, rgba(0, 230, 220, .8) 60%, transparent);
      filter: drop-shadow(0 0 4px rgba(0, 230, 220, .9));
      z-index: 11;
      animation: tcScan 3.5s ease-in-out infinite;
      opacity: 0;
      transition: opacity .3s;
    }

    .target-info .target-card:hover .tc-right .tc-scan {
      opacity: 1;
    }

    @keyframes tcScan {
      0% {
        top: -2px;
        opacity: 0
      }

      4% {
        opacity: 1
      }

      96% {
        opacity: .6
      }

      100% {
        top: 100%;
        opacity: 0
      }
    }

    /* small decorative icon bottom-right */
    .target-info .target-card .tc-icon {
      position: absolute;
      bottom: 10px;
      right: 12px;
      font-size: 36px;
      opacity: .1;
      z-index: 12;
      color: #00e8ff;
      transition: opacity .35s;
      pointer-events: none;
      line-height: 1;
    }

    .target-info .target-card:hover .tc-icon {
      opacity: .18;
    }

    /* L·ªåC M√ÄU C√ÅC √î VU√îNG SANG X√ÅM KHI H·∫æT H·∫†N */
    .target-card:nth-child(2).warning-expired #tcCanvas1 {
      filter: grayscale(100%) brightness(0.7) !important;
      opacity: 0.8 !important;
    }

    /* =========================================================
       TC-RING ‚Äî v√≤ng tr√≤n ng√†y c√≤n l·∫°i (√¥ Th·ªùi h·∫°n & Tr·∫°ng th√°i)
       chu vi r=38: 2œÄ√ó38 ‚âà 238.76
    ========================================================= */
    .tc-ring {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      /* d·ªãch l√™n tr√™n ƒë·ªÉ tr√°nh icon g√≥c ph·∫£i d∆∞·ªõi */
      width: 96px;
      height: 96px;
      z-index: 13;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ ring cho √¥ Th·ªùi h·∫°n (d·ªãch sang tr√°i v√† xu·ªëng d∆∞·ªõi) */
    #tcCard1 .tc-ring {
      right: 50px;
      /* TƒÉng t·ª´ 10px l√™n 25px ƒë·ªÉ d·ªãch sang tr√°i */
      top: 50%;
      /* D·ªãch xu·ªëng d∆∞·ªõi 5% */
    }

    /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ ring cho √¥ Tr·∫°ng th√°i (d·ªãch sang tr√°i v√† xu·ªëng d∆∞·ªõi) */
    #tcCard2 .tc-ring {
      right: 50px;
      /* TƒÉng t·ª´ 10px l√™n 25px ƒë·ªÉ d·ªãch sang tr√°i */
      top: 50%;
      /* D·ªãch xu·ªëng d∆∞·ªõi 5% */
    }

    .tc-ring-svg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
      /* b·∫Øt ƒë·∫ßu t·ª´ ƒë·ªânh tr√™n */
    }

    .tc-ring-track {
      fill: none;
      stroke: rgba(255, 255, 255, .06);
      stroke-width: 5;
    }

    .tc-ring-fill {
      fill: none;
      stroke-width: 5;
      stroke-linecap: round;
      stroke-dasharray: 238.76;
      stroke-dashoffset: 238.76;
      transition: stroke-dashoffset 1.4s cubic-bezier(.23, 1, .32, 1);
    }

    .tc-ring-fill--yellow {
      stroke: #ffd060;
      filter: drop-shadow(0 0 5px rgba(255, 200, 60, .8));
    }

    .tc-ring-fill--green {
      stroke: #00ffb0;
      filter: drop-shadow(0 0 5px rgba(0, 255, 176, .8));
    }

    .tc-ring-glow {
      fill: none;
      stroke-width: 10;
      stroke-linecap: round;
      stroke-dasharray: 238.76;
      stroke-dashoffset: 238.76;
      transition: stroke-dashoffset 1.4s cubic-bezier(.23, 1, .32, 1);
    }

    .tc-ring-glow--yellow {
      stroke: rgba(255, 200, 60, .15);
    }

    .tc-ring-glow--green {
      stroke: rgba(0, 255, 176, .15);
    }

    .tc-ring-inner {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .tc-ring-days {
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      font-weight: 700;
      line-height: 1;
    }

    #tcRingDays1 {
      color: #ffd060;
      text-shadow: 0 0 10px rgba(255, 200, 60, .7);
    }

    #tcRingDays2 {
      color: #00ffb0;
      text-shadow: 0 0 10px rgba(0, 255, 176, .7);
    }

    .tc-ring-label {
      font-size: 8.5px;
      letter-spacing: 1.5px;
      color: rgba(180, 230, 255, .4);
      text-transform: uppercase;
      line-height: 1;
    }

    /* hover: glow s√°ng h∆°n */
    #tcCard1:hover .tc-ring-fill--yellow {
      filter: drop-shadow(0 0 9px rgba(255, 210, 60, 1));
    }

    #tcCard2:hover .tc-ring-fill--green {
      filter: drop-shadow(0 0 9px rgba(0, 255, 176, 1));
    }

    /* ===== CƒÇN CH·ªàNH CHI·ªÄU R·ªòNG TASK GI·ªÆA 2 C·ªòT ===== */

    /* 1. GI·ªÆ NGUY√äN K√çCH TH∆Ø·ªöC BAN ƒê·∫¶U, CH·ªà ƒê·∫¢M B·∫¢O 2 C·ªòT B·∫∞NG NHAU */
    .dashboard-grid {
      grid-template-columns: 1fr 1fr !important;
      /* 2 c·ªôt b·∫±ng nhau */
      gap: 25px;
    }

    /* 2. KH√îNG ƒê·∫∂T min-width, max-width - GI·ªÆ K√çCH TH∆Ø·ªöC T·ª∞ NHI√äN BAN ƒê·∫¶U */
    .current-tasks .task-item,
    .next-tasks .task-item {
      width: 100%;
      /* Chi·∫øm to√†n b·ªô chi·ªÅu r·ªông c·ªôt */
      box-sizing: border-box;
      /* T√≠nh k√≠ch th∆∞·ªõc bao g·ªìm padding */
      /* KH√îNG ƒë·∫∑t min-width, max-width - gi·ªØ k√≠ch th∆∞·ªõc t·ª± nhi√™n */
    }

    /* 3. PH·∫¶N N·ªòI DUNG TEXT - Chi·∫øm kh√¥ng gian linh ho·∫°t */
    .current-tasks .task-content,
    .next-tasks .task-content {
      flex: 1;
      /* Chi·∫øm to√†n b·ªô kh√¥ng gian c√≤n l·∫°i */
      min-width: 0;
      /* Cho ph√©p co nh·ªè h∆°n n·ªôi dung */
      overflow: hidden;
      /* ·∫®n ph·∫ßn tr√†n */
    }

    /* 4. X·ª¨ L√ù TEXT D√ÄI - C·∫Øt v·ªõi d·∫•u "..." thay v√¨ xu·ªëng d√≤ng */
    .task-name {
      white-space: nowrap;
      /* Kh√¥ng xu·ªëng d√≤ng */
      overflow: hidden;
      /* ·∫®n ph·∫ßn text th·ª´a */
      text-overflow: ellipsis;
      /* Th√™m d·∫•u "..." ·ªü cu·ªëi */
      display: block;
      /* Hi·ªÉn th·ªã d·∫°ng block */
    }

    /* 5. GI·ªÆ K√çCH TH∆Ø·ªöC C·ªê ƒê·ªäNH CHO CHECKBOX, BULLET, N√öT X√ìA */
    .current-tasks .task-checkbox,
    .next-tasks .task-bullet {
      width: 22px;
      height: 22px;
      flex-shrink: 0;
      /* Kh√¥ng b·ªã co l·∫°i */
    }

    .next-tasks .task-delete {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
      /* Kh√¥ng b·ªã co l·∫°i */
      opacity: 0;
      /* ·∫®n m·∫∑c ƒë·ªãnh */
      transition: opacity 0.3s;
    }

    /* Hi·ªán n√∫t x√≥a khi hover */
    .task-item:hover .task-delete {
      opacity: 1;
    }

    /* 6. GI·ªÆ NGUY√äN KHO·∫¢NG C√ÅCH BAN ƒê·∫¶U */
    .current-tasks .task-item,
    .next-tasks .task-item {
      gap: 12px;
      /* Gi·ªØ kho·∫£ng c√°ch ban ƒë·∫ßu */
      padding: 10px 12px;
      /* Gi·ªØ padding ban ƒë·∫ßu */
    }
  </style>
</head>

<body>
  <div class="cyber-grid"></div>
  <div class="cyber-line"></div>
  <div class="floating-elements">
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>
  </div>
  <div class="glow-effect glow-1"></div>
  <div class="glow-effect glow-2"></div>

  <!-- LICENSE GATE -->
  <div class="license-gate" id="licenseGate">
    <div class="license-panel">
      <h2 class="panel-title">
        <i class="fas fa-shield-halved"></i> K√çCH HO·∫†T B·∫¢N QUY·ªÄN
      </h2>

      <div class="license-small">
        Web c·ªßa b·∫°n ƒëang b·∫≠t ch·∫ø ƒë·ªô <b>Kh√≥a thi·∫øt b·ªã</b>: 1 m√°y / 1
        license.<br />
        Nh·∫≠p license ƒë·ªÉ m·ªü h·ªá th·ªëng.
      </div>

      <div class="license-row">
        <input class="license-input" id="licenseInput" placeholder="Nh·∫≠p license (VD: N1.21000101.xxxx...)" />

        <div class="license-actions">
          <button class="license-btn primary" id="btnActivate">
            <i class="fas fa-key"></i> K√çCH HO·∫†T
          </button>
          <button class="license-btn ghost" id="btnCopyDevice">
            <i class="fas fa-copy"></i> COPY THI·∫æT B·ªä HI·ªÜN T·∫†I
          </button>
          <button class="license-btn ghost" id="btnRequestReset">
            <i class="fas fa-rotate"></i> Y√äU C·∫¶U C·∫§P L·∫†I LICENSE
          </button>
        </div>

        <div class="license-status" id="licenseStatus">
          Tr·∫°ng th√°i: Ch∆∞a k√≠ch ho·∫°t
        </div>

        <div class="license-kv">
          <div>Thi·∫øt b·ªã hi·ªán t·∫°i</div>
          <div><code id="deviceIdText">...</code></div>

          <div>Th√¥ng tin</div>
          <div><code id="deviceInfoText">...</code></div>
        </div>

        <div class="license-small">
          <b>G·ª£i √Ω:</b> N·∫øu b·∫°n ƒë·ªïi m√°y / ƒë·ªïi tr√¨nh duy·ªát / x√≥a d·ªØ li·ªáu tr√¨nh
          duy·ªát ‚Üí deviceID thay ƒë·ªïi ‚Üí c·∫ßn c·∫•p l·∫°i license.
        </div>
      </div>
    </div>
  </div>

  <div id="appRoot">
    <div class="container">
      <header>
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-satellite"></i>
          </div>
          <div class="logo-text">N1 CYBERSPHERE</div>
        </div>
        <div class="user-info">
          <div class="user-avatar">T</div>
          <div>
            <div class="user-greeting">Xin ch√†o</div>
            <div class="user-name" id="userNameText">---</div>
          </div>
        </div>
      </header>

      <main class="main-content">
        <section class="mission-panel">
          <h2 class="panel-title">
            <i class="fas fa-bullseye"></i> M·ª§C TI√äU CHI·∫æN L∆Ø·ª¢C
          </h2>

          <div class="target-info">

            <!-- √î√î 1: M·ª§C TI√äU -->
            <div class="target-card" id="tcCard0">
              <div class="tc-corner tl"></div>
              <div class="tc-corner tr"></div>
              <div class="tc-corner bl"></div>
              <div class="tc-corner br"></div>
              <div class="tc-left">
                <div class="card-title"><i class="fas fa-flag"></i> M·ª•c ti√™u</div>
                <div class="card-value">JLPT N1</div>
                <div class="card-subtitle">C·∫•p ƒë·ªô cao nh·∫•t</div>
                <div class="card-subtitle" style="margin-top:4px">
                  <span class="tc-active-dot"></span>
                  <span style="color:rgba(0,255,176,.8);font-size:10px;letter-spacing:1px;font-weight:600">ƒêANG HO·∫†T
                    ƒê·ªòNG</span>
                </div>
              </div>
              <div class="tc-right">
                <canvas id="tcCanvas0"></canvas>
                <div class="tc-fade"></div>
                <div class="tc-sep">
                  <svg viewBox="0 0 200 130" preserveAspectRatio="none" fill="none">
                    <defs>
                      <filter id="tcGf0">
                        <feGaussianBlur stdDeviation="2" result="b" />
                        <feMerge>
                          <feMergeNode in="b" />
                          <feMergeNode in="SourceGraphic" />
                        </feMerge>
                      </filter>
                      <linearGradient id="tcSg0" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="rgba(0,225,255,0)" />
                        <stop offset="15%" stop-color="rgba(0,225,255,0.45)" />
                        <stop offset="85%" stop-color="rgba(0,200,255,0.4)" />
                        <stop offset="100%" stop-color="rgba(0,225,255,0)" />
                      </linearGradient>
                    </defs>
                    <path d="M 108,0 C 38,35 158,95 88,130" stroke="rgba(0,0,0,.5)" stroke-width="10" fill="none" />
                    <path d="M 114,0 C 44,35 164,95 94,130" stroke="rgba(0,180,240,.15)" stroke-width="3" fill="none" />
                    <path d="M 110,0 C 40,35 160,95 90,130" stroke="url(#tcSg0)" stroke-width="1.5" fill="none"
                      filter="url(#tcGf0)" />
                    <path d="M 109,0 C 39,35 159,95 89,130" stroke="rgba(255,255,255,.18)" stroke-width=".7"
                      fill="none" />
                  </svg>
                </div>
                <div class="tc-scan"></div>
              </div>
              <div class="tc-icon"><i class="fas fa-graduation-cap"></i></div>
            </div>

            <!-- √î 2: TH·ªúI H·∫†N -->
            <div class="target-card" id="tcCard1">
              <div class="tc-corner tl"></div>
              <div class="tc-corner tr"></div>
              <div class="tc-corner bl"></div>
              <div class="tc-corner br"></div>
              <div class="tc-left">
                <div class="card-title"><i class="fas fa-calendar-alt"></i> Th·ªùi h·∫°n</div>
                <div class="card-value special" id="examMonthYear">07/2026</div>
                <div class="card-subtitle" id="examSubtitle">K·ª≥ thi th√°ng 7 nƒÉm 2026</div>
                <div class="card-subtitle" id="examCountdown">C√≤n ...</div>
                <div class="sparkle"></div>
                <div class="sparkle"></div>
                <div class="sparkle"></div>
              </div>
              <div class="tc-right">
                <canvas id="tcCanvas1"></canvas>
                <div class="tc-fade"></div>
                <div class="tc-sep">
                  <svg viewBox="0 0 200 130" preserveAspectRatio="none" fill="none">
                    <defs>
                      <filter id="tcGf1">
                        <feGaussianBlur stdDeviation="2" result="b" />
                        <feMerge>
                          <feMergeNode in="b" />
                          <feMergeNode in="SourceGraphic" />
                        </feMerge>
                      </filter>
                      <linearGradient id="tcSg1" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="rgba(255,200,60,0)" />
                        <stop offset="15%" stop-color="rgba(255,200,60,0.4)" />
                        <stop offset="85%" stop-color="rgba(255,160,0,0.35)" />
                        <stop offset="100%" stop-color="rgba(255,200,60,0)" />
                      </linearGradient>
                    </defs>
                    <path d="M 108,0 C 38,35 158,95 88,130" stroke="rgba(0,0,0,.5)" stroke-width="10" fill="none" />
                    <path d="M 114,0 C 44,35 164,95 94,130" stroke="rgba(255,160,0,.15)" stroke-width="3" fill="none" />
                    <path d="M 110,0 C 40,35 160,95 90,130" stroke="url(#tcSg1)" stroke-width="1.5" fill="none"
                      filter="url(#tcGf1)" />
                    <path d="M 109,0 C 39,35 159,95 89,130" stroke="rgba(255,255,255,.18)" stroke-width=".7"
                      fill="none" />
                  </svg>
                </div>
                <div class="tc-ring" id="tcRing1">
                  <svg class="tc-ring-svg" viewBox="0 0 96 96">
                    <circle class="tc-ring-track" cx="48" cy="48" r="38" />
                    <circle class="tc-ring-fill tc-ring-fill--yellow" cx="48" cy="48" r="38" id="tcRingFill1" />
                    <circle class="tc-ring-glow tc-ring-glow--yellow" cx="48" cy="48" r="38" id="tcRingGlow1" />
                  </svg>
                  <div class="tc-ring-inner">
                    <div class="tc-ring-days" id="tcRingDays1">‚Äî</div>
                    <div class="tc-ring-label">ng√†y</div>
                  </div>
                </div>
                <div class="tc-scan"></div>
              </div>
              <div class="tc-icon" style="color:#ffd060"><i class="fas fa-calendar-check"></i></div>
            </div>

            <!-- √î 3: TR·∫†NG TH√ÅI -->
            <div class="target-card" id="tcCard2">
              <div class="tc-corner tl"></div>
              <div class="tc-corner tr"></div>
              <div class="tc-corner bl"></div>
              <div class="tc-corner br"></div>
              <div class="tc-left">
                <div class="card-title"><i class="fas fa-rocket"></i> Tr·∫°ng th√°i</div>
                <div class="card-value" id="statusValue">---</div>
                <div class="card-subtitle" id="statusSubtitle">---</div>
                <div class="sparkle"></div>
                <div class="sparkle"></div>
                <div class="sparkle"></div>
              </div>
              <div class="tc-right">
                <canvas id="tcCanvas2"></canvas>
                <div class="tc-fade"></div>
                <div class="tc-sep">
                  <svg viewBox="0 0 200 130" preserveAspectRatio="none" fill="none">
                    <defs>
                      <filter id="tcGf2">
                        <feGaussianBlur stdDeviation="2" result="b" />
                        <feMerge>
                          <feMergeNode in="b" />
                          <feMergeNode in="SourceGraphic" />
                        </feMerge>
                      </filter>
                      <linearGradient id="tcSg2" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="rgba(0,255,180,0)" />
                        <stop offset="15%" stop-color="rgba(0,255,180,0.35)" />
                        <stop offset="85%" stop-color="rgba(0,220,150,0.3)" />
                        <stop offset="100%" stop-color="rgba(0,255,180,0)" />
                      </linearGradient>
                    </defs>
                    <path d="M 108,0 C 38,35 158,95 88,130" stroke="rgba(0,0,0,.5)" stroke-width="10" fill="none" />
                    <path d="M 114,0 C 44,35 164,95 94,130" stroke="rgba(0,200,120,.15)" stroke-width="3" fill="none" />
                    <path d="M 110,0 C 40,35 160,95 90,130" stroke="url(#tcSg2)" stroke-width="1.5" fill="none"
                      filter="url(#tcGf2)" />
                    <path d="M 109,0 C 39,35 159,95 89,130" stroke="rgba(255,255,255,.18)" stroke-width=".7"
                      fill="none" />
                  </svg>
                </div>
                <div class="tc-ring" id="tcRing2">
                  <svg class="tc-ring-svg" viewBox="0 0 96 96">
                    <circle class="tc-ring-track" cx="48" cy="48" r="38" />
                    <circle class="tc-ring-fill tc-ring-fill--green" cx="48" cy="48" r="38" id="tcRingFill2" />
                    <circle class="tc-ring-glow tc-ring-glow--green" cx="48" cy="48" r="38" id="tcRingGlow2" />
                  </svg>
                  <div class="tc-ring-inner">
                    <div class="tc-ring-days" id="tcRingDays2">‚Äî</div>
                    <div class="tc-ring-label">ng√†y</div>
                  </div>
                </div>
                <div class="tc-scan"></div>
              </div>
              <div class="tc-icon" style="color:#00ffb0"><i class="fas fa-shield-alt"></i></div>
            </div>

          </div>

          <!-- ===== STREAK DASHBOARD M·ªöI ===== -->
          <div class="streak-dashboard">
            <!-- Header -->
            <div class="streak-header">
              <div class="streak-title">
                <i class="fas fa-fire"></i> CHU·ªñI HO·∫†T ƒê·ªòNG
              </div>
              <div class="streak-badge" id="streakDays">12 NG√ÄY</div>
            </div>

            <!-- 2 C·ªôt ch√≠nh -->
            <div class="dashboard-grid">
              <!-- C·ªôt tr√°i: Nhi·ªám v·ª• hi·ªán t·∫°i -->
              <div class="task-column current-tasks">
                <div class="column-header">
                  <div class="column-title">
                    <i class="fas fa-clipboard-list"></i> NHI·ªÜM V·ª§ HI·ªÜN T·∫†I
                  </div>
                </div>

                <div class="task-list" id="currentTaskList">
                  <!-- Tasks s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
                  <div class="task-item">
                    <div class="task-checkbox">
                      <i class="far fa-square"></i>
                    </div>
                    <div class="task-content">
                      <div class="task-name">H·ªçc 20 t·ª´ v·ª±ng m·ªõi</div>
                    </div>
                  </div>
                  <div class="task-item">
                    <div class="task-checkbox">
                      <i class="far fa-square"></i>
                    </div>
                    <div class="task-content">
                      <div class="task-name">√în t·∫≠p 30 t·ª´ c≈©</div>
                    </div>
                  </div>
                  <div class="task-item">
                    <div class="task-checkbox">
                      <i class="far fa-square"></i>
                    </div>
                    <div class="task-content">
                      <div class="task-name">L√†m b√†i test Mimikara</div>
                    </div>
                  </div>
                </div>

                <div class="task-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" id="currentProgressFill" style="width: 33%"></div>
                  </div>
                  <div class="progress-text">
                    <span>Ho√†n th√†nh</span>
                    <span id="currentProgressText">1/3</span>
                  </div>
                </div>
              </div>

              <!-- C·ªôt ph·∫£i: Nhi·ªám v·ª• ti·∫øp theo -->
              <div class="task-column next-tasks">
                <div class="column-header">
                  <div class="column-title">
                    <i class="fas fa-step-forward"></i> NHI·ªÜM V·ª§ TI·∫æP THEO
                  </div>
                </div>

                <div class="task-list" id="nextTaskList">
                  <!-- Tasks s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
                  <div class="task-item next-task">
                    <div class="task-bullet">‚Ä¢</div>
                    <div class="task-content">
                      <div class="task-name">H·ªçc 25 t·ª´ kanji</div>
                    </div>
                    <div class="task-delete" title="X√≥a nhi·ªám v·ª•">
                      <i class="fas fa-times"></i>
                    </div>
                  </div>
                  <div class="task-item next-task">
                    <div class="task-bullet">‚Ä¢</div>
                    <div class="task-content">
                      <div class="task-name">√în t·∫≠p 40 t·ª´ v·ª±ng</div>
                    </div>
                    <div class="task-delete" title="X√≥a nhi·ªám v·ª•">
                      <i class="fas fa-times"></i>
                    </div>
                  </div>
                  <div class="task-item next-task">
                    <div class="task-bullet">‚Ä¢</div>
                    <div class="task-content">
                      <div class="task-name">L√†m 2 b√†i test ng·ªØ ph√°p</div>
                    </div>
                    <div class="task-delete" title="X√≥a nhi·ªám v·ª•">
                      <i class="fas fa-times"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- H√†ng t·ªïng quan & l·ªãch s·ª≠ -->
            <div class="stats-row">
              <div class="stats-summary">
                <i class="fas fa-chart-line"></i>
                <span>T·ªïng tasks: <strong id="totalTasks">245/350</strong></span>
                <span class="divider">|</span>
                <span>Ho√†n th√†nh: <strong id="completionRate">70%</strong></span>
                <span class="divider">|</span>
                <span>Streak d√†i nh·∫•t:
                  <strong id="longestStreak">15</strong></span>
              </div>

              <button class="history-btn" id="viewHistoryBtn">
                <i class="fas fa-history"></i> XEM L·ªäCH S·ª¨
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>

            <!-- Footer k√≠ch ho·∫°t -->
            <div class="activation-footer" id="activationFooter">
              <i class="fas fa-bolt"></i>
              <span id="activationText">H·ªÜ TH·ªêNG LUY·ªÜN THI N1 ƒê√É K√çCH HO·∫†T 19/02/2026</span>
            </div>
          </div>
        </section>

        <section class="mission-panel">
          <h2 class="panel-title">
            <i class="fas fa-cogs"></i> MODULE ƒê√ÄO T·∫†O
          </h2>

          <div class="modules-wrapper">
            <div class="modules-section">
              <div class="module-card" data-module="vocab">
                <div class="module-icon">
                  <i class="fas fa-book"></i>
                </div>
                <h3 class="module-title">T·ª™ V·ª∞NG N1</h3>
                <p class="module-desc">
                  H∆°n 2000 t·ª´ v·ª±ng n√¢ng cao v·ªõi h·ªá th·ªëng ghi nh·ªõ th√¥ng minh.
                </p>
                <div class="progress-bar">
                  <div class="progress-fill" id="progress-vocab"></div>
                </div>
                <div class="progress-text">
                  <span>Ti·∫øn ƒë·ªô</span>
                  <span id="percent-vocab">0%</span>
                </div>
              </div>

              <div class="module-card" data-module="grammar">
                <div class="module-icon">
                  <i class="fas fa-language"></i>
                </div>
                <h3 class="module-title">NG·ªÆ PH√ÅP N1</h3>
                <p class="module-desc">
                  H∆°n 150 c·∫•u tr√∫c ng·ªØ ph√°p ph·ª©c t·∫°p v·ªõi gi·∫£i th√≠ch chi ti·∫øt.
                </p>
                <div class="progress-bar">
                  <div class="progress-fill" id="progress-grammar"></div>
                </div>
                <div class="progress-text">
                  <span>Ti·∫øn ƒë·ªô</span>
                  <span id="percent-grammar">0%</span>
                </div>
              </div>

              <div class="module-card" data-module="listening">
                <div class="module-icon">
                  <i class="fas fa-headphones"></i>
                </div>
                <h3 class="module-title">NGHE HI·ªÇU</h3>
                <p class="module-desc">
                  Luy·ªán nghe v·ªõi c√°c t√¨nh hu·ªëng th·ª±c t·∫ø v√† t·ªëc ƒë·ªô b·∫£n ng·ªØ.
                </p>
                <div class="progress-bar">
                  <div class="progress-fill" id="progress-listening"></div>
                </div>
                <div class="progress-text">
                  <span>Ti·∫øn ƒë·ªô</span>
                  <span id="percent-listening">0%</span>
                </div>
              </div>

              <div class="module-card" data-module="reading">
                <div class="module-icon">
                  <i class="fas fa-file-alt"></i>
                </div>
                <h3 class="module-title">ƒê·ªåC HI·ªÇU</h3>
                <p class="module-desc">
                  Ph√¢n t√≠ch vƒÉn b·∫£n h·ªçc thu·∫≠t, b√°o ch√≠ v√† t√†i li·ªáu chuy√™n
                  ng√†nh.
                </p>
                <div class="progress-bar">
                  <div class="progress-fill" id="progress-reading"></div>
                </div>
                <div class="progress-text">
                  <span>Ti·∫øn ƒë·ªô</span>
                  <span id="percent-reading">0%</span>
                </div>
              </div>
            </div>
          </div>

          <a href="#" class="start-button">
            <i class="fas fa-play-circle"></i> KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG H·ªåC T·∫¨P
          </a>
        </section>
      </main>

      <footer>
        <p>¬© 2025 N1 CYBERSPHERE - H·ªá th·ªëng ƒë√†o t·∫°o JLPT N1 c√¥ng ngh·ªá cao</p>
        <p>Phi√™n b·∫£n 2.0 | Ch·∫ø ƒë·ªô: Dark Mode | K·∫øt n·ªëi: Stable</p>
      </footer>
    </div>
  </div>

  <!-- BACKDROP + MODAL (·∫®n m·∫∑c ƒë·ªãnh, ch·ªâ hi·ªán khi ch·ªçn module) -->
  <div class="module-display-backdrop" id="moduleBackdrop"></div>

  <div class="module-display-frame" id="moduleDisplay" aria-hidden="true">
    <div class="frame-status">
      <div class="status-indicator locked" id="frameStatus">
        <span class="status-icon">üîí</span>
        <span class="status-text">ƒê√£ ch·ªçn module</span>
      </div>

      <!-- ƒê·ªïi ‚ÄúB·ªè kh√≥a‚Äù => ‚Äúƒê√≥ng‚Äù -->
      <button class="close-lock-btn" id="closeModalBtn">
        <i class="fas fa-xmark"></i> ƒê√≥ng
      </button>
    </div>

    <div class="frame-header">
      <div class="frame-icon">
        <i class="fas fa-book"></i>
      </div>
      <div class="frame-title" id="frameTitle">---</div>
    </div>

    <div class="frame-content" id="frameContent"></div>
  </div>
  <!-- TEST MODAL (B√ÄI KI·ªÇM TRA) -->
  <div class="test-modal-backdrop" id="testModalBackdrop"></div>
  <div class="test-modal-frame" id="testModal">
    <div class="test-modal-header">
      <div class="test-modal-title">
        <i class="fas fa-file-signature"></i>
        <span id="testModalTitle">B√†i ki·ªÉm tra</span>
      </div>
      <button class="test-modal-close" id="closeTestModalBtn">
        <i class="fas fa-times"></i> ƒê√≥ng
      </button>
    </div>
    <div class="test-list" id="testList"></div>
  </div>
  <script>
    let __loadingTimer = null;
    let __loadingPct = 0;

    function showCyberLoading(text = "ƒêANG T·∫¢I D·ªÆ LI·ªÜU") {
      const loading = document.getElementById("cyberLoading");

      // N·∫øu ƒëang m·ªü r·ªìi th√¨ ch·ªâ ƒë·ªïi text, kh√¥ng reset % (tr√°nh gi·∫≠t/quay l·∫°i 0)
      if (loading.classList.contains("show")) {
        const textEl = document.getElementById("cyberLoadingText");
        if (textEl) textEl.textContent = text;
        return;
      }

      const textEl = document.getElementById("cyberLoadingText");
      const pctEl = document.getElementById("cyberLoadingPercent");
      const bar = document.querySelector(".cyber-loading-bar-fill");

      textEl.textContent = text;

      __loadingPct = 0;
      if (pctEl) pctEl.textContent = "0%";
      if (bar) bar.style.width = "0%";

      loading.classList.add("show");

      if (__loadingTimer) clearInterval(__loadingTimer);
      __loadingTimer = setInterval(() => {
        const step = __loadingPct < 50 ? 3 : __loadingPct < 80 ? 2 : 1;
        __loadingPct = Math.min(90, __loadingPct + step);
        if (pctEl) pctEl.textContent = `${__loadingPct}%`;
        if (bar) bar.style.width = `${__loadingPct}%`;
      }, 120);
    }

    function hideCyberLoading() {
      const loading = document.getElementById("cyberLoading");
      const pctEl = document.getElementById("cyberLoadingPercent");
      const bar = document.querySelector(".cyber-loading-bar-fill");

      // k·∫øt th√∫c th·∫≠t: l√™n 100%
      if (__loadingTimer) clearInterval(__loadingTimer);
      __loadingTimer = null;

      __loadingPct = 100;
      if (pctEl) pctEl.textContent = "100%";
      if (bar) bar.style.width = "100%";

      // gi·ªØ 1 nh·ªãp cho ng∆∞·ªùi d√πng th·∫•y full r·ªìi t·∫Øt
      setTimeout(() => {
        loading.classList.remove("show");
      }, 180);
    }

    /* =========================================================
    CONFIG + LocalStorage Keys
  ========================================================= */
    // ==================== PROGRESS CACHE (MULTI-KEY) ====================
    const progressCache = {
      entries: new Map(), // key -> { data, timestamp }
      TTL: 5 * 60 * 1000, // 5 ph√∫t
    };

    function makeProgressCacheKey(deviceId, license, testIds) {
      // testIds ph·∫£i ·ªïn ƒë·ªãnh th·ª© t·ª±
      const ids = Array.isArray(testIds) ? testIds.slice() : [];
      ids.sort(); // ƒë·∫£m b·∫£o Unit ƒë·ªïi th·ª© t·ª± v·∫´n ra c√πng key n·∫øu c√πng t·∫≠p test
      return `${deviceId}::${license}::${ids.join("|")}`;
    }

    function isProgressCacheValid(deviceId, license, testIds) {
      if (
        !deviceId ||
        !license ||
        !Array.isArray(testIds) ||
        testIds.length === 0
      )
        return false;

      const key = makeProgressCacheKey(deviceId, license, testIds);
      const entry = progressCache.entries.get(key);
      if (!entry) return false;

      const now = Date.now();
      return now - entry.timestamp < progressCache.TTL;
    }

    async function getCachedProgress(deviceId, license, testIds) {
      if (
        !deviceId ||
        !license ||
        !Array.isArray(testIds) ||
        testIds.length === 0
      ) {
        return { data: {}, fromCache: true };
      }

      const key = makeProgressCacheKey(deviceId, license, testIds);

      // HIT
      const entry = progressCache.entries.get(key);
      if (entry) {
        const now = Date.now();
        if (now - entry.timestamp < progressCache.TTL) {
          console.log("‚úÖ Cache HIT progress:", key);
          return { data: entry.data || {}, fromCache: true };
        }
        // qu√° TTL -> x√≥a entry c≈©
        progressCache.entries.delete(key);
      }

      // MISS -> g·ªçi API
      console.log("üì° Cache MISS ‚Üí g·ªçi API progress:", key);
      const data = await getProgressMap(deviceId, license, testIds);

      progressCache.entries.set(key, {
        data: data || {},
        timestamp: Date.now(),
      });

      return { data: data || {}, fromCache: false };
    }

    // T·∫°o skeleton loading HTML
    function createSkeletonLoading() {
      return `
          <div class="skeleton-container">
            ${Array(5)
          .fill()
          .map(
            () => `
              <div class="skeleton-item">
                <div class="skeleton-icon"></div>
                <div class="skeleton-line"></div>
                <div class="skeleton-line short"></div>
              </div>
            `,
          )
          .join("")}
            <div class="loading-text">ƒêANG T·∫¢I B√ÄI KI·ªÇM TRA...</div>
          </div>
        `;
    }
    const API_URL = "https://n1-license-server.onrender.com/api";
    const LS_DEVICE_ID = "n1_device_id";
    const LS_ACTIVATED = "n1_activated_once";
    const LS_LICENSE = "n1_license";
    const LS_USER_NAME = "n1_user_name";
    const LS_EXAM_DATE = "n1_exam_date";
    const LS_USER_ID = "n1_user_id";

    function uuidv4() {
      return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
        const r = (Math.random() * 16) | 0;
        const v = c === "x" ? r : (r & 0x3) | 0x8;
        return v.toString(16);
      });
    }

    function getOrCreateDeviceId() {
      let id = localStorage.getItem(LS_DEVICE_ID);
      if (!id) {
        id = uuidv4();
        localStorage.setItem(LS_DEVICE_ID, id);
      }
      return id;
    }

    function getDeviceInfo() {
      const ua = navigator.userAgent || "";
      const lang = navigator.language || "";
      const platform = navigator.platform || "";
      return `${platform} | ${lang} | ${ua.slice(0, 80)}...`;
    }

    function setStatus(text, type = "") {
      const el = document.getElementById("licenseStatus");
      el.textContent = text;
      el.classList.remove("error", "ok");
      if (type) el.classList.add(type);
    }

    function setUserName(name) {
      const el = document.getElementById("userNameText");
      if (!el) return;
      const safeName = (name || "").trim();
      if (!safeName) return;
      el.textContent = safeName + " üéâ";
      localStorage.setItem(LS_USER_NAME, safeName);
    }

    /* =========================================================
    Exam date countdown (gi·ªØ nguy√™n)
  ========================================================= */
    const DEFAULT_EXAM_DATE = "20260701";

    function parseYYYYMMDD(s) {
      const m = /^(\d{4})(\d{2})(\d{2})$/.exec(String(s || "").trim());
      if (!m) return null;
      const y = Number(m[1]),
        mo = Number(m[2]) - 1,
        d = Number(m[3]);
      const dt = new Date(y, mo, d);
      if (
        dt.getFullYear() !== y ||
        dt.getMonth() !== mo ||
        dt.getDate() !== d
      )
        return null;
      return dt;
    }

    function formatMonthYear(dt) {
      const mm = String(dt.getMonth() + 1).padStart(2, "0");
      const yyyy = dt.getFullYear();
      return `${mm}/${yyyy}`;
    }

    function formatDDMMYYYY(dt) {
      const dd = String(dt.getDate()).padStart(2, "0");
      const mm = String(dt.getMonth() + 1).padStart(2, "0");
      const yyyy = dt.getFullYear();
      return `${dd}/${mm}/${yyyy}`;
    }

    function diffMonthsDays(fromDate, toDate) {
      if (toDate <= fromDate) return { months: 0, days: 0 };

      let months =
        (toDate.getFullYear() - fromDate.getFullYear()) * 12 +
        (toDate.getMonth() - fromDate.getMonth());

      const candidate = new Date(
        fromDate.getFullYear(),
        fromDate.getMonth() + months,
        fromDate.getDate(),
      );
      if (candidate > toDate) months -= 1;

      const anchor = new Date(
        fromDate.getFullYear(),
        fromDate.getMonth() + months,
        fromDate.getDate(),
      );
      const msPerDay = 24 * 60 * 60 * 1000;
      const days = Math.max(0, Math.round((toDate - anchor) / msPerDay));

      return { months, days };
    }

    function updateWarningColor(cardElement, daysRemaining) {
      cardElement.classList.remove(
        "warning-yellow",
        "warning-red",
        "warning-expired",
      );
      if (daysRemaining <= 0) cardElement.classList.add("warning-expired");
      else if (daysRemaining < 30) cardElement.classList.add("warning-red");
      else if (daysRemaining <= 60)
        cardElement.classList.add("warning-yellow");
    }

    function updateExamUI(examDateStr) {
      const examMonthYearEl = document.getElementById("examMonthYear");
      const examSubtitleEl = document.getElementById("examSubtitle");
      const examCountdownEl = document.getElementById("examCountdown");
      const targetCardEl = document.querySelector(
        ".target-card:nth-child(2)",
      );
      if (
        !examMonthYearEl ||
        !examSubtitleEl ||
        !examCountdownEl ||
        !targetCardEl
      )
        return;

      const raw =
        examDateStr && String(examDateStr).trim()
          ? String(examDateStr).trim()
          : localStorage.getItem(LS_EXAM_DATE) || DEFAULT_EXAM_DATE;

      const examDt = parseYYYYMMDD(raw);
      if (!examDt) return;

      examMonthYearEl.textContent = formatMonthYear(examDt);

      if (!examDateStr && !localStorage.getItem(LS_EXAM_DATE)) {
        examSubtitleEl.textContent = "K·ª≥ thi th√°ng 7 nƒÉm 2026";
      } else {
        const dd = String(examDt.getDate()).padStart(2, "0");
        const mm = String(examDt.getMonth() + 1).padStart(2, "0");
        const yyyy = examDt.getFullYear();
        examSubtitleEl.textContent = `Ng√†y thi ch√≠nh th·ª©c : ${dd}/${mm}/${yyyy}`;
      }

      const now = new Date();
      const today = new Date(
        now.getFullYear(),
        now.getMonth(),
        now.getDate(),
      );
      const { months, days } = diffMonthsDays(today, examDt);
      const totalDays = Math.max(
        0,
        Math.round((examDt - today) / (1000 * 60 * 60 * 24)),
      );

      let countdownText = "";
      if (totalDays <= 0) countdownText = "K·ª≥ thi JLPT ƒë√£ di·ªÖn ra";
      else if (months === 0) countdownText = `C√≤n ${days} ng√†y`;
      else if (months === 1) countdownText = `C√≤n 1 th√°ng ${days} ng√†y`;
      else countdownText = `C√≤n ${months} th√°ng ${days} ng√†y`;

      examCountdownEl.textContent = countdownText;
      updateWarningColor(targetCardEl, totalDays);
    }

    /* =========================================================
    API
  ========================================================= */
    async function verifyLicense(deviceId, license) {
      const res = await fetch(`${API_URL}/verify`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ deviceId, license }),
      });
      if (!res.ok) {
        const t = await res.text();
        throw new Error(t || "Verify failed");
      }
      return res.json();
    }

    async function getProgressMap(deviceId, license, testIds) {
      if (
        !deviceId ||
        !license ||
        !Array.isArray(testIds) ||
        testIds.length === 0
      )
        return {};

      try {
        const res = await fetch(`${API_URL}/progress/get`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ deviceId, license, testIds }),
        });

        if (!res.ok) return {};
        const r = await res.json();
        if (!r || !r.ok || !r.data) return {};
        return r.data || {};
      } catch {
        return {};
      }
    }

    function badgeFromProgress(p) {
      const perfectCount = Number(p?.perfectCount || 0);
      if (perfectCount >= 3) {
        return {
          text: "ƒê√£ ho√†n th√†nh",
          icon: "fa-check-circle",
          bg: "rgba(0, 200, 100, 0.2)",
          border: "rgba(0, 255, 100, 0.3)",
          color: "#00ff99",
        };
      }
      if (perfectCount === 2) {
        return {
          text: "Ti·∫øn ƒë·ªô 67% (2/3)",
          icon: "fa-chart-line",
          bg: "rgba(0, 168, 255, 0.18)",
          border: "rgba(0, 168, 255, 0.35)",
          color: "#66d9ff",
        };
      }
      if (perfectCount === 1) {
        return {
          text: "Ti·∫øn ƒë·ªô 33% (1/3)",
          icon: "fa-chart-line",
          bg: "rgba(0, 168, 255, 0.12)",
          border: "rgba(0, 168, 255, 0.28)",
          color: "#66d9ff",
        };
      }
      return {
        text: "Ch∆∞a l√†m",
        icon: "fa-clock",
        bg: "rgba(255, 100, 0, 0.2)",
        border: "rgba(255, 150, 0, 0.3)",
        color: "#ffaa00",
      };
    }
    // ===== WORD COUNT HELPERS (ceil(questions/2)) =====
    function wordsFromQuestions(n) {
      const q = Number(n || 0);
      if (!Number.isFinite(q) || q <= 0) return 0;
      return Math.ceil(q / 2);
    }

    function flattenTestsFromTestInfo(testInfo) {
      // Tr·∫£ v·ªÅ m·∫£ng test objects c√≥ d·∫°ng {url, questions, ...}
      if (!testInfo) return [];
      if (Array.isArray(testInfo.tests)) return testInfo.tests;

      if (Array.isArray(testInfo.units)) {
        const all = [];
        testInfo.units.forEach((u) => {
          if (u && Array.isArray(u.tests)) all.push(...u.tests);
        });
        return all;
      }
      return [];
    }

    function calcABFromTests(tests, progressMap) {
      // b: t·ªïng words to√†n b·ªô tests
      // a: t·ªïng words c·ªßa tests ƒë√£ ho√†n th√†nh (perfectCount>=3)
      let a = 0;
      let b = 0;

      (tests || []).forEach((t) => {
        const w = wordsFromQuestions(t.questions);
        b += w;

        const p = progressMap && t.url ? progressMap[t.url] || {} : {};
        const perfectCount = Number(p?.perfectCount || 0);
        if (perfectCount >= 3) a += w;
      });

      return { a, b };
    }
    function ceilDiv2(n) {
      const x = Number(n || 0);
      return Math.ceil(x / 2);
    }

    function flattenTestsFromTestInfo(testInfo) {
      if (!testInfo) return [];
      if (Array.isArray(testInfo.tests)) return testInfo.tests;
      if (Array.isArray(testInfo.units)) {
        const out = [];
        testInfo.units.forEach((u) => {
          if (u && Array.isArray(u.tests)) out.push(...u.tests);
        });
        return out;
      }
      return [];
    }

    /**
     * T√≠nh a/b cho 1 module ch√≠nh d·ª±a tr√™n moduleContents[moduleId].items
     * - ch·ªâ l·∫•y item n√†o c√≥ key trong testData
     * - a = sum words c·ªßa test ho√†n th√†nh (perfectCount>=3)
     * - b = sum words c·ªßa t·∫•t c·∫£ test
     */
    function calcABForMainModule(moduleId, progressMap) {
      const mod = moduleContents[moduleId];
      if (!mod || !Array.isArray(mod.items)) return { a: 0, b: 0 };

      let a = 0;
      let b = 0;

      mod.items.forEach((item) => {
        const title = item?.title;
        const testInfo = testData[title];
        if (!testInfo) return; // item ch∆∞a c√≥ testData th√¨ b·ªè qua

        const tests = flattenTestsFromTestInfo(testInfo);
        tests.forEach((t) => {
          const words = ceilDiv2(t.questions);
          b += words;

          const p = progressMap?.[t.url] || { perfectCount: 0 };
          const done = Number(p.perfectCount || 0) >= 3;
          if (done) a += words;
        });
      });

      return { a, b };
    }

    function collectAllTestUrlsForMainModule(moduleId) {
      const mod = moduleContents[moduleId];
      if (!mod || !Array.isArray(mod.items)) return [];

      const urls = [];
      mod.items.forEach((item) => {
        const testInfo = testData[item?.title];
        const tests = flattenTestsFromTestInfo(testInfo);
        tests.forEach((t) => {
          if (t?.url) urls.push(t.url);
        });
      });

      // unique
      return Array.from(new Set(urls));
    }
    async function updateMainModulesProgress() {
      const deviceId = localStorage.getItem(LS_DEVICE_ID) || "";
      const license = localStorage.getItem(LS_LICENSE) || "";

      // N·∫øu ch∆∞a c√≥ license -> c·ª© ƒë·ªÉ 0%
      if (!license) return;

      // gom to√†n b·ªô test url c·ªßa 4 module ƒë·ªÉ g·ªçi API 1 l·∫ßn (nhanh h∆°n)
      const allUrls = [
        ...collectAllTestUrlsForMainModule("vocab"),
        ...collectAllTestUrlsForMainModule("grammar"),
        ...collectAllTestUrlsForMainModule("listening"),
        ...collectAllTestUrlsForMainModule("reading"),
      ];
      const testIds = Array.from(new Set(allUrls));

      if (testIds.length === 0) return;

      // d√πng cache b·∫°n ƒë√£ c√≥
      const r = await getCachedProgress(deviceId, license, testIds);
      const progressMap = r.data || {};

      ["vocab", "grammar", "listening", "reading"].forEach((m) => {
        const { a, b } = calcABForMainModule(m, progressMap);
        const percent = b > 0 ? Math.floor((a / b) * 100) : 0;

        const fill = document.getElementById(`progress-${m}`);
        const pct = document.getElementById(`percent-${m}`);

        if (fill) fill.style.width = percent + "%";
        if (pct) pct.textContent = percent + "%";
      });
    }

    async function getProgressMapForItemTitle(itemTitle) {
      const testInfo = testData[itemTitle];
      const tests = flattenTestsFromTestInfo(testInfo);
      const testIds = tests.map((t) => t.url).filter(Boolean);

      const deviceId = localStorage.getItem(LS_DEVICE_ID) || "";
      const license = localStorage.getItem(LS_LICENSE) || "";

      // ch∆∞a k√≠ch ho·∫°t => kh√¥ng c√≥ progress
      if (!license || testIds.length === 0) return {};

      const r = await getCachedProgress(deviceId, license, testIds);
      return r.data || {};
    }

    async function requestReset(deviceId, oldLicense, note) {
      const res = await fetch(`${API_URL}/request-reset`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ deviceId, oldLicense, note }),
      });
      if (!res.ok) {
        const t = await res.text();
        throw new Error(t || "Request reset failed");
      }
      return res.json();
    }

    function startBackgroundRecheck(deviceId) {
      const INTERVAL_MS = 90 * 1000;
      if (window.__recheckTimer) return;

      async function tick() {
        const license = localStorage.getItem(LS_LICENSE);
        const activatedOnce = localStorage.getItem(LS_ACTIVATED) === "1";
        if (!license || !activatedOnce) return;

        try {
          const r = await verifyLicense(deviceId, license);
          if (r && r.ok) {
            setStatus(`K√≠ch ho·∫°t OK (h·∫°n: ${r.expiry})`, "ok");
            updateStatusUI(r.expiry);
            return;
          }
          throw new Error("Verify failed");
        } catch (e) {
          const msg = String(e?.message || "");
          const hardBlock =
            msg.includes("Device revoked") ||
            msg.includes("User revoked") ||
            msg.includes("Expired") ||
            msg.includes("Invalid") ||
            msg.includes("License not found") ||
            msg.includes("already bound");

          if (hardBlock) {
            localStorage.removeItem(LS_LICENSE);
            localStorage.removeItem(LS_ACTIVATED);
            setStatus(
              "Quy·ªÅn truy c·∫≠p ƒë√£ b·ªã thu h·ªìi ho·∫∑c license kh√¥ng c√≤n h·ª£p l·ªá.",
              "error",
            );
            showGate(true);
            return;
          }
          setStatus(
            "Server ki·ªÉm tra ƒëang offline. H·ªá th·ªëng gi·ªØ tr·∫°ng th√°i k√≠ch ho·∫°t.",
            "error",
          );
        }
      }

      tick();
      window.__recheckTimer = setInterval(tick, INTERVAL_MS);
    }

    /* =========================================================
    Status expiry (gi·ªØ nguy√™n)
  ========================================================= */
    function updateStatusUI(expiryStr) {
      const statusValueEl = document.getElementById("statusValue");
      const statusSubtitleEl = document.getElementById("statusSubtitle");
      const targetCardEl = document.querySelector(
        ".target-card:nth-child(3)",
      );
      if (!statusValueEl || !statusSubtitleEl || !targetCardEl) return;

      const expiryDt = parseYYYYMMDD(expiryStr);
      if (!expiryDt) {
        statusValueEl.textContent = "ACTIVE";
        statusSubtitleEl.textContent = "Tr·∫°ng th√°i b·∫£n quy·ªÅn: ƒê√£ k√≠ch ho·∫°t";
        targetCardEl.classList.remove(
          "warning-yellow",
          "warning-red",
          "warning-expired",
        );
        return;
      }

      localStorage.setItem("n1_expiry_date", expiryStr);

      const now = new Date();
      const today = new Date(
        now.getFullYear(),
        now.getMonth(),
        now.getDate(),
      );
      const expDate = new Date(
        expiryDt.getFullYear(),
        expiryDt.getMonth(),
        expiryDt.getDate(),
      );

      const msPerDay = 24 * 60 * 60 * 1000;
      const remainingDays = Math.ceil((expDate - today) / msPerDay);

      targetCardEl.classList.remove(
        "warning-yellow",
        "warning-red",
        "warning-expired",
      );

      if (remainingDays <= 0) {
        statusValueEl.textContent = "EXPIRED";
        statusSubtitleEl.textContent = `Quy·ªÅn truy c·∫≠p ƒë√£ h·∫øt h·∫°n t·ª´: ${formatDDMMYYYY(expDate)}`;
        targetCardEl.classList.add("warning-expired");

        localStorage.removeItem(LS_LICENSE);
        localStorage.removeItem(LS_ACTIVATED);
        showGate(true);
        setStatus(
          "License ƒë√£ h·∫øt h·∫°n. Vui l√≤ng gia h·∫°n ƒë·ªÉ ti·∫øp t·ª•c s·ª≠ d·ª•ng.",
          "error",
        );
        return;
      }

      statusValueEl.textContent = "ACTIVE";

      if (remainingDays < 30) {
        targetCardEl.classList.add("warning-red");
        statusSubtitleEl.innerHTML = `Quy·ªÅn truy c·∫≠p h·ª£p l·ªá ƒë·∫øn: ${formatDDMMYYYY(expDate)}<br>C√≤n ${remainingDays} ng√†y`;
      } else if (remainingDays <= 60) {
        targetCardEl.classList.add("warning-yellow");
        statusSubtitleEl.innerHTML = `Quy·ªÅn truy c·∫≠p h·ª£p l·ªá ƒë·∫øn: ${formatDDMMYYYY(expDate)}<br>C√≤n ${remainingDays} ng√†y`;
      } else {
        statusSubtitleEl.innerHTML = `Quy·ªÅn truy c·∫≠p h·ª£p l·ªá ƒë·∫øn: ${formatDDMMYYYY(expDate)}<br>C√≤n ${remainingDays} ng√†y`;
      }

      if (window.__expiryCountdownTimer)
        clearInterval(window.__expiryCountdownTimer);
      startExpiryCountdown(expiryStr);
    }

    function startExpiryCountdown(expiryStr) {
      const expiryDt = parseYYYYMMDD(expiryStr);
      if (!expiryDt) return;

      if (window.__expiryCountdownTimer)
        clearInterval(window.__expiryCountdownTimer);

      window.__expiryCountdownTimer = setInterval(() => {
        const now = new Date();
        const today = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate(),
        );
        const expDate = new Date(
          expiryDt.getFullYear(),
          expiryDt.getMonth(),
          expiryDt.getDate(),
        );
        const msPerDay = 24 * 60 * 60 * 1000;
        const remainingDays = Math.ceil((expDate - today) / msPerDay);

        if (remainingDays <= 0) {
          clearInterval(window.__expiryCountdownTimer);
          localStorage.removeItem(LS_LICENSE);
          localStorage.removeItem(LS_ACTIVATED);

          showGate(true);
          setStatus(
            "License ƒë√£ h·∫øt h·∫°n. Vui l√≤ng gia h·∫°n ƒë·ªÉ ti·∫øp t·ª•c s·ª≠ d·ª•ng.",
            "error",
          );

          const statusValueEl = document.getElementById("statusValue");
          const statusSubtitleEl = document.getElementById("statusSubtitle");
          const targetCardEl = document.querySelector(
            ".target-card:nth-child(3)",
          );

          if (statusValueEl) statusValueEl.textContent = "EXPIRED";
          if (statusSubtitleEl)
            statusSubtitleEl.textContent = `Quy·ªÅn truy c·∫≠p ƒë√£ h·∫øt h·∫°n t·ª´: ${formatDDMMYYYY(expDate)}`;
          if (targetCardEl) {
            targetCardEl.classList.remove(
              "warning-yellow",
              "warning-red",
              "warning-expired",
            );
            targetCardEl.classList.add("warning-expired");
          }
        }
      }, 60000);
    }

    /* =========================================================
    Gate
  ========================================================= */
    function showGate(show = true) {
      const gate = document.getElementById("licenseGate");
      const app = document.getElementById("appRoot");
      gate.style.display = show ? "flex" : "none";
      app.style.display = show ? "none" : "block";
    }

    function fillDeviceUI(deviceId) {
      document.getElementById("deviceIdText").textContent = deviceId;
      document.getElementById("deviceInfoText").textContent = getDeviceInfo();
    }

    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        return true;
      }
    }

    /* =========================================================
    MODULE MODAL LOGIC (NEW)
    - M·∫∑c ƒë·ªãnh: ·∫©n modal
    - Click module: m·ªü modal ·ªü gi·ªØa + lock module
    - Click module kh√°c: ƒë·ªïi lock sang module kh√°c (modal v·∫´n m·ªü)
    - ƒê√≥ng: n√∫t "ƒê√≥ng" / ESC / click backdrop
  ========================================================= */
    let lockedModule = null;

    const moduleContents = {
      vocab: {
        title: "T·ª™ V·ª∞NG N1",
        icon: "fas fa-book",
        items: [
          {
            title: "T·ª´ v·ª±ng Mimikara Oboeru",
            desc: "14 Unit, 1170 t·ª´ v·ª±ng th√¥ng d·ª•ng nh·∫•t",
            progress: 65,
            stats: "ƒê√£ h·ªçc: 650/1170 t·ª´",
          },
          {
            title: "T·ª´ v·ª±ng ThaoLeJP",
            desc: "H∆°n 2000 t·ª´ v·ª±ng t·ªïng h·ª£p v√† c√°c lo·∫°i t·ª´ ƒë·∫∑c bi·ªát",
            progress: 42,
            stats: "ƒê√£ h·ªçc: 126/2000 t·ª´",
          },
          {
            title: "T·ª´ ƒë·ªìng nghƒ©a/Tr√°i nghƒ©a",
            desc: "500 c·∫∑p t·ª´ ƒë·ªìng nghƒ©a v√† tr√°i nghƒ©a N1",
            progress: 28,
            stats: "ƒê√£ h·ªçc: 140/500 c·∫∑p t·ª´",
          },
          {
            title: "T·ª´ v·ª±ng kh√≥",
            desc: "T·ªïng h·ª£p c√°c t·ª´ v·ª±ng c·ª±c kh√≥ t·ª´ng xu·∫•t hi·ªán trong ƒë·ªÅ thi JLPT",
            progress: 75,
            stats: "ƒê√£ h·ªçc: 600/800 t·ª´",
          },
        ],
      },
      grammar: {
        title: "NG·ªÆ PH√ÅP N1",
        icon: "fas fa-language",
        items: [
          {
            title: "Ng·ªØ ph√°p VƒÉn vi·∫øt",
            desc: "100 c·∫•u tr√∫c ng·ªØ ph√°p d√πng trong vƒÉn b·∫£n h·ªçc thu·∫≠t",
            progress: 42,
            stats: "ƒê√£ h·ªçc: 42/100 c·∫•u tr√∫c",
          },
          {
            title: "Ng·ªØ ph√°p H·ªôi tho·∫°i",
            desc: "50 m·∫´u c√¢u ƒë√†m tho·∫°i n√¢ng cao trong c√¥ng vi·ªác",
            progress: 60,
            stats: "ƒê√£ h·ªçc: 30/50 m·∫´u c√¢u",
          },
          {
            title: "Li√™n t·ª´ - Tr·ª£ t·ª´ N1",
            desc: "70 li√™n t·ª´ v√† tr·ª£ t·ª´ ph·ª©c t·∫°p",
            progress: 35,
            stats: "ƒê√£ h·ªçc: 25/70 t·ª´",
          },
          {
            title: "M·∫´u c√¢u So s√°nh",
            desc: "30 m·∫´u c√¢u so s√°nh n√¢ng cao",
            progress: 80,
            stats: "ƒê√£ h·ªçc: 24/30 m·∫´u c√¢u",
          },
        ],
      },
      listening: {
        title: "NGHE HI·ªÇU",
        icon: "fas fa-headphones",
        items: [
          {
            title: "Nghe tin t·ª©c",
            desc: "50 b√†i nghe tin t·ª©c NHK v·ªõi t·ªëc ƒë·ªô th·ª±c",
            progress: 28,
            stats: "ƒê√£ h·ªçc: 14/50 b√†i",
          },
          {
            title: "H·ªôi tho·∫°i C√¥ng s·ªü",
            desc: "30 t√¨nh hu·ªëng giao ti·∫øp trong m√¥i tr∆∞·ªùng c√¥ng ty",
            progress: 45,
            stats: "ƒê√£ h·ªçc: 14/30 t√¨nh hu·ªëng",
          },
          {
            title: "B√†i gi·∫£ng ƒê·∫°i h·ªçc",
            desc: "20 b√†i gi·∫£ng h·ªçc thu·∫≠t c√°c chuy√™n ng√†nh",
            progress: 20,
            stats: "ƒê√£ h·ªçc: 4/20 b√†i",
          },
          {
            title: "Ph·ªèng v·∫•n chuy√™n gia",
            desc: "15 cu·ªôc ph·ªèng v·∫•n v·ªõi chuy√™n gia c√°c lƒ©nh v·ª±c",
            progress: 15,
            stats: "ƒê√£ h·ªçc: 2/15 b√†i",
          },
        ],
      },
      reading: {
        title: "ƒê·ªåC HI·ªÇU",
        icon: "fas fa-file-alt",
        items: [
          {
            title: "VƒÉn b·∫£n H·ªçc thu·∫≠t",
            desc: "25 b√†i ƒë·ªçc v·ªÅ khoa h·ªçc, nghi√™n c·ª©u chuy√™n s√¢u",
            progress: 35,
            stats: "ƒê√£ h·ªçc: 9/25 b√†i",
          },
          {
            title: "B√°o ch√≠ - T·∫°p ch√≠",
            desc: "30 b√†i b√°o kinh t·∫ø, ch√≠nh tr·ªã, x√£ h·ªôi",
            progress: 40,
            stats: "ƒê√£ h·ªçc: 12/30 b√†i",
          },
          {
            title: "Ti·ªÉu thuy·∫øt - VƒÉn h·ªçc",
            desc: "15 tr√≠ch ƒëo·∫°n ti·ªÉu thuy·∫øt ƒë∆∞∆°ng ƒë·∫°i",
            progress: 25,
            stats: "ƒê√£ h·ªçc: 4/15 b√†i",
          },
          {
            title: "T√†i li·ªáu K·ªπ thu·∫≠t",
            desc: "20 t√†i li·ªáu k·ªπ thu·∫≠t, h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng",
            progress: 30,
            stats: "ƒê√£ h·ªçc: 6/20 b√†i",
          },
        ],
      },
    };
    /* =========================================================
TEST MODAL LOGIC - B√ÄI KI·ªÇM TRA TRONG MODULE T·ª™ V·ª∞NG
- Click v√†o content-item trong modal t·ª´ v·ª±ng -> m·ªü test modal
- Hi·ªÉn th·ªã danh s√°ch b√†i test t∆∞∆°ng ·ª©ng
- Click test item -> chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang html kh√°c
========================================================= */
    let __testModalSetupDone = false;
    let __openTestModalToken = 0;
    // D·ªØ li·ªáu b√†i ki·ªÉm tra cho t·ª´ng m·ª•c trong module t·ª´ v·ª±ng
    //B·∫Øt ƒë·∫ßu test data
    const testData = {
      // B√†i test cho "T·ª´ v·ª±ng Mimikara Oboeru"
      "T·ª´ v·ª±ng Mimikara Oboeru": {
        title: "Mimikara Oboeru N1",
        units: [
          {
            name: "Unit 1",
            tests: [
              {
                id: 1001,
                name: "T·ª´ v·ª±ng Mimikara Unit 1 (1-20)",
                questions: 39,
                time: "39 ph√∫t",
                difficulty: "Kh√≥",
                url: "Mimikara-1-1.html",
              },

              {
                id: 1002,
                name: "T·ª´ v·ª±ng Mimikara Unit 1 (21-40)",
                questions: 40,
                time: "40 ph√∫t",
                difficulty: "Kh√≥",
                url: "Mimikara-1-2.html",
              },
              {
                id: 1003,
                name: "T·ª´ v·ª±ng Mimikara Unit 1 (41-60)",
                questions: 36,
                time: "36 ph√∫t",
                difficulty: "Kh√≥",
                url: "Mimikara-1-3.html",
              },
              {
                id: 1004,
                name: "T·ª´ v·ª±ng Mimikara Unit 1 (61-80)",
                questions: 40,
                time: "40 ph√∫t",
                difficulty: "Kh√≥",
                url: "Mimikara-1-4.html",
              },
              {
                id: 1005,
                name: "T·ª´ v·ª±ng Mimikara Unit 1 (81-100)",
                questions: 40,
                time: "40 ph√∫t",
                difficulty: "Kh√≥",
                url: "Mimikara-1-5.html",
              }
            ],
          },
          {
            name: "Unit 2",
            tests: [
              {
                id: 2001,
                name: "T·ª´ v·ª±ng Mimikara Unit 2 (1-20)",
                questions: 19,
                time: "19 ph√∫t",
                difficulty: "D·ªÖ",
                url: "Mimikara-2-1.html",
              }
            ],
          }
        ],
      },
      // B√†i test cho "T·ª´ v·ª±ng ThaoLeJP"
      "T·ª´ v·ª±ng ThaoLeJP": {
        title: "T·ª´ v·ª±ng ThaoLeJP N1",
        tests: [
          {
            id: 1,
            name: "Test T·ª´ V·ª±ng Ng√†y 1",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-1.html",
          },
          {
            id: 2,
            name: "Test T·ª´ V·ª±ng Ng√†y 2",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-2.html",
          },
          {
            id: 3,
            name: "Test T·ª´ V·ª±ng Ng√†y 3",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-3.html",
          },
          {
            id: 4,
            name: "Test T·ª´ V·ª±ng Ng√†y 4",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-4.html",
          },
          {
            id: 5,
            name: "Test T·ª´ V·ª±ng Ng√†y 5",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-5.html",
          },
          {
            id: 6,
            name: "Test T·ª´ V·ª±ng Ng√†y 6",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-6.html",
          },
          {
            id: 7,
            name: "Test T·ª´ V·ª±ng Ng√†y 7",
            questions: 38,
            time: "38 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-7.html",
          },
          {
            id: 8,
            name: "Test T·ª´ V·ª±ng Ng√†y 8",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-8.html",
          },
          {
            id: 9,
            name: "Test T·ª´ V·ª±ng Ng√†y 9",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-9.html",
          },
          {
            id: 10,
            name: "Test T·ª´ V·ª±ng Ng√†y 10",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-10.html",
          },
          {
            id: 11,
            name: "Test T·ª´ V·ª±ng Ng√†y 11",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-11.html",
          },
          {
            id: 12,
            name: "Test T·ª´ V·ª±ng Ng√†y 12",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-12.html",
          },
          {
            id: 13,
            name: "Test T·ª´ V·ª±ng Ng√†y 13",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-13.html",
          },
          {
            id: 14,
            name: "Test T·ª´ V·ª±ng Ng√†y 14",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-14.html",
          },
          {
            id: 15,
            name: "Test T·ª´ V·ª±ng Ng√†y 15",
            questions: 40,
            time: "40 ph√∫t",
            difficulty: "Kh√≥",
            url: "vocab-15.html",
          },
        ],
      },
      // B√†i test cho "T·ª´ ƒë·ªìng nghƒ©a/Tr√°i nghƒ©a"
      "T·ª´ ƒë·ªìng nghƒ©a/Tr√°i nghƒ©a": {
        title: "T·ª´ ƒë·ªìng nghƒ©a - Tr√°i nghƒ©a N1",
        tests: [
          {
            id: 1,
            name: "B√†i test ƒê·ªìng nghƒ©a ph·∫ßn 1",
            questions: 20,
            time: "15 ph√∫t",
            difficulty: "Trung b√¨nh",
            url: "test-synonym1.html",
          },
          {
            id: 2,
            name: "B√†i test ƒê·ªìng nghƒ©a ph·∫ßn 2",
            questions: 20,
            time: "15 ph√∫t",
            difficulty: "Kh√≥",
            url: "test-synonym2.html",
          },
          {
            id: 3,
            name: "B√†i test Tr√°i nghƒ©a ph·∫ßn 1",
            questions: 20,
            time: "15 ph√∫t",
            difficulty: "Trung b√¨nh",
            url: "test-antonym1.html",
          },
          {
            id: 4,
            name: "B√†i test Tr√°i nghƒ©a ph·∫ßn 2",
            questions: 20,
            time: "15 ph√∫t",
            difficulty: "Kh√≥",
            url: "test-antonym2.html",
          },
          {
            id: 5,
            name: "B√†i test t·ªïng h·ª£p ƒê·ªìng nghƒ©a - Tr√°i nghƒ©a",
            questions: 40,
            time: "30 ph√∫t",
            difficulty: "Kh√≥",
            url: "test-synonym-antonym.html",
          },
        ],
      },
      // B√†i test cho "T·ª´ v·ª±ng kh√≥"
      "T·ª´ v·ª±ng kh√≥": {
        title: "T·ª´ v·ª±ng kh√≥ N1",
        tests: [
          {
            id: 1,
            name: "B√†i test T·ª´ v·ª±ng kh√≥ ƒë·ªÅ thi 2010-2015",
            questions: 30,
            time: "25 ph√∫t",
            difficulty: "Kh√≥",
            url: "test-hard-2010-2015.html",
          },
          {
            id: 2,
            name: "B√†i test T·ª´ v·ª±ng kh√≥ ƒë·ªÅ thi 2016-2020",
            questions: 30,
            time: "25 ph√∫t",
            difficulty: "Kh√≥",
            url: "test-hard-2016-2020.html",
          },
          {
            id: 3,
            name: "B√†i test T·ª´ v·ª±ng kh√≥ ƒë·ªÅ thi 2021-2025",
            questions: 30,
            time: "25 ph√∫t",
            difficulty: "Kh√≥",
            url: "test-hard-2021-2025.html",
          },
          {
            id: 4,
            name: "B√†i test T·ª´ v·ª±ng Kanji kh√≥",
            questions: 25,
            time: "20 ph√∫t",
            difficulty: "Kh√≥",
            url: "test-hard-kanji.html",
          },
          {
            id: 5,
            name: "B√†i test T·ª´ v·ª±ng Onomatopoeia",
            questions: 20,
            time: "15 ph√∫t",
            difficulty: "Kh√≥",
            url: "test-onomatopoeia.html",
          },
        ],
      },
    };
    //K·∫øt th√∫c test data

    // H√†m m·ªü test modal
    async function openTestModal(itemTitle) {
      const token = ++__openTestModalToken;
      const testModal = document.getElementById("testModal");
      const testBackdrop = document.getElementById("testModalBackdrop");
      const testList = document.getElementById("testList");
      const testModalTitle = document.getElementById("testModalTitle");

      // L·∫•y d·ªØ li·ªáu test t∆∞∆°ng ·ª©ng
      const testInfo = testData[itemTitle];

      if (!testInfo) {
        console.log("Kh√¥ng c√≥ d·ªØ li·ªáu test cho:", itemTitle);
        return;
      }

      // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ
      testModalTitle.textContent = testInfo.title;

      // X√≥a n·ªôi dung c≈©
      testList.innerHTML = "";

      // Ki·ªÉm tra n·∫øu c√≥ units (cho Mimikara)
      if (testInfo.units) {
        // T·∫°o container cho tabs
        const tabsContainer = document.createElement("div");
        tabsContainer.className = "unit-tabs";
        tabsContainer.style.marginBottom = "0";
        tabsContainer.style.padding = "10px";

        // T·∫°o container cho tests
        const testsContainer = document.createElement("div");
        testsContainer.className = "tests-container";
        testsContainer.style.width = "100%";

        const showUnitTests = async (unitIndex) => {
          const unit = testInfo.units[unitIndex];

          // ==== 0) Chu·∫©n b·ªã d·ªØ li·ªáu key cache ====
          const deviceId = localStorage.getItem(LS_DEVICE_ID) || "";
          const license = localStorage.getItem(LS_LICENSE) || "";
          const testIds = unit.tests.map((t) => t.url);

          // N·∫øu ch∆∞a c√≥ license th√¨ kh·ªèi load progress
          if (!license) {
            testsContainer.innerHTML = `<div class="loading-text">B·∫°n c·∫ßn k√≠ch ho·∫°t license ƒë·ªÉ xem ti·∫øn ƒë·ªô.</div>`;
            return;
          }

          // ==== 1) Check cache tr∆∞·ªõc ====
          const cacheOk = isProgressCacheValid(deviceId, license, testIds);

          // ==== 2) MISS -> show loading + skeleton ====
          if (!cacheOk) {
            showCyberLoading("ƒêANG T·∫¢I D·ªÆ LI·ªÜU");
            testsContainer.innerHTML = createSkeletonLoading();
            await new Promise(requestAnimationFrame);
          } else {
            // HIT -> kh√¥ng loading, kh√¥ng skeleton
            testsContainer.innerHTML = "";
          }

          // ==== 3) L·∫•y progress (HIT nhanh / MISS g·ªçi API) ====
          const r = await getCachedProgress(deviceId, license, testIds);
          const progressMap = r.data || {};

          // N·∫øu user b·∫•m qua unit kh√°c trong l√∫c ch·ªù -> b·ªè render
          if (token !== __openTestModalToken) return;

          // ==== 4) MISS -> hide loading khi xong ====
          if (!cacheOk) hideCyberLoading();

          // ==== 5) Render danh s√°ch tests ====
          testsContainer.innerHTML = "";
          const fragment = document.createDocumentFragment();

          unit.tests.forEach((test) => {
            const testItem = document.createElement("div");
            testItem.className = "test-item";
            testItem.setAttribute("data-test-url", test.url);
            testItem.setAttribute("data-test-name", test.name);

            const p = progressMap[test.url] || { perfectCount: 0 };
            const b = badgeFromProgress(p);

            const iconClass = b.icon || "fa-clock";
            const bgColor = b.bg || "rgba(255, 100, 0, 0.2)";
            const borderColor = b.border || "rgba(255, 150, 0, 0.3)";
            const textColor = b.color || "#ffaa00";
            const badgeText = b.text || "Ch∆∞a l√†m";

            testItem.innerHTML = `
      <div class="test-item-icon">
        <i class="fas ${iconClass}"></i>
      </div>
      <div class="test-item-content">
        <div class="test-item-title">${test.name}</div>
        <div class="test-item-meta">
          <span><i class="fas fa-question-circle"></i> ${test.questions} c√¢u</span>
          <span><i class="fas fa-hourglass-half"></i> ${test.time}</span>
          <span><i class="fas fa-signal"></i> ${test.difficulty}</span>
        </div>
      </div>
      <div class="test-status-badge"
        style="background:${bgColor}; border-color:${borderColor}; color:${textColor}">
        ${badgeText}
      </div>
    `;

            testItem.addEventListener("click", function (e) {
              e.preventDefault();
              e.stopPropagation();
              e.stopImmediatePropagation();

              const url = this.getAttribute("data-test-url");
              const newTab = window.open(
                url,
                "_blank",
                "noopener,noreferrer",
              );
              if (!newTab) return;
            });

            fragment.appendChild(testItem);
          });

          testsContainer.appendChild(fragment);
        };

        // T·∫°o c√°c tab unit
        testInfo.units.forEach((unit, index) => {
          const tab = document.createElement("button");
          tab.className = "unit-tab" + (index === 0 ? " active" : "");
          tab.textContent = unit.name;

          tab.addEventListener("click", async (e) => {
            e.preventDefault();
            e.stopPropagation();

            tabsContainer
              .querySelectorAll(".unit-tab")
              .forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            await showUnitTests(index);
          });

          tabsContainer.appendChild(tab);
        });

        testList.appendChild(tabsContainer);
        testList.appendChild(testsContainer);

        // ‚úÖ HI·ªÜN MODAL NGAY (TR∆Ø·ªöC KHI LOAD)
        testModal.classList.add("show");
        testBackdrop.classList.add("show");

        // ‚úÖ √âP RENDER MODAL + SKELETON 1 NH·ªäP
        await new Promise(requestAnimationFrame);

        // Hi·ªÉn th·ªã Unit 1 m·∫∑c ƒë·ªãnh
        await showUnitTests(0);

        return; // ‚úÖ ch·∫∑n kh√¥ng ch·∫°y xu·ªëng d∆∞·ªõi (tr√°nh show l·∫ßn 2)
      }
      // ==========================
      // ELSE: testInfo.tests (ThaoLeJP, ƒê·ªìng nghƒ©a/Tr√°i nghƒ©a, T·ª´ v·ª±ng kh√≥, ...)
      // ==========================
      if (testInfo.tests && Array.isArray(testInfo.tests)) {
        const deviceId = localStorage.getItem(LS_DEVICE_ID) || "";
        const license = localStorage.getItem(LS_LICENSE) || "";
        const testIds = testInfo.tests.map((t) => t.url);

        // Hi·ªán modal ngay
        testModal.classList.add("show");
        testBackdrop.classList.add("show");
        await new Promise(requestAnimationFrame);

        // N·∫øu ch∆∞a c√≥ license th√¨ v·∫´n cho xem list, nh∆∞ng kh√¥ng c√≥ ti·∫øn ƒë·ªô
        if (!license) {
          testList.innerHTML = "";
          testInfo.tests.forEach((test) => {
            const testItem = document.createElement("div");
            testItem.className = "test-item";
            testItem.setAttribute("data-test-url", test.url);
            testItem.setAttribute("data-test-name", test.name);

            testItem.innerHTML = `
        <div class="test-item-icon"><i class="fas fa-clock"></i></div>
        <div class="test-item-content">
          <div class="test-item-title">${test.name}</div>
          <div class="test-item-meta">
            <span><i class="fas fa-question-circle"></i> ${test.questions} c√¢u</span>
            <span><i class="fas fa-hourglass-half"></i> ${test.time}</span>
            <span><i class="fas fa-signal"></i> ${test.difficulty}</span>
          </div>
        </div>
        <div class="test-status-badge"
          style="background:rgba(255,100,0,0.2); border-color:rgba(255,150,0,0.3); color:#ffaa00">
          Ch∆∞a k√≠ch ho·∫°t
        </div>
      `;

            testItem.addEventListener("click", function (e) {
              e.preventDefault();
              e.stopPropagation();
              e.stopImmediatePropagation();
              const url = this.getAttribute("data-test-url");
              window.open(url, "_blank", "noopener,noreferrer");
            });

            testList.appendChild(testItem);
          });
          return;
        }

        // Cache check
        const cacheOk = isProgressCacheValid(deviceId, license, testIds);

        if (!cacheOk) {
          showCyberLoading("ƒêANG T·∫¢I D·ªÆ LI·ªÜU");
          testList.innerHTML = createSkeletonLoading();
          await new Promise(requestAnimationFrame);
        } else {
          testList.innerHTML = "";
        }

        const r = await getCachedProgress(deviceId, license, testIds);
        const progressMap = r.data || {};

        if (token !== __openTestModalToken) return;

        if (!cacheOk) hideCyberLoading();

        testList.innerHTML = "";
        const fragment = document.createDocumentFragment();

        testInfo.tests.forEach((test) => {
          const testItem = document.createElement("div");
          testItem.className = "test-item";
          testItem.setAttribute("data-test-url", test.url);
          testItem.setAttribute("data-test-name", test.name);

          const p = progressMap[test.url] || { perfectCount: 0 };
          const b = badgeFromProgress(p);

          const iconClass = b.icon || "fa-clock";
          const bgColor = b.bg || "rgba(255, 100, 0, 0.2)";
          const borderColor = b.border || "rgba(255, 150, 0, 0.3)";
          const textColor = b.color || "#ffaa00";
          const badgeText = b.text || "Ch∆∞a l√†m";

          testItem.innerHTML = `
      <div class="test-item-icon">
        <i class="fas ${iconClass}"></i>
      </div>
      <div class="test-item-content">
        <div class="test-item-title">${test.name}</div>
        <div class="test-item-meta">
          <span><i class="fas fa-question-circle"></i> ${test.questions} c√¢u</span>
          <span><i class="fas fa-hourglass-half"></i> ${test.time}</span>
          <span><i class="fas fa-signal"></i> ${test.difficulty}</span>
        </div>
      </div>
      <div class="test-status-badge"
        style="background:${bgColor}; border-color:${borderColor}; color:${textColor}">
        ${badgeText}
      </div>
    `;

          testItem.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            const url = this.getAttribute("data-test-url");
            window.open(url, "_blank", "noopener,noreferrer");
          });

          fragment.appendChild(testItem);
        });

        testList.appendChild(fragment);
        return;
      }
    }

    // H√†m ƒë√≥ng test modal
    function closeTestModal() {
      const testModal = document.getElementById("testModal");
      const testBackdrop = document.getElementById("testModalBackdrop");
      testModal.classList.remove("show");
      testBackdrop.classList.remove("show");
      // ‚úÖ C·∫≠p nh·∫≠t l·∫°i % ti·∫øn ƒë·ªô module ch√≠nh sau khi ƒë√≥ng popup b√†i test
      updateMainModulesProgress();
    }

    // Th√™m s·ª± ki·ªán click cho c√°c content-item trong modal t·ª´ v·ª±ng
    function setupTestModalInteractions() {
      if (__testModalSetupDone) return;
      __testModalSetupDone = true;

      // L·∫Øng nghe s·ª± ki·ªán click tr√™n frameContent (n∆°i ch·ª©a c√°c content-item)
      const frameContent = document.getElementById("frameContent");

      if (frameContent) {
        frameContent.addEventListener("click", function (e) {
          // T√¨m content-item ƒë∆∞·ª£c click
          const contentItem = e.target.closest(".content-item");
          if (!contentItem) return;

          // L·∫•y ti√™u ƒë·ªÅ c·ªßa content-item
          const itemTitleEl = contentItem.querySelector(".item-title");
          if (!itemTitleEl) return;

          // B·ªè qua k√Ω t·ª± icon, l·∫•y text
          let itemTitle = itemTitleEl.textContent.replace("‚óè", "").trim();
          if (!itemTitle) {
            itemTitle = itemTitleEl.innerText.replace(/[‚óè‚Ä¢‚ó¶]/g, "").trim();
          }

          console.log("Click v√†o content-item:", itemTitle);

          // Ki·ªÉm tra xem c√≥ d·ªØ li·ªáu test cho item n√†y kh√¥ng
          if (testData[itemTitle]) {
            openTestModal(itemTitle);
          } else {
            // Th·ª≠ t√¨m ki·∫øm g·∫ßn ƒë√∫ng
            const matchedKey = Object.keys(testData).find(
              (key) => itemTitle.includes(key) || key.includes(itemTitle),
            );

            if (matchedKey) {
              openTestModal(matchedKey);
            } else {
              console.log("Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu test cho:", itemTitle);
              // Alert th√¥ng b√°o demo
              alert(`B√†i ki·ªÉm tra cho "${itemTitle}" ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t!`);
            }
          }
        });
      }

      // ƒê√≥ng test modal b·∫±ng n√∫t X
      const closeBtn = document.getElementById("closeTestModalBtn");
      if (closeBtn) {
        closeBtn.addEventListener("click", closeTestModal);
      }

      // ƒê√≥ng test modal b·∫±ng click backdrop
      const testBackdrop = document.getElementById("testModalBackdrop");
      if (testBackdrop) {
        testBackdrop.addEventListener("click", closeTestModal);
      }

      // ƒê√≥ng b·∫±ng ESC
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          const testModal = document.getElementById("testModal");
          if (testModal.classList.contains("show")) {
            closeTestModal();
          }
        }
      });
    }
    // Th√™m d·ªØ li·ªáu test m·∫´u cho c√°c module kh√°c (t√πy ch·ªçn)
    testData["Ng·ªØ ph√°p VƒÉn vi·∫øt"] = {
      title: "Ng·ªØ ph√°p VƒÉn vi·∫øt N1",
      tests: [
        {
          id: 1,
          name: "B√†i test C·∫•u tr√∫c c√¢u ph·ª©c",
          questions: 15,
          time: "20 ph√∫t",
          difficulty: "Kh√≥",
          url: "test-writing-grammar1.html",
        },
        {
          id: 2,
          name: "B√†i test K√≠nh ng·ªØ trong vƒÉn vi·∫øt",
          questions: 20,
          time: "25 ph√∫t",
          difficulty: "Kh√≥",
          url: "test-writing-grammar2.html",
        },
      ],
    };

    testData["Nghe tin t·ª©c"] = {
      title: "Nghe tin t·ª©c NHK",
      tests: [
        {
          id: 1,
          name: "B√†i test Nghe tin t·ª©c s·ªë 1",
          questions: 10,
          time: "15 ph√∫t",
          difficulty: "Trung b√¨nh",
          url: "test-news1.html",
        },
        {
          id: 2,
          name: "B√†i test Nghe tin t·ª©c s·ªë 2",
          questions: 10,
          time: "15 ph√∫t",
          difficulty: "Trung b√¨nh",
          url: "test-news2.html",
        },
      ],
    };

    testData["VƒÉn b·∫£n H·ªçc thu·∫≠t"] = {
      title: "ƒê·ªçc hi·ªÉu h·ªçc thu·∫≠t",
      tests: [
        {
          id: 1,
          name: "B√†i ƒë·ªçc Khoa h·ªçc x√£ h·ªôi",
          questions: 8,
          time: "20 ph√∫t",
          difficulty: "Kh√≥",
          url: "test-academic1.html",
        },
        {
          id: 2,
          name: "B√†i ƒë·ªçc Khoa h·ªçc t·ª± nhi√™n",
          questions: 8,
          time: "20 ph√∫t",
          difficulty: "Kh√≥",
          url: "test-academic2.html",
        },
      ],
    };

    function getModuleCard(moduleId) {
      return document.querySelector(`[data-module="${moduleId}"]`);
    }

    function clearAllCardStates() {
      document
        .querySelectorAll(".module-card")
        .forEach((c) => c.classList.remove("locked"));
    }

    function openModal() {
      const modal = document.getElementById("moduleDisplay");
      const backdrop = document.getElementById("moduleBackdrop");
      modal.classList.add("show");
      backdrop.classList.add("show");
      modal.setAttribute("aria-hidden", "false");
    }

    function closeModal() {
      const modal = document.getElementById("moduleDisplay");
      const backdrop = document.getElementById("moduleBackdrop");
      modal.classList.remove("show");
      backdrop.classList.remove("show");
      modal.setAttribute("aria-hidden", "true");
    }

    async function renderModuleToModal(moduleId) {
      const data = moduleContents[moduleId];
      if (!data) return;

      const frameTitle = document.getElementById("frameTitle");
      const frameContent = document.getElementById("frameContent");
      const frameIcon = document.querySelector(".frame-icon i");
      const statusText = document.querySelector("#frameStatus .status-text");

      frameTitle.textContent = data.title;
      if (frameIcon) frameIcon.className = data.icon;
      if (statusText) statusText.textContent = `ƒêang xem: ${data.title}`;

      // Render khung tr∆∞·ªõc cho m∆∞·ª£t
      frameContent.innerHTML = "";

      // T·∫°o list item tr∆∞·ªõc (stats t·∫°m)
      const itemEls = [];
      data.items.forEach((item) => {
        const itemEl = document.createElement("div");
        itemEl.className = "content-item";

        // NOTE: g·∫Øn data-title ƒë·ªÉ sau update stats
        itemEl.setAttribute("data-item-title", item.title);

        itemEl.innerHTML = `
      <div class="item-title">
        <i class="fas fa-circle"></i> ${item.title}
      </div>
      <div class="item-desc">${item.desc}</div>
      <div class="item-stats">ƒê√£ h·ªçc: .../... </div>
      <div class="item-progress">
  <div class="item-progress-fill" style="width: 0%"></div>
</div>

    `;
        frameContent.appendChild(itemEl);
        itemEls.push(itemEl);
      });

      // ====== AUTO CALC: ch·ªâ l√†m cho module vocab (ƒë√∫ng y√™u c·∫ßu b·∫°n) ======
      if (moduleId !== "vocab") return;

      // N·∫øu ch∆∞a k√≠ch ho·∫°t license: v·∫´n t√≠nh b (t·ªïng), a=0
      const license = localStorage.getItem(LS_LICENSE) || "";
      const hasLicense = !!license;

      // L√†m t·ª´ng item (kh√¥ng show loading to√†n m√†n h√¨nh ƒë·ªÉ ƒë·ª° kh√≥ ch·ªãu)
      // Nh∆∞ng v·∫´n t·∫≠n d·ª•ng cache progress ƒë·ªÉ kh√¥ng g·ªçi API nhi·ªÅu l·∫ßn
      for (const el of itemEls) {
        const itemTitle = el.getAttribute("data-item-title") || "";
        const statsEl = el.querySelector(".item-stats");
        if (!statsEl) continue;

        const testInfo = testData[itemTitle];
        const tests = flattenTestsFromTestInfo(testInfo);

        // N·∫øu item ch∆∞a c√≥ testData -> gi·ªØ nguy√™n / b√°o c·∫≠p nh·∫≠t
        if (!testInfo || !tests.length) {
          statsEl.textContent = "ƒê√£ h·ªçc: 0/0";
          continue;
        }

        // T√≠nh b lu√¥n (kh√¥ng c·∫ßn progress)
        const { a: a0, b } = calcABFromTests(tests, {}); // a0 = 0
        if (!hasLicense) {
          statsEl.textContent = `ƒê√£ h·ªçc: 0/${b}`;
          const progressFill = el.querySelector(".item-progress-fill");
          if (progressFill) progressFill.style.width = "0%";
          continue;
        }

        // C√≥ license -> l·∫•y progressMap v√† t√≠nh a/b chu·∫©n
        try {
          const progressMap = await getProgressMapForItemTitle(itemTitle);
          const { a, b: b2 } = calcABFromTests(tests, progressMap);
          statsEl.textContent = `ƒê√£ h·ªçc: ${a}/${b2}`;
          const progressFill = el.querySelector(".item-progress-fill");
          if (progressFill) {
            const percent = b2 > 0 ? Math.floor((a / b2) * 100) : 0;
            progressFill.style.width = percent + "%";
          }
        } catch {
          // N·∫øu l·ªói server => v·∫´n hi·ªÉn th·ªã b
          statsEl.textContent = `ƒê√£ h·ªçc: 0/${b}`;
        }
      }
    }

    async function lockAndOpen(moduleId) {
      lockedModule = moduleId;

      clearAllCardStates();
      const card = getModuleCard(moduleId);
      if (card) card.classList.add("locked");
      openModal();
      await renderModuleToModal(moduleId);
    }

    function unlockAndClose() {
      lockedModule = null;
      clearAllCardStates();
      closeModal();
    }

    function setupModuleInteractions() {
      document.querySelectorAll(".module-card").forEach((card) => {
        const moduleId = card.getAttribute("data-module");
        card.addEventListener("click", async (e) => {
          e.preventDefault();
          await lockAndOpen(moduleId);
        });

        card.addEventListener("contextmenu", (e) => e.preventDefault());
      });

      // ƒê√≥ng b·∫±ng n√∫t
      document
        .getElementById("closeModalBtn")
        .addEventListener("click", unlockAndClose);

      // ƒê√≥ng b·∫±ng click backdrop
      document
        .getElementById("moduleBackdrop")
        .addEventListener("click", unlockAndClose);

      // ESC ƒë√≥ng
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && lockedModule) unlockAndClose();
      });
    }

    /* =========================================================
    App UI
  ========================================================= */
    function runAppUI() {
      // Progress bars
      ["vocab", "grammar", "listening", "reading"].forEach((m) => {
        const fill = document.getElementById(`progress-${m}`);
        const pct = document.getElementById(`percent-${m}`);
        if (fill) fill.style.width = "0%";
        if (pct) pct.textContent = "0%";
      });

      // Start button ripple
      const startButton = document.querySelector(".start-button");
      startButton.addEventListener("click", function (e) {
        e.preventDefault();
        const ripple = document.createElement("div");
        ripple.style.position = "fixed";
        ripple.style.borderRadius = "50%";
        ripple.style.backgroundColor = "rgba(0, 168, 255, 0.6)";
        ripple.style.width = "10px";
        ripple.style.height = "10px";
        ripple.style.left = `${e.clientX}px`;
        ripple.style.top = `${e.clientY}px`;
        ripple.style.transform = "translate(-50%, -50%)";
        ripple.style.zIndex = "1000";
        ripple.style.pointerEvents = "none";
        document.body.appendChild(ripple);

        const animation = ripple.animate(
          [
            { width: "10px", height: "10px", opacity: 1 },
            { width: "200px", height: "200px", opacity: 0 },
          ],
          { duration: 800, easing: "ease-out" },
        );
        animation.onfinish = () => ripple.remove();

        setTimeout(() => {
          alert(
            "H·ªá th·ªëng h·ªçc t·∫≠p N1 ƒëang kh·ªüi ƒë·ªông...\nChu·∫©n b·ªã cho nhi·ªám v·ª• ng√†y h√¥m nay!",
          );
        }, 300);
      });

      // Streak counter
      const streakDays = document.querySelector(".streak-days");
      let count = 0;
      const targetCount = 5;
      const countInterval = setInterval(() => {
        count++;
        streakDays.textContent = `${count} NG√ÄY`;
        if (count === targetCount) clearInterval(countInterval);
      }, 200);

      setupModuleInteractions();
      setupTestModalInteractions();
      updateMainModulesProgress();

      // Expiry check khi m·ªü app
      const savedExpiry = localStorage.getItem("n1_expiry_date");
      if (savedExpiry) updateStatusUI(savedExpiry);

      console.log("App UI initialized");
    }

    /* =========================================================
    Boot
  ========================================================= */
    (async function boot() {
      const deviceId = getOrCreateDeviceId();
      fillDeviceUI(deviceId);

      const savedLicense = localStorage.getItem(LS_LICENSE) || "";
      const licenseInput = document.getElementById("licenseInput");
      if (savedLicense) licenseInput.value = savedLicense;

      const savedName = localStorage.getItem(LS_USER_NAME);
      if (savedName) setUserName(savedName);

      updateExamUI("");
      setInterval(() => updateExamUI(""), 60 * 1000);

      // [QUAN TR·ªåNG] Ki·ªÉm tra tr·∫°ng th√°i k√≠ch ho·∫°t NGAY L·∫¨P T·ª®C
      const activatedOnce = localStorage.getItem(LS_ACTIVATED) === "1";
      if (activatedOnce && savedLicense) {
        // N·∫øu ƒë√£ k√≠ch ho·∫°t: ·∫®n gate v√† HI·ªÇN TH·ªä APP ngay l·∫≠p t·ª©c
        showGate(false);
        runAppUI();
        startBackgroundRecheck(deviceId);
      } else {
        // N·∫øu ch∆∞a k√≠ch ho·∫°t: Hi·ªán gate
        showGate(true);
      }

      // H√†m x·ª≠ l√Ω khi k√≠ch ho·∫°t th√†nh c√¥ng
      async function handleVerifiedOK(r, licenseUsed) {
        localStorage.setItem(LS_LICENSE, licenseUsed);
        localStorage.setItem(LS_ACTIVATED, "1");

        setStatus(`K√≠ch ho·∫°t OK (h·∫°n: ${r.expiry})`, "ok");
        updateStatusUI(r.expiry);
        localStorage.setItem("n1_expiry_date", r.expiry);

        if (r.userName) setUserName(r.userName);
        if (r.examDate) localStorage.setItem(LS_EXAM_DATE, r.examDate);
        updateExamUI(r.examDate);

        if (r.userId) localStorage.setItem(LS_USER_ID, r.userId);

        showGate(false);
        runAppUI();
        startBackgroundRecheck(deviceId);
      }

      // N·∫øu ƒë√£ c√≥ license l∆∞u s·∫µn -> verify NGAY L·∫¨P T·ª®C (ki·ªÉm tra l·∫°i v·ªõi server)
      if (savedLicense) {
        setStatus("ƒêang ki·ªÉm tra license...", "");
        try {
          const r = await verifyLicense(deviceId, savedLicense);
          if (r && r.ok) {
            // C·∫≠p nh·∫≠t l·∫°i th√¥ng tin t·ª´ server
            localStorage.setItem(LS_ACTIVATED, "1");
            setStatus(`K√≠ch ho·∫°t OK (h·∫°n: ${r.expiry})`, "ok");
            updateStatusUI(r.expiry);
            localStorage.setItem("n1_expiry_date", r.expiry);

            if (r.userName) setUserName(r.userName);
            if (r.examDate) localStorage.setItem(LS_EXAM_DATE, r.examDate);
            updateExamUI(r.examDate);
            return;
          }
          throw new Error("Verify failed");
        } catch (e) {
          const msg = String(e?.message || "");
          const hardBlock =
            msg.includes("Device revoked") ||
            msg.includes("User revoked") ||
            msg.includes("Expired") ||
            msg.includes("Invalid") ||
            msg.includes("License not found") ||
            msg.includes("already bound");

          if (hardBlock) {
            localStorage.removeItem(LS_LICENSE);
            localStorage.removeItem(LS_ACTIVATED);
            setStatus(
              "License ƒë√£ b·ªã thu h·ªìi/kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p license m·ªõi.",
              "error",
            );
            showGate(true); // Hi·ªán gate n·∫øu license kh√¥ng c√≤n h·ª£p l·ªá
          } else {
            setStatus(
              "Kh√¥ng ki·ªÉm tra ƒë∆∞·ª£c license (server l·ªói / m·∫•t m·∫°ng).",
              "error",
            );
            // Gi·ªØ nguy√™n tr·∫°ng th√°i (n·∫øu ƒë√£ ·∫©n gate th√¨ v·∫´n ·∫©n, n·∫øu ch∆∞a th√¨ v·∫´n hi·ªán)
          }
        }
      }
      // N√∫t copy deviceId
      document
        .getElementById("btnCopyDevice")
        .addEventListener("click", async () => {
          await copyText(deviceId);
          setStatus(
            "ƒê√£ copy deviceID. G·ª≠i deviceID n√†y ƒë·ªÉ c·∫•p license.",
            "ok",
          );
        });

      // N√∫t k√≠ch ho·∫°t
      document
        .getElementById("btnActivate")
        .addEventListener("click", async () => {
          const license = licenseInput.value.trim();
          if (!license) return setStatus("B·∫°n ch∆∞a nh·∫≠p license", "error");

          setStatus("ƒêang k√≠ch ho·∫°t...", "");
          try {
            const r = await verifyLicense(deviceId, license);
            if (r && r.ok) {
              await handleVerifiedOK(r, license);
            } else {
              setStatus("License kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n", "error");
            }
          } catch (e) {
            const msg = String(e?.message || "unknown");
            if (msg.includes("User revoked"))
              setStatus(
                "T√†i kho·∫£n ƒë√£ b·ªã kh√≥a (User revoked). Li√™n h·ªá admin.",
                "error",
              );
            else if (msg.includes("Device revoked"))
              setStatus(
                "Thi·∫øt b·ªã ƒë√£ b·ªã kh√≥a (Device revoked). Li√™n h·ªá admin.",
                "error",
              );
            else if (msg.includes("Expired"))
              setStatus("License ƒë√£ h·∫øt h·∫°n", "error");
            else if (msg.includes("Invalid"))
              setStatus("License kh√¥ng h·ª£p l·ªá", "error");
            else if (msg.includes("License not found"))
              setStatus("License kh√¥ng t·ªìn t·∫°i tr√™n server", "error");
            else if (msg.includes("already bound"))
              setStatus("License ƒë√£ ƒë∆∞·ª£c d√πng tr√™n thi·∫øt b·ªã kh√°c", "error");
            else setStatus("K√≠ch ho·∫°t th·∫•t b·∫°i: " + msg, "error");
          }
        });
      // N√∫t y√™u c·∫ßu c·∫•p l·∫°i
      document
        .getElementById("btnRequestReset")
        .addEventListener("click", async () => {
          const oldLicense =
            licenseInput.value.trim() ||
            localStorage.getItem(LS_LICENSE) ||
            "";
          const note =
            prompt(
              "Nh·∫≠p l√Ω do c·∫•p l·∫°i (vd: ƒë·ªïi m√°y / c√†i l·∫°i Windows / x√≥a tr√¨nh duy·ªát):",
            ) || "";
          const requestCode = `RESET|deviceId=${deviceId}|oldLicense=${oldLicense}|note=${note}`;
          await copyText(requestCode);
          setStatus(
            "ƒê√£ copy m√£ y√™u c·∫ßu c·∫•p l·∫°i. D√°n m√£ n√†y g·ª≠i cho ban qu·∫£n tr·ªã.",
            "ok",
          );
          try {
            await requestReset(deviceId, oldLicense, note);
          } catch { }
        });
    })();
    // ==================== STREAK DASHBOARD FUNCTIONS ====================

    // Format ng√†y th√°ng
    function formatDate(date) {
      const day = date.getDate().toString().padStart(2, "0");
      const month = (date.getMonth() + 1).toString().padStart(2, "0");
      return `${day}/${month}`;
    }
    // C·∫≠p nh·∫≠t streak t·ª´ localStorage
    function updateStreak() {
      const streakEl = document.getElementById("streakDays");
      const activationDate = localStorage.getItem("activationDate");

      if (activationDate) {
        const start = new Date(activationDate);
        const today = new Date();
        const diffTime = Math.abs(today - start);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (streakEl) {
          streakEl.textContent = `${diffDays} NG√ÄY`;

          // Animation
          streakEl.style.transform = "scale(1.1)";
          setTimeout(() => (streakEl.style.transform = ""), 300);
        }
      }
    }

    // C·∫≠p nh·∫≠t activation footer
    function updateActivationFooter() {
      const footer = document.getElementById("activationFooter");
      const activationDate = localStorage.getItem("activationDate");

      if (activationDate) {
        const date = new Date(activationDate);
        const day = date.getDate().toString().padStart(2, "0");
        const month = (date.getMonth() + 1).toString().padStart(2, "0");
        const year = date.getFullYear();

        const textEl = document.getElementById("activationText");
        if (textEl) {
          textEl.textContent = `H·ªÜ TH·ªêNG LUY·ªÜN THI N1 ƒê√É K√çCH HO·∫†T ${day}/${month}/${year}`;
        }
      }
    }

    // C·∫≠p nh·∫≠t h√†m setupTaskInteractions ƒë·ªÉ kh√¥ng xung ƒë·ªôt v·ªõi n√∫t x√≥a
    function setupTaskInteractions() {
      const taskItems = document.querySelectorAll(
        ".current-tasks .task-item",
      );

      taskItems.forEach((item) => {
        // Ch·ªâ x·ª≠ l√Ω click khi kh√¥ng click v√†o n√∫t x√≥a
        item.addEventListener("click", function (e) {
          if (e.target.closest(".task-delete")) return; // B·ªè qua n·∫øu click v√†o n√∫t x√≥a

          const checkbox = this.querySelector(".task-checkbox i");
          const isCompleted = this.classList.contains("completed");

          if (isCompleted) {
            this.classList.remove("completed");
            checkbox.className = "far fa-square";
          } else {
            this.classList.add("completed");
            checkbox.className = "fas fa-check";
          }

          // C·∫≠p nh·∫≠t progress bar
          updateProgress();
        });
      });
    }

    // C·∫≠p nh·∫≠t progress bar
    function updateProgress() {
      const tasks = document.querySelectorAll(".current-tasks .task-item");
      const completed = document.querySelectorAll(
        ".current-tasks .task-item.completed",
      );

      const total = tasks.length;
      const done = completed.length;
      const percent = total > 0 ? Math.round((done / total) * 100) : 0;

      const progressFill = document.getElementById("currentProgressFill");
      const progressText = document.getElementById("currentProgressText");

      if (progressFill) progressFill.style.width = percent + "%";
      if (progressText) progressText.textContent = `${done}/${total}`;
    }
    // C·∫≠p nh·∫≠t l·∫°i h√†m setupDeleteButtons
    function setupDeleteButtons() {
      const deleteButtons = document.querySelectorAll(".task-delete");

      deleteButtons.forEach((btn) => {
        btn.addEventListener("click", function (e) {
          e.stopPropagation(); // Kh√¥ng trigger click c·ªßa task item

          const taskItem = this.closest(".task-item");
          deleteTask(taskItem);
        });
      });
    }
    // C·∫≠p nh·∫≠t l·∫°i h√†m setupAddTask (ƒë∆°n gi·∫£n h∆°n)
    function setupAddTask() {
      renderPlaceholder(); // Ch·ªâ c·∫ßn render placeholder
    }
    // Hi·ªÉn th·ªã placeholder trong danh s√°ch
    function renderPlaceholder() {
      const nextTaskList = document.getElementById("nextTaskList");
      if (!nextTaskList) return;

      // Ki·ªÉm tra xem ƒë√£ c√≥ placeholder ch∆∞a
      let placeholder = document.getElementById("addTaskPlaceholder");

      if (!placeholder) {
        placeholder = document.createElement("div");
        placeholder.id = "addTaskPlaceholder";
        placeholder.className = "task-placeholder";
        placeholder.innerHTML = `
            <i class="fas fa-plus-circle"></i>
            <span class="task-name"><em>Th√™m nhi·ªám v·ª• m·ªõi...</em></span>
            <span class="placeholder-icon"><i class="fas fa-chevron-right"></i></span>
          `;

        // Th√™m s·ª± ki·ªán click
        placeholder.addEventListener("click", addNewTask);
      }

      // Lu√¥n ƒë·∫∑t placeholder ·ªü cu·ªëi danh s√°ch
      nextTaskList.appendChild(placeholder);
    }
    // H√†m th√™m task m·ªõi (t√°ch ri√™ng)
    function addNewTask() {
      const taskName = prompt("Nh·∫≠p t√™n nhi·ªám v·ª• m·ªõi cho ng√†y mai:");
      if (taskName && taskName.trim()) {
        const nextTaskList = document.getElementById("nextTaskList");

        // T·∫°o task item m·ªõi
        const taskItem = document.createElement("div");
        taskItem.className = "task-item next-task";
        taskItem.innerHTML = `
            <div class="task-bullet">‚Ä¢</div>
            <div class="task-content">
              <div class="task-name">${taskName}</div>
            </div>
            <div class="task-delete" title="X√≥a nhi·ªám v·ª•">
              <i class="fas fa-times"></i>
            </div>
          `;

        // Th√™m task m·ªõi TR∆Ø·ªöC placeholder
        const placeholder = document.getElementById("addTaskPlaceholder");
        nextTaskList.insertBefore(taskItem, placeholder);

        // G√°n s·ª± ki·ªán x√≥a cho task m·ªõi
        const newDeleteBtn = taskItem.querySelector(".task-delete");
        newDeleteBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          deleteTask(this.closest(".task-item"));
        });

        // G√°n s·ª± ki·ªán click cho task m·ªõi (n·∫øu c·∫ßn)
        taskItem.addEventListener("click", function (e) {
          if (e.target.closest(".task-delete")) return;
          // X·ª≠ l√Ω click v√†o task n·∫øu c·∫ßn
        });
      }
    }
    // H√†m x√≥a task (t√°ch ri√™ng)
    function deleteTask(taskItem) {
      const isNextTask = taskItem.closest(".next-tasks") !== null;

      // Animation x√≥a
      taskItem.style.transform = "scale(0.8)";
      taskItem.style.opacity = "0";

      setTimeout(() => {
        taskItem.remove();

        // C·∫≠p nh·∫≠t progress n·∫øu l√† task hi·ªán t·∫°i
        if (!isNextTask) {
          updateProgress();
        }
      }, 300);
    }
    // X·ª≠ l√Ω n√∫t xem l·ªãch s·ª≠
    function setupHistoryButton() {
      const historyBtn = document.getElementById("viewHistoryBtn");

      if (historyBtn) {
        historyBtn.addEventListener("click", function () {
          alert(
            "üìú T√çNH NƒÇNG L·ªäCH S·ª¨ ƒêANG PH√ÅT TRI·ªÇN!\n\nS·∫Ω s·ªõm ra m·∫Øt trong phi√™n b·∫£n ti·∫øp theo.",
          );
        });
      }
    }

    // C·∫≠p nh·∫≠t l·∫°i h√†m initStreakDashboard
    function initStreakDashboard() {
      updateStreak();
      updateActivationFooter();
      setupTaskInteractions();
      setupDeleteButtons();
      setupAddTask(); // S·∫Ω g·ªçi renderPlaceholder()
      setupHistoryButton();
      updateProgress();
    }

    // G·ªçi kh·ªüi t·∫°o sau khi trang load
    document.addEventListener("DOMContentLoaded", initStreakDashboard);

    /* =========================================================
       TC-RING UPDATE ‚Äî ƒë·ªçc s·ªë ng√†y t·ª´ DOM, kh√¥ng can thi·ªáp logic
       chu vi r=38: 2œÄ√ó38 ‚âà 238.76
    ========================================================= */
    (function () {
      const CIRC = 238.76;
      const MAX_DAY = 365; // base 100% = 365 ng√†y

      function setRing(fillId, glowId, labelId, days) {
        const fill = document.getElementById(fillId);
        const glow = document.getElementById(glowId);
        const label = document.getElementById(labelId);
        if (!fill || !glow || !label) return;

        const d = Math.max(0, days);
        label.textContent = d > 0 ? d : (days === 0 ? '0' : '‚Äî');

        const pct = Math.min(1, d / MAX_DAY);
        const offset = CIRC * (1 - pct);

        // reset v·ªÅ 0, r·ªìi animate t·ªõi gi√° tr·ªã ƒë√∫ng
        fill.style.transition = 'none';
        glow.style.transition = 'none';
        fill.style.strokeDashoffset = CIRC;
        glow.style.strokeDashoffset = CIRC;
        requestAnimationFrame(function () {
          fill.style.transition = 'stroke-dashoffset 1.4s cubic-bezier(.23,1,.32,1)';
          glow.style.transition = 'stroke-dashoffset 1.4s cubic-bezier(.23,1,.32,1)';
          fill.style.strokeDashoffset = offset;
          glow.style.strokeDashoffset = offset;
        });
      }

      /* --- ƒê·ªçc s·ªë ng√†y t·ª´ text element (kh√¥ng t√≠nh l·∫°i) --- */
      function parseDaysFromText(text) {
        if (!text) return null;
        // kh·ªõp "C√≤n 123 ng√†y" ho·∫∑c "C√≤n 2 th√°ng 5 ng√†y" ‚Üí l·∫•y t·ªïng ng√†y
        const totalMatch = text.match(/C√≤n\s+(\d+)\s+ng√†y/);
        if (totalMatch) return parseInt(totalMatch[1], 10);
        // c√≥ th√°ng: t√≠nh x·∫•p x·ªâ th√°ng*30 + ng√†y
        const monthMatch = text.match(/C√≤n\s+(\d+)\s+th√°ng\s+(\d+)\s+ng√†y/);
        if (monthMatch) return parseInt(monthMatch[1], 10) * 30 + parseInt(monthMatch[2], 10);
        if (text.includes('ƒë√£ di·ªÖn ra') || text.includes('h·∫øt h·∫°n')) return 0;
        return null;
      }

      function updateRings() {
        // √î Th·ªùi h·∫°n: ƒë·ªçc t·ª´ #examCountdown
        const examEl = document.getElementById('examCountdown');
        if (examEl) {
          const d = parseDaysFromText(examEl.textContent);
          if (d !== null) setRing('tcRingFill1', 'tcRingGlow1', 'tcRingDays1', d);
        }

        // √î Tr·∫°ng th√°i: ƒë·ªçc t·ª´ #statusSubtitle (c√≥ ch·ª©a "C√≤n X ng√†y")
        const statusEl = document.getElementById('statusSubtitle');
        if (statusEl) {
          const d = parseDaysFromText(statusEl.textContent || statusEl.innerText);
          if (d !== null) setRing('tcRingFill2', 'tcRingGlow2', 'tcRingDays2', d);
        }
      }

      // Ch·∫°y sau DOMContentLoaded + delay ƒë·ªÉ JS ch∆∞∆°ng tr√¨nh set xong
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function () { setTimeout(updateRings, 500); });
      } else {
        setTimeout(updateRings, 500);
      }

      // MutationObserver ƒë·ªÉ c·∫≠p nh·∫≠t khi n·ªôi dung text thay ƒë·ªïi (license activate, v.v.)
      function observe(elId, ringFill, ringGlow, ringLabel) {
        const el = document.getElementById(elId);
        if (!el) return;
        new MutationObserver(function () {
          const d = parseDaysFromText(el.textContent || el.innerText);
          if (d !== null) setRing(ringFill, ringGlow, ringLabel, d);
        }).observe(el, { childList: true, subtree: true, characterData: true });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function () {
          observe('examCountdown', 'tcRingFill1', 'tcRingGlow1', 'tcRingDays1');
          observe('statusSubtitle', 'tcRingFill2', 'tcRingGlow2', 'tcRingDays2');
        });
      } else {
        observe('examCountdown', 'tcRingFill1', 'tcRingGlow1', 'tcRingDays1');
        observe('statusSubtitle', 'tcRingFill2', 'tcRingGlow2', 'tcRingDays2');
      }
    })();

    // =========================================================
    //  TARGET CARD CANVAS GRIDS
    // =========================================================
    (function initTargetCardCanvases() {
      const configs = [
        { id: 'tcCanvas0', r0: 0, g0: 40, b0: 80, rB: 8, gB: 55, bB: 70 },
        { id: 'tcCanvas1', r0: 40, g0: 30, b0: 0, rB: 12, gB: 40, bB: 0 },
        { id: 'tcCanvas2', r0: 0, g0: 45, b0: 30, rB: 0, gB: 55, bB: 35 },
      ];
      const t0 = performance.now();
      const hoverMap = { tcCanvas0: 0, tcCanvas1: 0, tcCanvas2: 0 };

      configs.forEach(({ id, r0, g0, b0, rB, gB, bB }, idx) => {
        const canvas = document.getElementById(id);
        if (!canvas) return;
        const card = document.getElementById('tcCard' + idx);

        function resize() {
          canvas.width = canvas.offsetWidth * devicePixelRatio;
          canvas.height = canvas.offsetHeight * devicePixelRatio;
        }

        function drawFrame(now) {
          const dpr = devicePixelRatio;
          const W = canvas.width, H = canvas.height;
          if (!W || !H) { requestAnimationFrame(drawFrame); return; }
          const ctx = canvas.getContext('2d');
          ctx.clearRect(0, 0, W, H);

          const t = (now - t0) * 0.0007;
          const hp = hoverMap[id];
          hoverMap[id] += (((card && card.matches(':hover')) ? 1 : 0) - hp) * 0.06;

          const cw = 18 * dpr, ch = 16 * dpr, gx = 3 * dpr, gy = 3 * dpr;
          const sx = cw + gx, sy = ch + gy;
          const cols = Math.ceil(W / sx) + 2;
          const rows = Math.ceil(H / sy) + 2;

          for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
              const nx = col / Math.max(cols - 1, 1);
              const ny = row / Math.max(rows - 1, 1);
              const angle = 0.2 + nx * 1.1;
              const diff = Math.max(0, Math.cos(angle));
              const vert = 0.75 + 0.5 * (1 - ny);
              const shim = 0.07 * Math.sin(nx * 5 - t * 2 + ny * 3);
              const extra = hp * 0.15 * Math.sin(nx * 4 + t * 1.5);
              const B = Math.min(1, Math.max(0, diff * vert + shim + extra));

              const scaleX = 1 - nx * 0.3;
              const drawW = Math.round(cw * scaleX);
              if (drawW < 2 * dpr) continue;

              const rx = Math.round(col * sx);
              const ry = Math.round(row * sy);
              const rh = Math.round(ch);

              const vb = hp * 15;
              const r = Math.round(r0 + B * (rB + vb * .3));
              const g = Math.round(g0 + B * (gB + vb));
              const b = Math.round(b0 + B * (bB + vb));
              const a = (0.06 + B * 0.26 + hp * 0.05).toFixed(3);

              ctx.fillStyle = `rgba(${r},${g},${b},${a})`;
              ctx.fillRect(rx, ry, drawW, rh);

              // top highlight
              const hi = (B * 0.1 + hp * 0.04).toFixed(3);
              const hg = ctx.createLinearGradient(rx, ry, rx, ry + rh * .45);
              hg.addColorStop(0, `rgba(255,255,255,${hi})`);
              hg.addColorStop(1, 'rgba(255,255,255,0)');
              ctx.fillStyle = hg;
              ctx.fillRect(rx, ry, drawW, rh * .45);

              // bottom shadow
              const sh = (0.35 * (1 - B * 0.5)).toFixed(3);
              const sg = ctx.createLinearGradient(rx, ry + rh * .6, rx, ry + rh);
              sg.addColorStop(0, 'rgba(0,0,0,0)');
              sg.addColorStop(1, `rgba(0,0,0,${sh})`);
              ctx.fillStyle = sg;
              ctx.fillRect(rx, ry + rh * .6, drawW, rh * .4);

              // border
              ctx.strokeStyle = `rgba(0,190,235,${(0.02 + B * 0.07).toFixed(3)})`;
              ctx.lineWidth = dpr * 0.5;
              ctx.strokeRect(rx + .5, ry + .5, drawW - 1, rh - 1);
            }
          }

          // left fade
          const fl = ctx.createLinearGradient(0, 0, W * 0.5, 0);
          fl.addColorStop(0, 'rgba(4,13,26,1)');
          fl.addColorStop(0.55, 'rgba(4,13,26,0.8)');
          fl.addColorStop(1, 'rgba(4,13,26,0)');
          ctx.fillStyle = fl; ctx.fillRect(0, 0, W * 0.5, H);

          // top/bottom fade
          const ft = ctx.createLinearGradient(0, 0, 0, H * .15);
          ft.addColorStop(0, 'rgba(4,13,26,.9)'); ft.addColorStop(1, 'rgba(4,13,26,0)');
          ctx.fillStyle = ft; ctx.fillRect(0, 0, W, H * .15);
          const fb = ctx.createLinearGradient(0, H * .82, 0, H);
          fb.addColorStop(0, 'rgba(4,13,26,0)'); fb.addColorStop(1, 'rgba(4,13,26,.9)');
          ctx.fillStyle = fb; ctx.fillRect(0, H * .82, W, H * .18);

          requestAnimationFrame(drawFrame);
        }

        window.addEventListener('resize', resize);
        resize();
        requestAnimationFrame(drawFrame);
      });
    })();
  </script>
  <!-- CYBER LOADING OVERLAY -->
  <div class="cyber-loading" id="cyberLoading">
    <div class="cyber-loading-box">
      <div class="cyber-loading-title">
        <span id="cyberLoadingText">ƒêANG T·∫¢I D·ªÆ LI·ªÜU</span>
        <span id="cyberLoadingPercent" style="margin-left: 10px">0%</span>
      </div>
      <div class="cyber-loading-bar">
        <div class="cyber-loading-bar-fill"></div>
      </div>
      <div class="cyber-loading-sub">SYSTEM PROCESSING...</div>
    </div>
  </div>
</body>

</html>