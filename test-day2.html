<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>N1 BÃ i test ngÃ y 2</title>
<style>
  
  body { 
    font-family: Arial; 
    padding: 20px; 
    max-width: 900px; 
    margin: auto; 
    overflow-x: hidden;
  }
  h1, h2, h3 { 
    color: #2c3e50; 
  }
  .nav a { 
    display: block; 
    margin: 10px 0; 
    font-size: 18px; 
    text-decoration: none; 
    color: #007acc; 
  }
  .section { 
    border: 1px solid #ccc; 
    padding: 20px; 
    margin-bottom: 30px; 
    border-radius: 10px; 
  }
  .question-block { 
    margin-bottom: 20px; 
    position: relative; /* Cho phÃ©p chá»©a cÃ¡c control gÃ³c pháº£i */
  }
  .answer-option { 
    display: block; 
    margin-bottom: 5px; 
  }
  .answer-option:hover {
    cursor: pointer;/* Di chuá»™t vÃ o Ä‘Ã¡p Ã¡n sáº½ thÃ nh biá»ƒu tÆ°á»£ng bÃ n tay */
  }
  .answer-option:hover {
    cursor: pointer;
    color: #1e88e5;/* Di chuá»™t vÃ o Ä‘Ã¡p Ã¡n sáº½ cÃ³ mÃ u xanh */
  }
  .score-display {
    color: #2e7d32;
    font-weight: bold;
    font-size: 0.9em;
    margin-left: 5px;
  }
  .correct-answer { 
    color: #2e7d32; 
  }
  .wrong-answer { 
    color: #c62828; 
  }
  #quizResult {
    margin: 15px 0;
    padding: 10px;
    background-color: #f5f5f5;
    border-radius: 5px;
  }
  .show-answers-btn {
    margin: 10px 0;
    padding: 8px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .show-answers-btn:hover {
    background-color: #45a049;
  }
  .timer-container {
    position: sticky;
    top: 10px;
    z-index: 100;
    background-color: white;
    padding: 10px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    display: inline-block;
    float: right;
    margin-left: 20px;
    transition: all 0.3s ease;
  }
  .timer-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    justify-content: flex-end;
  }
  .timer-input {
    width: 50px;
    padding: 5px;
    text-align: center;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  .timer-btn {
    padding: 5px 10px;
    background-color: #2196F3;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }
  .timer-btn:hover {
    background-color: #0b7dda;
  }
  .timer-display {
    font-size: 24px;
    font-weight: bold;
    color: #d32f2f;
    margin-left: 10px;
    min-width: 80px;
    display: inline-block;
    text-align: center;
  }
  .time-up-alert {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #d32f2f;
    color: white;
    padding: 20px 40px;
    border-radius: 5px;
    font-size: 24px;
    z-index: 1000;
    display: none;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
  .result-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 1001;
    width: 80%;
    max-width: 500px;
    display: none;
    text-align: center;
  }
  .result-popup h3 {
    color: #2c3e50;
    margin-top: 0;
    font-size: 24px;
  }
  .result-popup .score {
    font-size: 28px;
    font-weight: bold;
    color: #2196F3;
    margin: 15px 0;
  }
  .result-popup .comment {
    font-size: 18px;
    margin-bottom: 20px;
  }
  .close-popup {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    cursor: pointer;
    color: #777;
  }
  .close-popup:hover {
    color: #333;
  }
  /* ThÃªm CSS cho pháº§n Ä‘á»c hiá»ƒu */
  .reading-comprehension {
    background-color: #e6f7ff;
    border-left: 4px solid #1890ff;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    position: relative; /* Cho phÃ©p Ä‘áº·t timer & highlight controls */
  }
  .reading-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid #bae7ff;
  }
  .reading-label {
    background-color: #1890ff;
    color: white;
    padding: 3px 10px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 14px;
  }
  .reading-content {
    line-height: 1.6;
    margin-top: 10px;
  }
  .sub-question-container {
    margin: 15px 0;
    padding-left: 20px;
    border-left: 3px solid #e0e0e0;
}

.sub-question-box {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    padding: 12px;
    margin-top: 8px;
}

.sub-question-box p {
    margin: 0 0 10px 0;
    font-weight: bold;
    color: #495057;
}

.sub-question-options {
    margin-top: 10px;
}
  /* ---- Style cho timer nhá» bÃªn trong khá»‘i Ä‘á»c hiá»ƒu ---- */
  .reading-timer-container {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 5px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    z-index: 10;
    display: flex;
    gap: 5px;
    align-items: center;
  }
  .reading-timer-input {
    width: 40px;
    padding: 3px;
    text-align: center;
    border: 1px solid #ccc;
    border-radius: 3px;
    font-size: 12px;
  }
  .reading-timer-btn {
    padding: 3px 6px;
    background-color: #2196F3;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 12px;
  }
  .reading-timer-btn:hover {
    background-color: #0b7dda;
  }
  .reading-timer-display {
    font-size: 14px;
    font-weight: bold;
    color: #d32f2f;
    min-width: 50px;
    text-align: center;
  }
  /* ---- Style cho bá»™ nÃºt highlight ---- */
  .highlight-controls {
    position: absolute;
    top: 50px; /* Náº±m dÆ°á»›i timer */
    right: 10px;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 5px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    z-index: 10;
    display: flex;
    gap: 5px;
    .highlight-controls {
  pointer-events: none;
}
.highlight-controls .highlight-btn {
  pointer-events: auto;
}
  }
  .highlight-btn {
    width: 20px;
    height: 20px;
    border: 1px solid #ccc;
    border-radius: 3px;
    cursor: pointer;
  }
  .highlight-btn.red    { background-color: #e53935; }  /* Äá» */
  .highlight-btn.blue   { background-color: #1e88e5; }  /* Xanh */
  .highlight-btn.purple { background-color: #8e24aa; }  /* TÃ­m */
  .highlight-btn.black  { background-color: #000000; }  /* Äen */
  .highlight-btn:hover  { opacity: 0.8; }

  .highlight-btn.remove-btn {
  background-color: #f5f5f5;
  color: #ff0000;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 12px;
}
/* ThÃªm vÃ o pháº§n style */
#quizControlsContainer {
    position: absolute;
    right: 20px;
    top: 20px;
    width: 250px;
    z-index: 100;
}

#quizControls {
    background-color: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

#quizControls button {
    display: block;
    width: 100%;
    margin-bottom: 10px;
    padding: 8px;
    background-color: #2196F3;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#quizControls button:hover {
    background-color: #0b7dda;
}

.show-answers-btn {
    background-color: #4CAF50 !important;
}

.show-answers-btn:hover {
    background-color: #45a049 !important;
}

#quizHistory {
    max-height: 200px;
    overflow-y: auto;
    padding: 5px;
    margin: 10px 0;
    background-color: #f8f9fa;
    border-radius: 4px;
    border: 1px solid #dee2e6;
}

#quizHistory li {
    margin-bottom: 8px;
    font-size: 13px;
    display: flex;
    justify-content: space-between;
    align-items: center;    /* CÄ‚N GIá»®A CHIá»€U Dá»ŒC */
    padding: 5px;
    background-color: white;
    border-radius: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}


#quizHistory li button {
    background: none !important;
    border: none !important;
    color: #e53935 !important;
    font-size: 20px !important;   /* CÃ³ thá»ƒ tÄƒng giáº£m tÃ¹y Ã½ */
    font-weight: bold;
    padding: 0 6px 0 8px !important;
    margin: 0 !important;
    cursor: pointer;
    box-shadow: none !important;
    outline: none !important;
    display: flex;
    align-items: center;   /* Äáº£m báº£o chÃ­nh giá»¯a */
    line-height: 1;
}

#quizHistory li button:hover {
    color: #b71c1c !important;
    text-decoration: underline;
    background: none !important;
}

#quizControls {
    width: 200px; /* TÄƒng width Ä‘á»ƒ chá»©a ná»™i dung tá»‘t hÆ¡n */
    /* Giá»¯ nguyÃªn cÃ¡c thuá»™c tÃ­nh khÃ¡c */
}
#editKey, #editValue {
    width: 100%;
    padding: 5px;
    margin-bottom: 5px;
    box-sizing: border-box;
}
#quizControlsContainer {
    position: fixed;
    right: 20px;
    top: 100px; /* Vá»‹ trÃ­ ban Ä‘áº§u */
    width: 250px;
    z-index: 100;
    transition: all 0.3s ease; /* Hiá»‡u á»©ng mÆ°á»£t mÃ  */
}

#quizControls {
    background-color: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

</style>
</head>
<body>
  <h1>ğŸ“š N1 BÃ i test ngÃ y 2<h1>(Tá»•ng sá»‘ cÃ¢u há»i: 46 cÃ¢u)</h1>
  
  <div class="timer-container">
    <div class="timer-controls">
      <input type="number" id="setTimeInput" class="timer-input" placeholder="20" min="1" max="120">
      <button class="timer-btn" onclick="setTimer()">Äáº·t thá»i gian &#9200;</button>
      <button class="timer-btn" onclick="startTimer()">Báº¯t Ä‘áº§u &#8987;</button>
      <span id="timerDisplay" class="timer-display">20:00</span>
    </div>
  </div>
  
  <div class="section" id="testday1">
    <h2>ğŸ“ N1 BÃ i test ngÃ y 2</h2>
    <form id="quizForm"></form>

    <div id="quizControlsContainer">
    <div id="quizControls">
        <button type="button" onclick="submitQuiz()">Ná»™p bÃ i</button>
        <button type="button" onclick="resetQuiz()">LÃ m láº¡i</button>
        <button id="showAnswersBtn" class="show-answers-btn" onclick="showCorrectAnswers()" style="display: none;">Hiá»‡n Ä‘Ã¡p Ã¡n Ä‘Ãºng</button>
        <div id="quizResult"></div>
        <h4>Lá»‹ch sá»­ lÃ m bÃ i</h4>
        <ul id="quizHistory"></ul>
        <h4>Cáº­p nháº­t Ä‘Ã¡p Ã¡n</h4>
        <input type="text" id="editKey" placeholder="q1">
        <input type="text" id="editValue" placeholder="3">
        <button onclick="updateAnswer()">Cáº­p nháº­t Ä‘Ã¡p Ã¡n</button>
    </div>
</div>

    
  <div id="timeUpAlert" class="time-up-alert">
    â° Háº¿t thá»i gian lÃ m bÃ i rÃ²i báº¡n Æ°i &#129402;
  </div>

  <div id="resultPopup" class="result-popup">
    <span class="close-popup" onclick="closeResultPopup()">Ã—</span>
    <h3>Káº¿t quáº£ cá»§a báº¡n Ä‘Ã¢y</h3>
    <div class="score" id="popupScore"></div>
    <div class="comment" id="popupComment"></div>
    <button class="show-answers-btn" onclick="closeResultPopup()">ÄÃ³ng</button>
  </div>

  <script>
          let lastScrollPosition = 0;

      window.addEventListener('scroll', function() {
          const controlsContainer = document.getElementById('quizControlsContainer');
          const currentScrollPosition = window.pageYOffset || document.documentElement.scrollTop;
          
          // Äiá»u chá»‰nh vá»‹ trÃ­ khi cuá»™n
          if (currentScrollPosition > 100) {
              controlsContainer.style.top = '20px'; // Khi cuá»™n xuá»‘ng, dÃ­nh sÃ¡t top
          } else {
              controlsContainer.style.top = '100px'; // Vá»‹ trÃ­ ban Ä‘áº§u
          }
          
          // Hiá»‡u á»©ng má» nháº¹ khi cuá»™n xuá»‘ng
          if (currentScrollPosition > lastScrollPosition) {
              // Äang cuá»™n xuá»‘ng
              controlsContainer.style.opacity = '0.95';
          } else {
              // Äang cuá»™n lÃªn
              controlsContainer.style.opacity = '1';
          }
          
          lastScrollPosition = currentScrollPosition;
      });
    const quizAnswers = {};
    const quizData = [
  {
    number: 1,
    question: 'å¦»ã¯é›¢å©šå±Šã«åˆ¤ã‚’æŠ¼ã™ (___) ã€å®¶ã‚’å‡ºã¦è¡Œã£ãŸã€‚é›¢å©šã¨ã¯ã“ã‚“ãªã«ç°¡å˜ãªã‚‚ã®ãªã®ã‹ã€‚',
    options: ['ã‹ã„ãªã‹', 'ã¹ã', 'ã‚„ã„ãªã‚„', 'ã¹ãã—ã¦'],
    answer: '3',
    isReading: false
  },
  {
    number: 2,
    question: 'ã‚ã®äººã®ç„¡ç¤¼ (___) è¨€è‘‰ã«æ€’ã‚Šã‚’ç¦ã˜ãˆãªã‹ã£ãŸã€‚',
    options: ['ã‚ãŸã‚‰ãªã„', 'ã‹ãŸããªã„', 'ã‹ãã‚‰ãªã„', 'ãã‚ã¾ã‚Šãªã„'],
    answer: '4',
    isReading: false
  },
  {
    number: 3,
    question: 'è¦–è´æ–™ã®æ¨ªé ˜äº‹ä»¶ãŒ (___) ã€è¦–è´æ–™ã‹ã‚‰æŠ—è­°ã®é›»è©±ãŒã‹ã‹ã£ã¦ãã¦ã€ã‚¹ã‚¿ãƒƒãƒ•ãŒãã®å¯¾å¿œã«è¿½ã‚ã‚ŒãŸã€‚',
    options: ['æƒ…å ±ã®æ˜¯éã‚’å•ã‚ãš', 'æƒ…å ±ã•ã‚Œã‚‹ã‚„å¦ã‚„', 'æƒ…å ±ã™ã‚Œã°ã“ã', 'æƒ…å ±ã—ã¦ã¾ã§'],
    answer: '2',
    isReading: false
  },
  {
    number: 4,
    question: 'ãƒ‘ãƒˆã‚«ãƒ¼ã®ã‚µã‚¤ãƒ¬ãƒ³ã®éŸ³ã‚’èã (___) ã€Œé€ƒã’ã‚ã€ã¨ã°ã‹ã‚Šã«ã€å½¼ã¯çŒ›ã‚¹ãƒ”ãƒ¼ãƒ‰ã§è»Šã‚’èµ°ã‚‰ã›ãŸã€‚',
    options: ['ã™ã‚‰', 'ã¨ã¦', 'ãªã‚Š', 'ã ã®'],
    answer: '2',
    isReading: false
  },
  {
    number: 5,
    question: 'ã‚«ãƒ ãƒãƒƒã‚¯ã—ãŸæœ‰åãªAæ­Œæ‰‹ã®ã‚³ãƒ³ã‚µãƒ¼ãƒˆ (___) ã€ã“ã‚Œã ã‘ãƒ•ã‚¡ãƒ³ãŒå¤šãæ¥ã‚‹ã®ã‚‚ã‚‚ã£ã¨ã‚‚ã®ã“ã¨ã ã‚ã†ã€‚',
    options: ['ã®ã‚ã‚Šã«', 'ã¨ã‚ã‚Œã°', 'ãªã‚‰ã§ã¯', 'ã«ã‚ã£ã¦ã‚‚'],
    answer: '3',
    isReading: false
  },
  {
    number: 6,
    question: 'ãã¡ã‚‰ã®ã”è¿”ç­”ã„ã‹ã‚“ã§ã¯ã€ã“ã¡ã‚‰ã‚‚ (___) ã®å¯¾å¿œã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚',
    options: ['ãã‚Œã°ã‹ã‚Š', 'ãã‚Œã»ã©', 'ãã‚Œã¾ã§', 'ãã‚Œãªã‚Š'],
    answer: '4',
    isReading: false
  },
  {
    number: 7,
    question: 'åˆ—è»ŠãŒæ¬¡ã®å›½ã«å…¥ã‚‹ãŸã³ã«ã€ã„ã¡ã„ã¡ãã®å›½ã®ãŠé‡‘ã¨æ›ãˆãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„ã†ã®ã¯ã€ (___) ã€æ—…è¡Œè€…ã«ã¯ä¸ä¾¿ã ã€‚',
    options: ['ãã®ç†ç”±ã¯ä½•ã§ã‚ã‚Œ', 'ãªã‚“ã‚‰ã‹ã®ç†ç”±ãŒã‚ã‚‹ã‚‚ã®ã‚’', 'ãªã„ã“ã¨ã ã‹ã‚‰', 'éå¸¸è­˜ã¨ã‚‚ã‹ãã‚‰ãªã„'],
    answer: '1',
    isReading: false
  },
  {
    number: 8,
    question: 'ç›¸æ‰‹ (___) ã®äº¤æ¸‰ã ã‹ã‚‰ã€è‡ªåˆ†ã®ä¸»å¼µã ã‘ã‚’é€šãã†ã¨ã™ã‚‹ã®ã¯ã‚ˆããªã„ã€‚',
    options: ['ã ã‘ã®', 'ã‚ã£ã¦ã®', 'ã‹ãã‚Šã®', 'ã«ã‚ˆã‚‹'],
    answer: '2',
    isReading: false
  },
  {
    number: 9,
    question: 'ãã‚ãã‚å¤ä¼‘ã¿ãŒå§‹ã¾ã‚‹ (___) ã€å­ä¾›ãŸã¡ã¯çš†ã†ã‚Œã—ãã†ãªé¡”ã‚’ã—ã¦ã„ã‚‹ã€‚',
    options: ['ã¨ã‚ã‚Œã°', 'ã«ã‚ã£ã¦', 'ã¨ã™ã‚‹ã¨', 'ã¨ã‚ã£ã¦'],
    answer: '4',
    isReading: false
  },
  {
    number: 10,
    question: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒæ™®åŠã—ãŸç¾ä»£ (___) ã€æƒ…å ±ç®¡ç†ä½“åˆ¶ã®å¼·åŒ–ãŒæ€¥å‹™ã¨ã•ã‚Œã¦ã„ã‚‹ã€‚',
    options: ['ã«ã²ãã‹ãˆ', 'ã«ã¨ã£ã¦', 'ã«ã‚ã£ã¦', 'ã¨ã‚ã£ã¦'],
    answer: '3',
    isReading: false
  },
  {
    number: 11,
    question: 'å„ªå‹ã‚’ç›®ã®å‰ã«ã—ã¦é€†è»¢è² ã‘ã—ãŸã¨ãã®ã‚ã®æ‚”ã—ã• (___) ã€‚',
    options: ['ã¨ã„ã£ãŸã‚‰ãªã‹ã£ãŸ', 'ã‚ã‘ãŒãªã‹ã£ãŸ', 'ã¨ã„ã£ã¦ã‚‚ãªã‹ã£ãŸ', 'ã¨ã„ãˆã°ãªã‹ã£ãŸ'],
    answer: '1',
    isReading: false
  },
  {
    number: 12,
    question: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®æ™®åŠã«ã‚ˆã£ã¦ã€å¤§éƒ½å¸‚ã‹ã‚‰åœ°æ–¹ã®ç”º (___) ã»ã¼åŒã˜ã‚ˆã†ãªæƒ…å ±ãŒè¡Œãæ¸¡ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚',
    options: ['ã«ã„ãŸã£ã¦', 'ã«ã„ãŸã‚‹ã¾ã§', 'ã«ãŠã‘ã‚‹', 'ã«ã‹ã‹ã‚ã‚‹'],
    answer: '2',
    isReading: false
  },
  {
    number: 13,
    question: 'å±±ã®é ‚ä¸Šã§ã¿ãŸæœæ—¥ã®ç¾ã—ã• (___) ãªã‹ã£ãŸã€‚',
    options: ['ã¨ã„ã£ãŸã‚‰', 'ã¨ããŸã‚‰', 'ã§ã¯ã‚ã‚‹ã¾ã„ã—', 'ã„ã‹ã‚“ã§ã¯'],
    answer: '1',
    isReading: false
  },
  {
    number: 14,
    question: 'å›½æ°‘æ „èª‰è³ã«é¸ã°ã‚Œã¦ã€å…‰æ „ (___) ã§ã”ã–ã„ã¾ã™ã€‚',
    options: ['ã¾ã¿ã‚Œ', 'ãšãã‚', 'ã®æ¥µã¾ã‚Š', 'ã®è‡³ã‚Š'],
    answer: '4',
    isReading: false
  },
  {
    number: 15,
    question: '30æ­³ã®è‹¥ã•ã§éƒ¨é•·ã«ãªã‚‹ãªã‚“ã¦ã€ã†ã‚‰ã‚„ã¾ã—ã„ (___) ã€‚',
    options: ['ã‚ã¾ã‚Šã ', 'ã«é™ã‚‹', 'é™ã‚Šã ', 'ã»ã©ã '],
    answer: '3',
    isReading: false
  },
  {
    number: 16,
    question: 'ç¤¾é•·ã«ã‚ã£ã¦ã‚‚æŒ¨æ‹¶ã‚‚ã‚ãã«ã—ãªã„å¤±ç¤¼ (___) æ–°å…¥ç¤¾å“¡ãŒã„ã‚‹ã€‚',
    options: ['æ¥µã‚ã‚‹', 'æ¥µã‚ãªã„', 'æ¥µã¾ã‚‹', 'æ¥µã¾ã£ã¦ã„ã‚‹'],
    answer: '3',
    isReading: false
  },
  {
    number: 17,
    question: 'åˆã‚ã¦ã®æˆæ¥­ (___) ã€ã‚¯ãƒ©ã‚¹ã®ã¿ã‚“ãªã¯é™ã‹ã«å…ˆç”Ÿã‚’å¾…ã£ã¦ã„ãŸã€‚',
    options: ['ã¨ã¯ã„ãˆ', 'ã¨ã—ãŸã‚‰', 'ã¨ã™ã‚Œã°', 'ã¨ã‚ã£ã¦'],
    answer: '4',
    isReading: false
  },
  {
    number: 18,
    question: 'æŒ¨æ‹¶ã—ãŸã®ã«ç„¡è¦–ã™ã‚‹ãªã‚“ã¦ã€å¤±ç¤¼ (___) ã€‚',
    options: ['ãã‚‰ã„ãŒã‚ã‚‹', 'ã‹ãã‚Šã§ã‚ã‚‹', 'ã«ã‹ãŸããªã„', 'ãã‚ã¾ã‚Šãªã„'],
    answer: '4',
    isReading: false
  },
  {
    number: 19,
    question: 'å¾…ã¡ã«å¾…ã£ã¦ã„ãŸé›»è©±ã®ãƒ™ãƒ«ãŒé³´ã‚‹ (___) ã€å½¼ã¯ã™ãã«å—è©±å™¨ã‚’å–ã£ãŸã€‚',
    options: ['ã‚„ã„ãªã‚„', 'ãŒæœ€å¾Œ', 'ã¨ã‚‚ãªã—ã«', 'ã¨ããŸã‚‰'],
    answer: '1',
    isReading: false
  },
  {
    number: 20,
    question: 'æŒ¨æ‹¶ã—ãŸã®ã«ç„¡è¦–ã™ã‚‹ãªã‚“ã¦ã€å¤±ç¤¼ (___) ã€‚',
    options: ['ãã‚‰ã„ãŒã‚ã‚‹', 'ã‹ãã‚Šã§ã‚ã‚‹', 'ã«ã‹ãŸããªã„', 'ãã‚ã¾ã‚Šãªã„'],
    answer: '4',
    isReading: false
  },
  {
    number: 21,
    question: 'å¹´ã®ã›ã„ã‹ã€ã“ã®ã”ã‚ã¯æœ¬ã‚’èª­ã‚“ã  (___) å¿˜ã‚Œã¦ã—ã¾ã†ã€‚',
    options: ['ãã°ã¾ã§', 'ãŒæœ€å¾Œ', 'ãã°ã‹ã‚‰', 'ã‚ã¨ã§ã¯'],
    answer: '3',
    isReading: false
  },
  {
    number: 22,
    question: 'åœ°ä¸‹é‰„ãŒãƒ›ãƒ¼ãƒ ã«ç€ããŒ (___) ã€ä¸¦ã‚“ã§ã„ãŸä¹—å®¢ã¯å…ˆã‚’äº‰ã£ã¦ä¹—ã‚Šè¾¼ã‚‚ã†ã¨ã—ãŸã€‚',
    options: ['ã„ãªã‚„', 'ã¨ãŸã‚“ã«', 'ã¯ã‚„ã„ã‹', 'ã—ã ã„ã«'],
    answer: '2',
    isReading: false
  },
  {
    number: 23,
    question: 'ä¼‘æ—¥ã«ã¯æ˜ ç”»ã‚’è¦‹ã‚‹ (___) ã€è²·ã„ç‰©ã™ã‚‹ (___) ã—ã¦ã€ã‚¹ãƒˆãƒ¬ã‚¹ã‚’è§£æ¶ˆã—ã¦ã„ã¾ã™ã€‚',
    options: ['ã—/ã—', 'ã ã®/ã ã®', 'ã‚„ã‚‰/ã‚„ã‚‰', 'ãªã‚Š/ãªã‚Š'],
    answer: '2',
    isReading: false
  },
  {
    number: 24,
    question: 'æˆæ¥­çµ‚äº†ã®ãƒ™ãƒ«ãŒé³´ã‚‹ (___) ã€å­¦ç”ŸãŸã¡ã¯ã™ãã«æ•™å®¤ã‚’é£›ã³å‡ºã—ãŸã€‚',
    options: ['æ¬¡ç¬¬', 'ã‚„ã„ãªã‹', 'ãŒã¯ã‚„ã„ã‹', 'ãã°ã‹ã‚‰'],
    answer: '3',
    isReading: false
  },
  {
    number: 25,
    question: 'ã“ã®æ¡ˆã¯è‡ªåˆ† (___) è€ƒãˆã«è€ƒãˆãŸä¸Šã§ã®ã‚‚ã®ã§ã™ã€‚å‡ºæ¥ä¸ŠãŒã‚Šæ¬¡ç¬¬ã€Eãƒ¡ãƒ¼ãƒ«ã§ãŠé€ã‚Šã—ã¾ã™ã€‚ã”æ¤œè¨ãã ã•ã„ã€‚',
    options: ['ãã„ã«', 'ã«å³ã—ã¦', 'ã‚’ãµã¾ãˆ', 'ãªã‚Šã«'],
    answer: '3',
    isReading: false
  },
  {
    number: 26,
    question: 'æ³¨æ„ã•ã‚ŒãŸ (___) ã€ã¾ãŸåŒã˜ãƒŸã‚¹ã‚’çŠ¯ã™ãªã‚“ã¦ã€é¦¬é¹¿ã¨ã—ã‹è¨€ã„ã‚ˆã†ãŒãªã„ã­ã€‚',
    options: ['ãŒã•ã„ã”', 'ã“ã¨ã¨ã¦', 'ã“ã¨ã‹ã‚‰', 'ãã°ã‹ã‚‰'],
    answer: '4',
    isReading: false
  },
  {
    number: 27,
    question: 'æ—¥æœ¬ç¤¾ä¼šã® (___) ã«ã‚ã‚‹å­¦æ­´é‡è¦–ã€ä¸€æµå¿—å‘ã‚’ãªãã•ãªã„ã‹ãã‚Šã€æ—¥æœ¬ã®æ•™è‚²ã¯ã‹ã‚ã‚‰ãªã„ã ã‚ã†ã€‚',
    options: ['æ ¹åº•', 'æ ¹æ‹ ', 'å¾¹åº•', 'ä¾æ‹ '],
    answer: '1',
    isReading: false
  },
  {
    number: 28,
    question: ' (___) å­ä¾›ãŒè»Šã®å‰ã«é£›ã³å‡ºã—ã¦ãã¦ã³ã£ãã‚Šã—ãŸã€‚',
    options: ['è»½ç‡ã«', 'ä¸æ„ã«', 'æ€ æ…¢ã«', 'è‡†ç—…ã«'],
    answer: '2',
    isReading: false
  },
  {
    number: 29,
    question: 'äº¤é€šã‚„é€šä¿¡ãŒ (___) é€²æ­©ã‚’é‚ã’ã¦ã„ã‚‹ä»Šæ—¥ã€åœ°çƒãŒç‹­ããªã£ãŸã‚ˆã†ãªæ°—ãŒã™ã‚‹ã€‚',
    options: ['ã‚ã•ã¾ã—ã„', 'ãªã ã‹ã„', 'ã‚ã–ã¾ã—ã„', 'ã“ã“ã‚ã‚ˆã„'],
    answer: '3',
    isReading: false
  },
  {
    number: 30,
    question: 'ã‚ã¾ã‚Šã®æã‚ã—ã•ã«ãã®å­ã¯ (___) ã€‚',
    options: ['ç«‹ã¡ä¼šã£ãŸ', 'ç«‹ã¡å…¥ã£ãŸ', 'ç«‹ã¡ãªãŠã£ãŸ', 'ç«‹ã¡ã™ãã‚“ã '],
    answer: '4',
    isReading: false
  },
  {
    number: 31,
    question: 'å‹äººã‹ã‚‰Eãƒ¡ãƒ¼ãƒ«ãŒå±Šã„ãŸã®ã§ã€ (___) è¿”äº‹ã‚’æ›¸ãã€‚',
    options: ['å¼•ãå‡ºã—', 'å¼•ããšã‚Š', 'æŠ˜ã‚Šè¿”ã—', 'æŠ˜ã‚Šç•³ã¿'],
    answer: '3',
    isReading: false
  },
  {
    number: 32,
    question: 'å–ã‚Šç· ã‚ŠãŒ (___) ãªã®ã§ã€äº¤é€šé•åãŒãªã‹ãªã‹æ¸›ã‚Šã¾ã›ã‚“ã€‚',
    options: ['ãƒ«ãƒ¼ãƒ«', 'ãƒ¬ãƒ¼ãƒ«', 'ãƒ«ãƒ¼ã‚º', 'ã‚´ãƒ¼ãƒ«'],
    answer: '3',
    isReading: false
  },
  {
    number: 33,
    question: 'ã‚ã„ã¤ã¯ä½“ã®ç•°å¸¸ã¯ãªã„ãŒã€æ‚ªãè¨€ãˆã°æå¦» (___) ã«ã‹ã‹ã£ãŸã®ãŒå®Ÿæƒ…ã ã€‚',
    options: ['ç—‡', 'çŠ¶', 'æ§˜', 'ç‹'],
    answer: '1',
    isReading: false
  },
  {
    number: 34,
    question: 'æ–°è©¦é¨“ã®å‡ºé¡Œè¦ç¶±ã®<span style="color:red;font-style:italic">ç·š</span>ã«æ²¿ã£ã¦ã€ã“ã®ç·´ç¿’å¸³ã‚’ç·¨é›† ã—ãŸã€‚',
    options: ['é–“æŸ„', 'å¤§æŸ„', 'ç­‹é“', 'è¿‘é“'],
    answer: '3',
    isReading: false
  },
  {
    number: 35,
    question: 'å¤–å›½èªãŒ<span style="color:red;font-style:italic">æµæš¢</span>ã«è©±ã›ã‚‹ãŒã€æ¯å›½èªã¨ãªã‚‹ã¨ã€èˆŒãŒå›ã‚‰ãªããªã‚‹äººãŒã„ã‚‹ãã†ã ã€‚',
    options: ['ãšã‚‹ãšã‚‹', 'ãããã', 'ã‹ã‚‹ãŒã‚‹', 'ã™ã‚‰ã™ã‚‰'],
    answer: '4',
    isReading: false
  },
  {
    number: 36,
    question: 'ã‚ã®ãŠå®¢ã¯ãŠé‡‘ã«<span style="color:red;font-style:italic">ã—ã¶ãã¦</span>ã€ä»£é‡‘ã‚’ãªã‹ãªã‹æ‰•ã£ã¦ãã‚Œãªã„ã€‚',
    options: ['ã‘ã¡ã§', 'ãŠãŠã¾ã‹ã§', 'ã‚ã„ã¾ã„ã§', 'ãŸãã¿ã§'],
    answer: '1',
    isReading: false
  },
  {
    number: 37,
    question: 'é•·ã„å†¬ã«å‚™ãˆã‚‹ãŸã‚ã«ã€é‡èœã‚’<span style="color:red;font-style:italic">ã‹ã“ã£ã¦</span>ãŠãã€‚',
    options: ['è‚²æˆã—ã¦', 'æ ½åŸ¹ã—ã¦', 'ãŸãã‚ãˆã¦', 'ã¨ã©ã‚ã¦'],
    answer: '3',
    isReading: false
  },
  {
    number: 38,
    question: 'ã“ã®ä»•äº‹ã¯<span style="color:red;font-style:italic">ã„ãŸã£ã¦</span>ã‚¹ãƒ ãƒ¼ã‚ºã«é‹ã‚“ã§ã„ã‚‹ã‹ã‚‰ã€å®‰å¿ƒã—ãŸã¾ãˆã€‚',
    options: ['ã‚„ã‚„', 'ã”ã', 'ã‚‚ã‚ã«', 'ã‚ãã«'],
    answer: '2',
    isReading: false
  },
  {
    number: 39,
    question: 'ã“ã“ã¯å¾Œã§ã‚°ãƒ©ãƒ•ã‚’å…¥ã‚Œã‚‹ã‚“ã ã‹ã‚‰ã€<span style="color:red;font-style:italic">ã‚¹ãƒšãƒ¼ã‚¹</span>ã‚’ç©ºã‘ã¦ã‚¿ã‚¤ãƒ—ã—ã¦ãã ã•ã„ã€‚',
    options: ['è·é›¢', 'åˆé–“', 'åˆ†é›¢', 'è¡Œé–“'],
    answer: '4',
    isReading: false
  },
  {
    number: 40,
    question: 'ç››ã‚Š',
    options: ['æ¡œã®èŠ±ã®<span style="color:red;font-style:italic">ç››ã‚Š</span>ãŒéããŸã‹ã‚‰ã€èŠ±è¦‹å®¢ã‚‚å°‘ãªããªã£ãŸã€‚', 'ãã“ã¯æœ¨å·¥ã€æŸ“ç¹”ãªã©ã®ä¼çµ±å·¥èŠ¸ãŒ<span style="color:red;font-style:italic">ç››ã‚Š</span>ãªç”ºã§ã™ã€‚', 'ã©ã®ã‚ˆã†ã«åº—ã‚’<span style="color:red;font-style:italic">ç››ã‚Š</span>ã•ã›ã‚‹ã‹ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚', 'ã“ã“ã®è‚‰ã¯ã¶ãŸè‚‰ã®ä¸­ã§ã„ã¡ã°ã‚“<span style="color:red;font-style:italic">ç››ã‚Š</span>ã®éƒ¨åˆ†ã ã€‚'],
    answer: '1',
    isReading: false
  },
  {
    number: 41,
    question: 'å¯¾é¢',
    options: ['å½¼ã¨ã¯å§‹ã‚ã¦<span style="color:red;font-style:italic">å¯¾é¢</span>ã—ãŸãŒã€ã™ãã«æ‰“ã¡è§£ã‘ãŸã€‚', '60å¹´å‰ã€åŸçˆ†ãŒåºƒå³¶ã¨é•·å´ã§ä¸–ç•Œã®äººã¨<span style="color:red;font-style:italic">å¯¾é¢</span>ã—ãŸã€‚', 'ä¹¾ããã£ãŸæœ¨ã¨ç«ãŒ<span style="color:red;font-style:italic">å¯¾é¢</span>ã«ãªã£ãŸã‚‰ã€ã±ã£ã¨ç‡ƒãˆå§‹ã‚ãŸã€‚', 'ä»Šã¾ã§ã¼ãã¯ãšã£ã¨å¤§é€šã‚Šã®<span style="color:red;font-style:italic">å¯¾é¢</span>ã«ä½ã‚“ã§ã„ãŸã€‚'],
    answer: '1',
    isReading: false
  },
  {
    number: 42,
    question: 'ç°¡æ½”',
    options: ['ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯å†…å®¹ã¨<span style="color:red;font-style:italic">ç°¡æ½”</span>ãŒå¤§åˆ‡ãªã“ã¨ã§ã‚ã‚‹ã€‚', 'æ–‡ç« ã¯<span style="color:red;font-style:italic">ç°¡æ½”</span>ã—ãŸè¨€è‘‰é£ã„ã‚’ä½¿ã£ãŸã»ã†ãŒã„ã„ã€‚', 'å¿™ã—ã„ã®ã§ã€<span style="color:red;font-style:italic">ç°¡æ½”</span>çš„ãªå ±å‘Šæ›¸ã‚’æå‡ºã—ã¦ã»ã—ã„ã€‚', 'ç™ºè¨€è€…ã®ç™ºè¨€ã‚’<span style="color:red;font-style:italic">ç°¡æ½”</span>ã«ã¾ã¨ã‚ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚'],
    answer: '4',
    isReading: false
  },
  {
    number: 43,
    question: 'ã¨ãªãˆã‚‹',
    options: ['å°é³¥ãŒæ­Œã‚’<span style="color:red;font-style:italic">ã¨ãªãˆ</span>ãªãŒã‚‰ã€æã‹ã‚‰æã¸ã¨é£›ã‚“ã§ã„ã‚‹ã€‚', 'å½¼ã¯è­°ä¼šã§ãã®è­°æ¡ˆã«å¯¾ã—ã¦ã€<ruby>æ„šç—´<rt>ãã¡</rt></ruby>ã‚’ã²ã©ã<span style="color:red;font-style:italic">ã¨ãªãˆãŸ</span>ã€‚', 'ã‚ãŸã—ã‚‚æ—…è¡Œã—ãŸã„ã‚ã¨ã€å¦¹ã¯<span style="color:red;font-style:italic">ã¨ãªãˆãŸ</span>ãŒã€è¨±ã•ã‚Œãªã‹ã£ãŸã€‚', 'å…¥å­¦è©¦é¨“å»ƒæ­¢ã‚’<span style="color:red;font-style:italic">ã¨ãªãˆã‚‹</span>å­¦è€…ã‚‚ã„ã‚‹ã‚‰ã—ã„ã€‚'],
    answer: '4',
    isReading: false
  },
  {
    number: 44,
    question: 'ã¾ã‚‹ã£ãã‚Š',
    options: ['ä»Šæ—¥ã®å¤©æ°—äºˆå ±ã¯<span style="color:red;font-style:italic">ã¾ã‚‹ã£ãã‚Š</span>å¤–ã‚Œã ã­ã€‚', 'ã‚ã®ãŠã°ã‚ã•ã‚“ã¯<span style="color:red;font-style:italic">ã¾ã‚‹ã£ãã‚Š</span>ã¼ãã‚’ã‹ã‚ã„ãŒã£ã¦ãã‚ŒãŸã€‚', 'ä¸Šæµ·èŸ¹ã¯<span style="color:red;font-style:italic">ã¾ã‚‹ã£ãã‚Š</span>è’¸ã—ã¦ã‹ã‚‰é£Ÿã¹ã‚‹ã®ãŒæ™®é€šã§ã‚ã‚‹ã€‚', 'ã˜ã£ã¨è¦‹ã‚‹ã¨ã€<span style="color:red;font-style:italic">ã¾ã‚‹ã£ãã‚Š</span>ç§ã®è½ã¨ã—ãŸã‚«ãƒãƒ³ã ã£ãŸã€‚'],
    answer: '1',
    isReading: false
  },
  {
    number: 45,
    question: 'ã‚«ãƒ†ã‚´ãƒªãƒ¼',
    options: ['ç§ã¯å¤§å­¦é™¢ã®æ—¥æœ¬èªå­¦ã¨ã„ã†<span style="color:red;font-style:italic">ã‚«ãƒ†ã‚´ãƒªãƒ¼</span>ã¸é€²å­¦ã—ãŸã€‚', 'å°ã•ãªåº—ã ãŒã€ãŸãã•ã‚“ã®<span style="color:red;font-style:italic">ã‚«ãƒ†ã‚´ãƒªãƒ¼</span>ã®å•†å“ãŒæƒã£ã¦ã„ã‚‹ã€‚', 'ç¤¾å“¡ã‚’ç”·å¥³<span style="color:red;font-style:italic">ã‚«ãƒ†ã‚´ãƒªãƒ¼</span>ã«åˆ†ã‘ãšã«ã€äº¤äº’ã«åº§ã‚‹ã€‚', 'æ›¸ç±ã‚’<span style="color:red;font-style:italic">ã‚«ãƒ†ã‚´ãƒªãƒ¼</span>åˆ¥ã«åˆ†é¡ã™ã‚Œã°ã€åˆ†ã‹ã‚Šã‚„ã™ã„ã€‚'],
    answer: '4',
    isReading: false
  },
  {
    question: 'èª­è§£1<br>ç§ãŸã¡ãŒæ™®æ®µã‹ã‚‰è€³æ…£ã‚Œã¦ã„ã¦ã€ç„¡æ„è­˜ã«å£ã«ã—ã¦ã—ã¾ã†è¨€è‘‰ã«ã¯ã€å·®åˆ¥èªãŒã‚ã‚‹ã€‚<br>ãã—ã¦ãã‚ŒãŒç‰¹å®šã®äººãŸã¡ã®äººæ¨©ã‚’ä¾µã—ã€å‚·ã¤ã‘ã¦ã—ã¾ã†ãŠãã‚ŒãŒã‚ã‚‹ã®ã ã€‚<br>å·®åˆ¥ç”¨èªã¨è¢«å·®åˆ¥ç”¨èªã®é•ã„ã¯ã€è¨€è‘‰ã®ä½¿ç”¨è€…ã ã‘ã®å•é¡Œã§ã¯ãªã„ã€‚æœ€ã‚‚å¤šãã€ãã—ã¦é‡å¤§ãªå•é¡Œã¯ã€ å—ã‘å–ã‚Šæ‰‹ã®æ„Ÿè¦šã„ã‹ã‚“ã«ã‚ˆã‚‹ã®ã§ã‚ã‚‹ã€‚ å—ã‘å–ã‚Šæ‰‹ãŒã€ã€Œãã®è¨€è‘‰ã¯å·®åˆ¥çš„ãªç”¨æ³•ã ã€ã¨æ€ãˆã°ã€ãã‚ŒãŒã™ã¹ã¦å·®åˆ¥ç”¨èªã«ãªã£ã¦ã—ã¾ã†ã®ã§ã‚ã‚‹ã€‚ã€<br>ã€Œè‡ªåˆ†ã¯ãã‚“ãªã¤ã‚‚ã‚Šã§ã¯ãªã„ã€ã¨ã‹ã€Œ ã“ã®è¨€è‘‰ã¯ãã‚“ãªèªæºã§ã¯ãªã„ã€ã¨ã‹ã„ãã‚‰<br>è§£é‡ˆã—ã¦ã‚‚ã€ãã®è¨€è‘‰ã‚’ä¸æ„‰å¿«ã¨æ„Ÿã˜ã‚‹äººãŒã„ã‚‹ã®ãªã‚‰ã°ã€ä½¿ã†ã®ã‚’æ§ãˆã‚‹ã®ã¯å½“ç„¶ã ã€‚',
    isReading: true,
    subQuestions: [
      {
        number: 46,
        subQuestion: 'æ–‡ç« ã®å†…å®¹ã«åˆã£ã¦ã„ã‚‹ã‚‚ã®ã¯ã©ã‚Œã‹ã€‚',
        options: ['ç„¡æ„è­˜ã«å£ã«ã—ã¦ã—ã¾ã£ãŸè¨€è‘‰ã¯å±ãªã„ã‹ã‚‰ã€æ³¨æ„ã—ã¦ä½¿ã£ãŸã»ã†ãŒã„ã„ã€‚', 'ç›¸æ‰‹ã«ä¸æ„‰å¿«ãªæ„Ÿã˜ã‚’ã‚‚ãŸã‚‰ã™è¨€è‘‰ãªã‚‰ã€ä½¿ç”¨ã‚’æ§ãˆãŸã»ã†ãŒã„ã„ã€‚', 'å·®åˆ¥èªã‹ã€ãã†ã§ãªã„ã‹ã‚’å‰ã‚‚ã£ã¦ç¢ºã‹ã‚ãŸä¸Šã§ä½¿ã†ã®ãŒç„¡é›£ã§ã‚ã‚‹ã€‚', 'å·®åˆ¥ç”¨èªã‹è¢«å·®åˆ¥ç”¨èªã‹ã€èãæ‰‹ã«ã‚ˆã‚‹ã‚‚ã®ã ã‹ã‚‰ã€æ°—ã«ã—ãªãã¦ã‚‚ã„ã„ã€‚'],
        answer: '2'
      }
    ]
  }
]; 

    let timerInterval;
    let defaultTime = 20;
    let remainingTime = defaultTime * 60;
    let isTimerRunning = false;
    let readingComprehensionCount = 0;

    // LÆ°u trá»¯ timer riÃªng cho má»—i block Ä‘á»c hiá»ƒu
    const readingTimers = {};
    // LÆ°u range Ä‘Ã£ chá»n gáº§n nháº¥t cho má»—i block (máº·c Ä‘á»‹nh null)
    //const savedRanges = {};

    function renderQuiz() {
    const form = document.getElementById('quizForm');
    form.innerHTML = '';
    readingComprehensionCount = 0;
    
    quizData.forEach((q, index) => {
        const div = document.createElement('div');
        div.classList.add('question-block');

        if (q.isReading) {
            readingComprehensionCount++;

            // TÃ¡ch pháº§n sá»‘ thá»© tá»± trÆ°á»›c dáº¥u ". "
            const dotIndex = q.question.indexOf(". ");
            let numPart = "", restText = q.question;
            if (dotIndex > 0) {
                numPart = q.question.substring(0, dotIndex + 1);
                restText = q.question.substring(dotIndex + 2);
            }

            // Táº¡o HTML cho cÃ¡c cÃ¢u há»i phá»¥
            let subQuestionsHtml = '';
            if (q.subQuestions && q.subQuestions.length > 0) {
                subQuestionsHtml = q.subQuestions.map((subQ, subIndex) => `
                    <div class="sub-question-container">
                        <div class="sub-question-box">
                            
                            <p><strong>${subQ.number}.</strong> ${subQ.subQuestion.replace(/\n/g, '<br>')}</p>
                            <span style="font-size:12px;color:#888">[key: q${index + 1}_${subIndex}]</span>
                            <div class="sub-question-options">
                                ${subQ.options.map((opt, optIndex) => `
                                    <label class="answer-option">
                                        <input type="radio" name="q${index + 1}_${subIndex}" value="${optIndex + 1}">
                                        ${opt}
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
          div.innerHTML = `
            <div class="reading-comprehension" data-index="${index}">
              <div class="reading-title">
                <span class="reading-label">Äá»c hiá»ƒu ${readingComprehensionCount}</span>
              </div>
              <!-- Timer riÃªng cho reading block -->
              <div class="reading-timer-container" data-timer-index="${index}">
                <input type="number" class="reading-timer-input" id="readTimeInput-${index}" placeholder="1" min="1" max="120">
                <button type="button" class="reading-timer-btn" onclick="setReadingTimer(${index}); event.preventDefault();">Äáº·t</button>
                <button type="button" class="reading-timer-btn" onclick="startReadingTimer(${index}); event.preventDefault();">Báº¯t Ä‘áº§u</button>
                <button type="button" class="reading-timer-btn" onclick="resetReadingTimer(${index}); event.preventDefault();">Reset</button>
                <span class="reading-timer-display" id="readingTimerDisplay-${index}">00:00</span>
              </div>
              <!-- NÃºt highlight mÃ u -->
              <div class="highlight-controls" data-highlight-index="${index}">
                <div class="highlight-btn red"    title="Äá»"   onclick="highlightSelection(${index}, 'red'); event.preventDefault();"></div>
                <div class="highlight-btn blue"   title="Xanh" onclick="highlightSelection(${index}, 'blue'); event.preventDefault();"></div>
                <div class="highlight-btn purple" title="TÃ­m"  onclick="highlightSelection(${index}, 'purple'); event.preventDefault();"></div>
                <div class="highlight-btn black"  title="Äen"  onclick="highlightSelection(${index}, 'black'); event.preventDefault();"></div>
                <div class="highlight-btn remove-btn" title="XÃ³a highlight" onclick="removeHighlights(${index}, 'red'); event.preventDefault();">âŒ</div>
              </div>
              <div class="reading-content" id="readingContent-${index}">
                <p>
                  ${ numPart ? `<strong>${numPart}</strong><br>` : '' }
                  <span id="readingText-${index}">${restText.replace(/\n/g, '<br>')}</span>
                </p>
                     ${subQuestionsHtml}
                    </div>
                </div>
            `;
        // LÆ°u Ä‘Ã¡p Ã¡n cho tá»«ng cÃ¢u há»i phá»¥
            if (q.subQuestions && q.subQuestions.length > 0) {
                q.subQuestions.forEach((subQ, subIndex) => {
                    quizAnswers[`q${index + 1}_${subIndex}`] = subQ.answer;
                });
            }
        } else {
            // Xá»­ lÃ½ cÃ¢u há»i thÆ°á»ng
            div.innerHTML = `<p><strong>${q.number}. ${q.question}</strong></p>`;
            q.options.forEach((opt, i) => {
                const label = document.createElement('label');
                label.classList.add('answer-option');
                label.innerHTML = `<input type="radio" name="q${index + 1}" value="${i + 1}"> ${opt}`;
                div.appendChild(label);
            });
            quizAnswers[`q${index + 1}`] = q.answer;
        }
        
        form.appendChild(div);
    });
}

    /***=== CHá»¨C NÄ‚NG TIMER RIÃŠNG CHO Má»–I BLOCK ===***/
    function setReadingTimer(idx) {
      const inputEl = document.getElementById(`readTimeInput-${idx}`);
      const minutes = parseInt(inputEl.value);
      if (isNaN(minutes) || minutes <= 0) {
        alert('Nháº­p sá»‘ phÃºt â‰¥ 1.');
        return;
      }
      readingTimers[idx] = {
        remaining: minutes * 60,
        original: minutes * 60,
        intervalId: null
      };
      updateReadingTimerDisplay(idx);
    }

    function startReadingTimer(idx) {
      if (!readingTimers[idx]) {
        readingTimers[idx] = { remaining: 60, original: 60, intervalId: null };
      }
      if (readingTimers[idx].intervalId) return;
      readingTimers[idx].intervalId = setInterval(() => {
        const timerObj = readingTimers[idx];
        timerObj.remaining--;
        updateReadingTimerDisplay(idx);
        if (timerObj.remaining <= 0) {
          clearInterval(timerObj.intervalId);
          timerObj.intervalId = null;
          showTimeUpAlert(idx);
        }
      }, 1000);
    }

    function resetReadingTimer(idx) {
      const timerObj = readingTimers[idx];
      if (timerObj) {
        if (timerObj.intervalId) {
          clearInterval(timerObj.intervalId);
          timerObj.intervalId = null;
        }
        timerObj.remaining = timerObj.original || 0;
        updateReadingTimerDisplay(idx);
      }
    }

    function updateReadingTimerDisplay(idx) {
      const disp = document.getElementById(`readingTimerDisplay-${idx}`);
      const timerObj = readingTimers[idx] || { remaining: 0 };
      let sec = timerObj.remaining;
      if (sec < 0) sec = 0;
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      disp.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }

    function showTimeUpAlert(idx) {
      const readingBlock = document.querySelector(`.reading-comprehension[data-index='${idx}']`);
      if (!readingBlock) return;
        // Láº¥y sá»‘/thá»© tá»± hoáº·c tÃªn Ä‘á»c hiá»ƒu
        const readingLabel = readingBlock.querySelector('.reading-label');
        let readingName = '';
        if (readingLabel) {
          readingName = readingLabel.textContent.trim(); // VÃ­ dá»¥: "Äá»c hiá»ƒu 3"
        } else {
          readingName = `Äá»c hiá»ƒu ${idx + 1}`;
        }
      
      // Táº¡o alert div vá»›i style giá»‘ng thÃ´ng bÃ¡o chÃ­nh
      const alertDiv = document.createElement('div');
      alertDiv.innerHTML = `â° Háº¿t thá»i gian cá»§a <strong>${readingName}</strong> roy báº¡n Æ°i!`;
      alertDiv.style.position = 'fixed';
      alertDiv.style.top = '50%';
      alertDiv.style.left = '50%';
      alertDiv.style.transform = 'translate(-50%, -50%)';
      alertDiv.style.backgroundColor = '#d32f2f';
      alertDiv.style.color = 'white';
      alertDiv.style.padding = '20px 40px';
      alertDiv.style.borderRadius = '5px';
      alertDiv.style.fontSize = '24px';
      alertDiv.style.zIndex = '1000';
      alertDiv.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
      
      // ThÃªm vÃ o body thay vÃ¬ vÃ o reading block
      document.body.appendChild(alertDiv);
      
      setTimeout(() => {
        alertDiv.remove();
      }, 3000);
    }

    /***=== CHá»¨C NÄ‚NG HIGHLIGHT SAU KHI CHá»ŒN VÄ‚N Báº¢N Rá»’I NHáº¤N NÃšT MÃ€U ===***/
    // Biáº¿n lÆ°u trá»¯ cÃ¡c range Ä‘Ã£ chá»n
const savedRanges = {};

// HÃ m highlight má»›i
// HÃ m highlightSelection sá»­a Ä‘á»•i Ä‘á»ƒ cho phÃ©p re-highlight
function highlightSelection(idx, color) {
  // Láº¥y range Ä‘Ã£ lÆ°u hoáº·c tá»« selection hiá»‡n táº¡i
  const selection = window.getSelection();
  const range = savedRanges[idx] || (selection.rangeCount > 0 ? selection.getRangeAt(0).cloneRange() : null);
  
  if (!range || range.collapsed) {
    alert('Vui lÃ²ng bÃ´i Ä‘en vÄƒn báº£n trong pháº§n Ä‘á»c hiá»ƒu trÆ°á»›c khi Ä‘á»•i mÃ u.');
    return;
  }

  // Kiá»ƒm tra cÃ³ náº±m trong pháº§n Ä‘á»c hiá»ƒu Ä‘Ãºng khÃ´ng
  const readingBlock = document.querySelector(`.reading-comprehension[data-index="${idx}"]`);
  if (!readingBlock || !readingBlock.contains(range.commonAncestorContainer)) {
    alert('Vui lÃ²ng chá»n vÄƒn báº£n trong pháº§n Ä‘á»c hiá»ƒu tÆ°Æ¡ng á»©ng.');
    return;
  }

  // Táº¡o document fragment má»›i
  const fragment = range.extractContents();
  
  // Táº¡o span má»›i vá»›i style
  const span = document.createElement('span');
  span.style.color = color;
  span.style.fontWeight = 'bold';
  
  // ThÃªm ná»™i dung vÃ o span
  span.appendChild(fragment);
  
  // ChÃ¨n span vÃ o vá»‹ trÃ­ cÅ©
  range.insertNode(span);
  
  // XÃ³a range Ä‘Ã£ lÆ°u
  savedRanges[idx] = null;
  
  // Clear selection
  selection.removeAllRanges();
}

// Sá»± kiá»‡n lÆ°u selection khi bÃ´i Ä‘en
document.addEventListener('mouseup', function(e) {
  const sel = window.getSelection();
  if (sel.isCollapsed) return;
  
  const range = sel.getRangeAt(0);
  const readingBlock = findAncestor(range.commonAncestorContainer, el => 
    el.classList && el.classList.contains('reading-comprehension')
  );
  
  if (readingBlock) {
    const idx = parseInt(readingBlock.getAttribute('data-index'));
    savedRanges[idx] = range.cloneRange();
  }
});
// HÃ m xÃ³a táº¥t cáº£ highlight trong block
function removeHighlights(idx) {
  const readingBlock = document.querySelector(`.reading-comprehension[data-index="${idx}"]`);
  if (!readingBlock) return;

  // Láº¥y táº¥t cáº£ span highlight
  const highlightedSpans = readingBlock.querySelectorAll('span[style*="color:"]');
  
  // XÃ³a Ä‘á»‡ quy tá»« trong ra ngoÃ i
  highlightedSpans.forEach(span => {
    // LÆ°u ná»™i dung bÃªn trong
    const content = document.createDocumentFragment();
    while (span.firstChild) {
      content.appendChild(span.firstChild);
    }
    
    // Thay tháº¿ span báº±ng ná»™i dung
    const parent = span.parentNode;
    parent.insertBefore(content, span);
    parent.removeChild(span);
  });
  
  // Xá»­ lÃ½ cÃ¡c span cÃ²n sÃ³t láº¡i (náº¿u cÃ³)
  const remainingSpans = readingBlock.querySelectorAll('span[style*="color:"]');
  if (remainingSpans.length > 0) {
    removeHighlights(idx); // Gá»i Ä‘á»‡ quy náº¿u cÃ²n span
  }
}


// HÃ m helper tÃ¬m ancestor
function findAncestor(el, fn) {
  while (el) {
    if (fn(el)) return el;
    el = el.parentNode;
  }
  return null;
}
    // Láº¯ng nghe mouseup Ä‘á»ƒ lÆ°u selection náº¿u trong reading-content, giá»¯ highlight xanh
    document.addEventListener('mouseup', function(e) {
      const sel = window.getSelection();
      if (sel.isCollapsed) return;
      const range = sel.getRangeAt(0);
      const ancestry = findAncestor(range.commonAncestorContainer, el => 
        el.classList && el.classList.contains('reading-content')
      );
      if (!ancestry) return;
      const readingBlock = ancestry.closest('.reading-comprehension');
      if (!readingBlock) return;
      const idx = parseInt(readingBlock.getAttribute('data-index'));
      // LÆ°u táº¡m range, khÃ´ng clear selection Ä‘á»ƒ giá»¯ highlight native mÃ u xanh
      savedRanges[idx] = range.cloneRange();
    });

    function findAncestor(el, fn) {
      while (el) {
        if (fn(el)) return el;
        el = el.parentNode;
      }
      return null;
    }

    /***=== CÃC CHá»¨C NÄ‚NG QUIZ & TIMER CHUNG ===***/
    function submitQuiz() {
    const form = document.getElementById('quizForm');
    let score = 0;
    let totalQuestions = 0;
    let correctAnswers = 0;
    
    // TÃ­nh tá»•ng sá»‘ cÃ¢u há»i vÃ  kiá»ƒm tra Ä‘Ã¡p Ã¡n
    quizData.forEach((q, index) => {
        if (q.isReading && q.subQuestions) {
            // Xá»­ lÃ½ cÃ¢u há»i Ä‘á»c hiá»ƒu cÃ³ nhiá»u cÃ¢u há»i phá»¥
            q.subQuestions.forEach((subQ, subIndex) => {
                totalQuestions++;
                const name = `q${index + 1}_${subIndex}`;
                const selected = form.querySelector(`input[name='${name}']:checked`);
                const correct = (window.answers && window.answers[name]) || quizAnswers[name];
                
                if (selected && selected.value === correct) {
                    correctAnswers++;
                    // ÄÃ¡nh dáº¥u cÃ¢u tráº£ lá»i Ä‘Ãºng
                    const labels = form.querySelectorAll(`input[name='${name}']`);
                    labels.forEach(input => {
                        if (input.value === correct) {
                            input.parentElement.innerHTML += ' <span class="correct-answer">âœ… ÄÃºng</span>';
                        }
                    });
                } else {
                    // ÄÃ¡nh dáº¥u cÃ¢u tráº£ lá»i sai (náº¿u cÃ³ chá»n)
                    if (selected) {
                        selected.parentElement.innerHTML += ' <span class="wrong-answer">âŒ Sai</span>';
                        // Hiá»ƒn thá»‹ Ä‘Ã¡p Ã¡n Ä‘Ãºng
                        const correctInput = form.querySelector(`input[name='${name}'][value='${correct}']`);
                        //if (correctInput) {
                          //  correctInput.parentElement.innerHTML += ' <span class="correct-answer">âœ… ÄÃ¡p Ã¡n Ä‘Ãºng</span>';
                        //}
                    }
                }
            });
        } else {
            // Xá»­ lÃ½ cÃ¢u há»i thÆ°á»ng
            totalQuestions++;
            const name = `q${index + 1}`;
            const selected = form.querySelector(`input[name='${name}']:checked`);
            const correct = (window.answers && window.answers[name]) || quizAnswers[name];
            
            if (selected && selected.value === correct) {
                correctAnswers++;
                // ÄÃ¡nh dáº¥u cÃ¢u tráº£ lá»i Ä‘Ãºng
                const labels = form.querySelectorAll(`input[name='${name}']`);
                labels.forEach(input => {
                    if (input.value === correct) {
                        input.parentElement.innerHTML += ' <span class="correct-answer">âœ… ÄÃºng</span>';
                    }
                });
            } else {
                // ÄÃ¡nh dáº¥u cÃ¢u tráº£ lá»i sai (náº¿u cÃ³ chá»n)
                if (selected) {
                    selected.parentElement.innerHTML += ' <span class="wrong-answer">âŒ Sai</span>';
                    // Hiá»ƒn thá»‹ Ä‘Ã¡p Ã¡n Ä‘Ãºng
                    const correctInput = form.querySelector(`input[name='${name}'][value='${correct}']`);
                    if (correctInput) {
                        correctInput.parentElement.innerHTML += ' <span class="correct-answer">âœ… ÄÃ¡p Ã¡n Ä‘Ãºng</span>';
                    }
                }
            }
        }
    });

    // TÃ­nh Ä‘iá»ƒm vÃ  hiá»ƒn thá»‹ káº¿t quáº£
    const percentage = Math.round((correctAnswers / totalQuestions) * 100);
    const resultComment = getResultComment(percentage);
    
    // LÆ°u káº¿t quáº£ vÃ o localStorage
    const testId = window.location.pathname.split("/").pop().replace(".html", "");
    let testScores = JSON.parse(localStorage.getItem("testScores") || "{}");
    testScores[testId] = { score: correctAnswers, total: totalQuestions };
    localStorage.setItem("testScores", JSON.stringify(testScores));
    
    // Gá»­i káº¿t quáº£ vá» trang chÃ­nh (náº¿u cÃ³)
    try {
        if (window.opener && !window.opener.closed) {
            window.opener.postMessage({ 
                type: 'updateScore', 
                testId: testId,
                score: correctAnswers,
                total: totalQuestions
            }, '*');
        }
    } catch (e) {
        console.log("KhÃ´ng thá»ƒ gá»­i thÃ´ng bÃ¡o Ä‘áº¿n trang chÃ­nh");
    }
    
    // Hiá»ƒn thá»‹ káº¿t quáº£
    document.getElementById('popupScore').textContent = `${correctAnswers}/${totalQuestions} (${percentage}%)`;
    document.getElementById('popupComment').innerHTML = resultComment;
    document.getElementById('resultPopup').style.display = 'block';
    
    document.getElementById('quizResult').innerHTML = `
        <p><strong>Káº¿t quáº£:</strong> ${correctAnswers}/${totalQuestions} (${percentage}%)</p>
        <p><strong>Nháº­n xÃ©t:</strong> ${resultComment}</p>
    `;
    
    // LÆ°u lá»‹ch sá»­ lÃ m bÃ i
    saveQuizHistory(correctAnswers, percentage);
    
    // Hiá»ƒn thá»‹ nÃºt "Hiá»‡n Ä‘Ã¡p Ã¡n Ä‘Ãºng"
    document.getElementById('showAnswersBtn').style.display = 'block';
    
    // VÃ´ hiá»‡u hÃ³a táº¥t cáº£ input
    form.querySelectorAll('input').forEach(input => {
        input.disabled = true;
    });
    
    // Dá»«ng timer
    stopTimer();
}


    function closeResultPopup() {
      document.getElementById('resultPopup').style.display = 'none';
    }

    function showCorrectAnswers() {
    quizData.forEach((q, idx) => {
        if (q.isReading && q.subQuestions) {
            q.subQuestions.forEach((subQ, subIdx) => {
                const name = `q${idx + 1}_${subIdx}`;
                const correct = (window.answers && window.answers[name]) || quizAnswers[name];
                const labels = document.querySelectorAll(`input[name='${name}']`);
                labels.forEach(input => {
                    const label = input.parentElement;
                    // Náº¿u Ä‘Ã¡p Ã¡n Ä‘Ãºng, chÆ°a cÃ³ span Ä‘Ãºng thÃ¬ thÃªm vÃ o
                    if (input.value === correct && !label.innerHTML.includes('âœ… ÄÃºng')) {
                        label.innerHTML += ' <span class="correct-answer">âœ… ÄÃ¡p Ã¡n Ä‘Ãºng</span>';
                    }
                });
            });
        } else {
            const name = `q${idx + 1}`;
            const correct = (window.answers && window.answers[name]) || quizAnswers[name];
            const labels = document.querySelectorAll(`input[name='${name}']`);
            labels.forEach(input => {
                const label = input.parentElement;
                if (input.value === correct && !label.innerHTML.includes('âœ… ÄÃºng')) {
                    label.innerHTML += ' <span class="correct-answer">âœ… ÄÃ¡p Ã¡n Ä‘Ãºng</span>';
                }
            });
        }
    });
}



    function getResultComment(percentage) {
      if (percentage >= 90) return "GhÃª váº§y nÃ¨, Ä‘Ãºng lÃ  Me iu cá»§a anh &#128525; &#128525; &#128525;";
      if (percentage >= 70) return "Giá»i ghÃª ta Æ°i &#128525;";
      if (percentage >= 50) return "Tá»‘t rá»“i Ä‘Ã³ báº¡n Æ°i &#128512;";
      return "HÃ´ng sao nÃ¨, láº§n sau cá»‘ gáº¯ng thÃªm ha &#129402;";
    }

    function saveQuizHistory(score, percentage) {
      const list = document.getElementById('quizHistory');
      const time = new Date().toLocaleTimeString();
      const li = document.createElement('li');
      li.innerHTML = `
        ${time}: ${score}/${Object.keys(quizAnswers).length} (${percentage}%)
        <button onclick="this.parentElement.remove()">âŒ</button>
      `;
      list.prepend(li);
    }

    function resetQuiz() {
      const form = document.getElementById('quizForm');
      form.reset();
      // Dá»«ng háº¿t timer reading trÆ°á»›c khi render láº¡i
      Object.values(readingTimers).forEach(obj => {
        if (obj.intervalId) clearInterval(obj.intervalId);
      });
      renderQuiz();
      closeResultPopup();
      document.getElementById('quizResult').innerHTML = '';
      document.getElementById('showAnswersBtn').style.display = 'none';
      resetTimer();
    }
      function findKeyBySubQNumber(number) {
        for (let i = 0; i < quizData.length; i++) {
            const q = quizData[i];
            if (!q.isReading) {
                if (q.number == number) return `q${i+1}`;
            } else if (q.subQuestions) {
                for (let j = 0; j < q.subQuestions.length; j++) {
                    const subQ = q.subQuestions[j];
                    if (subQ.number == number) return `q${i+1}_${j}`;
                }
            }
        }
        return null;
    }


    function updateAnswer() {
    let keyOrNumber = document.getElementById("editKey").value.trim();
    const value = document.getElementById("editValue").value.trim();
    if (!window.answers) window.answers = {};

    // Náº¿u nháº­p sá»‘, tá»± Ä‘á»™ng dÃ² key theo subQ.number
    if (/^\d+$/.test(keyOrNumber)) {
        const mappedKey = findKeyBySubQNumber(keyOrNumber);
        if (!mappedKey) {
            alert(`âŒ KhÃ´ng tÃ¬m tháº¥y cÃ¢u há»i sá»‘ ${keyOrNumber}!`);
            return;
        }
        keyOrNumber = mappedKey;
    }

    if (keyOrNumber && value) {
        window.answers[keyOrNumber] = value;
        alert(`âœ… ÄÃ¡p Ã¡n cá»§a ${keyOrNumber} Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t thÃ nh ${value}.`);
    }
}


    function setTimer() {
      const inputMinutes = parseInt(document.getElementById('setTimeInput').value);
      if (!isNaN(inputMinutes) && inputMinutes > 0) {
        defaultTime = inputMinutes;
        remainingTime = defaultTime * 60;
        updateTimerDisplay();
        alert(`ÄÃ£ Ä‘áº·t thá»i gian lÃ m bÃ i lÃ  ${defaultTime} phÃºt`);
      } else {
        alert('Nháº­p cho Ä‘Ãºng coi nÃ o');
      }
    }

    function startTimer() {
      if (isTimerRunning) return;
      isTimerRunning = true;
      timerInterval = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();
        if (remainingTime <= 0) {
          stopTimer();
          document.getElementById('timeUpAlert').style.display = 'block';
          setTimeout(() => {
            document.getElementById('timeUpAlert').style.display = 'none';
          }, 3000);
        }
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      isTimerRunning = false;
    }

    function resetTimer() {
      stopTimer();
      remainingTime = defaultTime * 60;
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(remainingTime / 60);
      const seconds = remainingTime % 60;
      document.getElementById('timerDisplay').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    window.addEventListener('scroll', function() {
      const timerContainer = document.querySelector('.timer-container');
      const scrollY = window.scrollY;
      if (scrollY > 100) {
        timerContainer.style.opacity = '0.9';
        timerContainer.style.transform = 'scale(0.95)';
      } else {
        timerContainer.style.opacity = '1';
        timerContainer.style.transform = 'scale(1)';
      }
    });

    window.onload = function() {
      renderQuiz();
      updateTimerDisplay();
    };
  </script>
</body>
</html>
