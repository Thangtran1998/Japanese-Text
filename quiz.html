<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Trang há»c tiáº¿ng Nháº­t N1</title>
<style>
  body { font-family: Arial; padding: 20px; max-width: 900px; margin: auto; }
  h1, h2, h3 { color: #2c3e50; }
  .nav a { display: block; margin: 10px 0; font-size: 18px; text-decoration: none; color: #007acc; }
  .section { display: none; border: 1px solid #ccc; padding: 20px; margin-bottom: 30px; border-radius: 10px; }
  ul.submenu { list-style-type: square; margin-top: 15px; padding-left: 20px; }
  ul.submenu li {
    margin: 6px 0;
    cursor: pointer;
  }
  li.clickable {
    cursor: pointer;
  }
  .modal {
    display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
    overflow: auto; background-color: rgba(0, 0, 0, 0.4);
  }
  .modal-content {
    background-color: #fff; margin: 15% auto; padding: 20px; border: 1px solid #888;
    width: 80%; max-width: 400px; text-align: center; border-radius: 10px;
  }
  .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
  li.clickable.done::after { content: ' âœ…'; color: green; }
  .score-display {
    color: #2e7d32;
    font-weight: bold;
    font-size: 0.9em;
    margin-left: 5px;
  }
  li[onclick]:hover {
  cursor: pointer;
  color: #1e88e5;
  }
  #testList li:hover {
    cursor: pointer;
    color: #1e88e5;
  }
  #resetHistoryBtn {
    margin: 15px 0;
    padding: 10px 15px;
    background-color: #d9534f;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
</style>
</head>
<body>
  <div id="customModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <p id="modalMessage">ThÃ´ng bÃ¡o</p>
    </div>
  </div>

  <h1>ğŸ“š Trang há»c tiáº¿ng Nháº­t N1</h1>
  <div class="nav">
    <a href="#" onclick="showSection('s1')">1ï¸âƒ£ Luyá»‡n thi N1 giai Ä‘oáº¡n 1</a>
    <a href="#" onclick="showSection('s2')">2ï¸âƒ£ Luyá»‡n thi N1 giai Ä‘oáº¡n 2</a>
    <a href="#" onclick="showSection('s3')">3ï¸âƒ£ KhÃ³a Zoom N1 - ThÃ¡ng 12/2024</a>
  </div>
  <button id="resetHistoryBtn" onclick="resetHistory()">ğŸ—‘ XÃ³a toÃ n bá»™ lá»‹ch sá»­ lÃ m bÃ i</button>

  <div class="section" id="s1">
    <h2>1ï¸âƒ£ Luyá»‡n thi N1 giai Ä‘oáº¡n 1</h2>
    <ul class="submenu">
      <li onclick="showSection('testday1')">ğŸ“ BÃ i test theo ngÃ y cá»§a lá»™ trÃ¬nh 100 ngÃ y</li>
      <li onclick="showModal('KhÃ´ng cÃ³ bÃ i test nÃ o trong thÆ° má»¥c nÃ y, vui lÃ²ng xem tÃ i liá»‡u Ä‘Ã£ táº£i vá» trÃªn mÃ¡y tÃ­nh')">ğŸ“ TÃ i liá»‡u vÃ  lá»™ trÃ¬nh khÃ³a N1 giai Ä‘oáº¡n 1</li>
      <li onclick="showSection('grammarTests')">ğŸ“ Ngá»¯ phÃ¡p phÃ¢n loáº¡i theo chá»§ Ä‘iá»ƒm</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Ã”n táº­p ngá»¯ phÃ¡p cáº¥p tá»‘c N1</li>
      <li onclick="showSection('Trynguphap')">ğŸ“ Luyá»‡n nghe Try ngá»¯ phÃ¡p</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Tá»« vá»±ng theo chá»§ Ä‘iá»ƒm</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Nghe tá»« vá»±ng Tango má»—i ngÃ y</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Kanji</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Kanji Master</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Hack nÃ£o Kanji</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Kanji dá»… nháº§m láº«n (Update 12/2023)</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Chá»¯a Ä‘á» thi JLPT cÃ¡c nÄƒm - pháº§n tá»« vá»±ng, ngá»¯ phÃ¡p</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Test kanji tá»•ng há»£p</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Test tá»« vá»±ng tá»•ng há»£p</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Text tá»•ng há»£p kanji tá»« vá»±ng</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Thi chuyÃªn Ä‘á» (hÃ ng tuáº§n) (12/2023)</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Thi thá»­ thÃ¡ng update 12/2023</li>
      <li onclick="showModal('Äang cáº­p nháº­t ná»™i dung...')">ğŸ“ Há»c Zoom 7/2024</li>
    </ul>
  </div>

  <div class="section" id="grammarTests">
    <h2>ğŸ“‚ Ngá»¯ phÃ¡p phÃ¢n loáº¡i theo chá»§ Ä‘iá»ƒm</h2>
    <ul>
      <!--  <li class="clickable" onclick="openTestInNewTab('N1_Test 1_Ngá»¯ phÃ¡p ï½ã¾ã§.html', this)">ğŸ“„ N1_Test 1_Ngá»¯ phÃ¡p ï½ã¾ã§</li>  -->
    </ul>
  </div>

  <div class="section" id="Trynguphap">
    <h2>ğŸ§ Luyá»‡n nghe Try ngá»¯ phÃ¡p</h2>
    <ul id="testList1"></ul>
  </div>

  <div class="section" id="testday1">
    <h2>ğŸ“˜ BÃ i test theo ngÃ y</h2>
    <ul id="testList"></ul>
  </div>





  <div class="section" id="s2"><h2>2ï¸âƒ£ Luyá»‡n thi N1 giai Ä‘oáº¡n 2</h2><p>Äang cáº­p nháº­t ná»™i dung...</p></div>
  <div class="section" id="s3"><h2>3ï¸âƒ£ KhÃ³a Zoom N1</h2><p>Äang cáº­p nháº­t ná»™i dung...</p></div>

  <script>





    // Luyá»‡n nghe Try ngá»¯ phÃ¡p
const testData1 = [
  { id: "1", name: "ğŸ“˜ Ngá»¯ phÃ¡p ï½ã¾ã§" },
  //{ id: "grammar-kekka", name: "ğŸ“˜ Ngá»¯ phÃ¡p ï½ãŸçµæœ" },
  //{ id: "reading-1", name: "ğŸ“— Äá»c hiá»ƒu N1 - bÃ i 1" },
  //{ id: "listen-practice", name: "ğŸ§ Nghe hiá»ƒu N1 - luyá»‡n táº­p" },
  //{ id: "vocab-advance", name: "ğŸ“’ Tá»« vá»±ng nÃ¢ng cao" }
];

let currentTestId1 = null;

function renderCustomTestList() {
  // Láº¥y pháº§n tá»­ HTML cÃ³ id testList1
  const testList1 = document.getElementById("testList1");

  // Láº¥y dá»¯ liá»‡u tá»« localStorage
  const doneTests1 = JSON.parse(localStorage.getItem("doneTests") || "[]");
  const testScores1 = JSON.parse(localStorage.getItem("testScores") || "{}");

  // XÃ³a danh sÃ¡ch cÅ©
  testList1.innerHTML = "";

  // Duyá»‡t qua tá»«ng bÃ i test
  testData1.forEach((test1) => {
    const li1 = document.createElement("li");
    li1.textContent = test1.name;
    li1.classList.add("clickable");

    if (doneTests1.includes(test1.id)) {
      li1.classList.add("done");
      const scoreData1 = testScores1[test1.id] || { score: 0, total: 1 };
      const percentage1 = Math.round((scoreData1.score / scoreData1.total) * 100);
      li1.innerHTML += ` <span class="score-display">${percentage1}%</span>`;
    }

    li1.onclick = () => {
      currentTestId1 = test1.id;
      openTestInNewTab(encodeURIComponent(`${test1.id}.html`), li1);

    };

    testList1.appendChild(li1);
  });
}
  



//BÃ i test theo ngÃ y cá»§a lá»™ trÃ¬nh 100 ngÃ y
    const testData = Array.from({ length: 62 }, (_, i) => `ğŸ“˜BÃ i test ngÃ y ${i + 1}`);
    let currentTestId = null;

    function renderTestList() {
      //Láº¥y pháº§n tá»­ HTML cÃ³ id testList.
      const testList = document.getElementById("testList"); //const : Khai bÃ¡o biáº¿n

      //Láº¥y dá»¯ liá»‡u lá»‹ch sá»­ tá»« localStorage:
      //doneTests: danh sÃ¡ch testId Ä‘Ã£ lÃ m xong.
      //testScores: Ä‘iá»ƒm sá»‘ Ä‘Ã£ lÆ°u { testId: { score, total } }.
      const doneTests = JSON.parse(localStorage.getItem("doneTests") || "[]");
      const testScores = JSON.parse(localStorage.getItem("testScores") || "{}");
      
      //XÃ³a toÃ n bá»™ danh sÃ¡ch cÅ© trÆ°á»›c khi render láº¡i.
      testList.innerHTML = "";

      //Láº·p qua tá»«ng bÃ i test trong testData, táº¡o pháº§n tá»­ <li> tÆ°Æ¡ng á»©ng, gÃ¡n class="clickable".
      testData.forEach((test, idx) => {
        const testId = `test-day${idx + 1}`;
        const li = document.createElement("li");
        li.textContent = test;
        li.classList.add("clickable");
        

        //Náº¿u bÃ i test náº±m trong danh sÃ¡ch Ä‘Ã£ lÃ m:
        //ThÃªm class done (Ä‘á»ƒ hiá»ƒn thá»‹ dáº¥u âœ… báº±ng CSS).
        //TÃ­nh pháº§n trÄƒm Ä‘iá»ƒm vÃ  hiá»ƒn thá»‹.
        if (doneTests.includes(testId)) {
          li.classList.add("done");
          const scoreData = testScores[testId] || { score: 0, total: 1 };
          const percentage = Math.round((scoreData.score / scoreData.total) * 100);
          li.innerHTML += ` <span class="score-display">${percentage}%</span>`;
        }
        //GÃ¡n sá»± kiá»‡n click
        li.onclick = () => {
          currentTestId = testId;
          openTestInNewTab(`${testId}.html`, li);
        };
        //Gáº¯n vÃ o DOM
        testList.appendChild(li);
      });
    }





























    function openTestInNewTab(testFile, listItem) {
  window.open(testFile, '_blank');
  const testId = testFile.replace('.html', '');

  // âœ… Ghi nhá»› bÃ i test Ä‘Ã£ má»Ÿ
  let doneTests = JSON.parse(localStorage.getItem("doneTests") || "[]");
  if (!doneTests.includes(testId)) {
    doneTests.push(testId);
    localStorage.setItem("doneTests", JSON.stringify(doneTests));
  }
      
      if (listItem) {
        listItem.classList.add("done");
        // ChÆ°a hiá»ƒn thá»‹ % vÃ¬ chÆ°a cÃ³ Ä‘iá»ƒm
      }
    }

    function showSection(id) {
      document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
      const section = document.getElementById(id);
      if (section) section.style.display = 'block';
    }

    function resetHistory() {
      localStorage.removeItem("doneTests");
      localStorage.removeItem("testScores");
      document.querySelectorAll('li.clickable.done').forEach(el => {
        el.classList.remove("done");
        const scoreDisplay = el.querySelector('.score-display');
        if (scoreDisplay) scoreDisplay.remove();
      });
      alert("ÄÃ£ xÃ³a toÃ n bá»™ lá»‹ch sá»­ lÃ m bÃ i.");
    }

    function showModal(msg) {
      document.getElementById('modalMessage').innerText = msg;
      document.getElementById('customModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('customModal').style.display = 'none';
    }

    // Láº¯ng nghe message tá»« cÃ¡c tab bÃ i test
    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'updateScore') {
        const { testId, score, total } = event.data;
        let testScores = JSON.parse(localStorage.getItem("testScores") || "{}");
        testScores[testId] = { score: score, total: total };
        localStorage.setItem("testScores", JSON.stringify(testScores));
        
        // Cáº­p nháº­t hiá»ƒn thá»‹ Ä‘iá»ƒm
        document.querySelectorAll('li.clickable').forEach(li => {
          if (li.getAttribute('onclick') && li.getAttribute('onclick').includes(testId)) {
            li.classList.add("done");
            const percentage = Math.round((score / total) * 100);
            
            // XÃ³a pháº§n hiá»ƒn thá»‹ Ä‘iá»ƒm cÅ© náº¿u cÃ³
            const oldDisplay = li.querySelector('.score-display');
            if (oldDisplay) oldDisplay.remove();
            
            // ThÃªm pháº§n hiá»ƒn thá»‹ Ä‘iá»ƒm má»›i
            const scoreSpan = document.createElement('span');
            scoreSpan.className = 'score-display';
            scoreSpan.textContent = `${percentage}%`;
            li.appendChild(scoreSpan);
          }
        });
      }
    });

    window.addEventListener("DOMContentLoaded", function() {
      renderTestList();
      renderCustomTestList();
   
      
      // KhÃ´i phá»¥c tráº¡ng thÃ¡i section Ä‘ang má»Ÿ
      const lastSection = sessionStorage.getItem("lastSection");
      if (lastSection) showSection(lastSection);
    });

    // LÆ°u tráº¡ng thÃ¡i khi Ä‘Ã³ng trang
    window.addEventListener('beforeunload', function() {
      const currentSection = [...document.querySelectorAll('.section')].find(s => s.style.display === 'block');
      if (currentSection) sessionStorage.setItem("lastSection", currentSection.id);
    });
    
    
    

  </script>
</body>
</html>